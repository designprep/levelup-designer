<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">    <title>ë””ìì´ë„ˆ í‚¤ìš°ê¸°: Ver 75.0 </title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* [í°íŠ¸] Pretendard */
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

/* [1. ì „ì²´ í™”ë©´ ë° ë°”ë”” ì„¤ì •] */
html, body { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #191F28; overflow: hidden; position: fixed; touch-action: none; }

/* 2. ê²Œì„ ì»¨í…Œì´ë„ˆ: ë¹„ìœ¨ ê³ ì •(aspect-ratio) ì‚­ì œ -> í™”ë©´ ì „ì²´ ì‚¬ìš© */
#game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin: 0; padding: 0; }

/* [ëª¨ë°”ì¼ ë“± ì„¸ë¡œê°€ ë” ê¸´ í™”ë©´ì¼ ë•Œì˜ ì˜ˆì™¸ ì²˜ë¦¬] */
@media (max-aspect-ratio: 9/16) {
    #game-container {
        width: 100vw;       /* ë„ˆë¹„ë¥¼ í™”ë©´ ê½‰ ì°¨ê²Œ */
        height: auto;       /* ë†’ì´ëŠ” ë¹„ìœ¨ì— ë§ì¶° ìë™ */
        max-height: 100vh;
    }
}


        /* [2. ì¸íŠ¸ë¡œ í™”ë©´: ìœ„ ì»¨í…Œì´ë„ˆ í¬ê¸°ë¥¼ ë”°ë¼ê°] */
        #intro-layer {
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%;
            z-index: 99999; 
            background-color: #191F28;
            display: flex; flex-direction: column; 
            justify-content: space-between; 
            align-items: center;
            cursor: pointer;
            padding: 80px 0 70px 0;
            box-sizing: border-box;
        }

        /* ë°°ê²½ ì´ë¯¸ì§€ */
        .intro-bg {
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%;
            object-fit: cover; object-position: center;
            z-index: -1; opacity: 0; animation: fadeIn 2s forwards;
        }
/* ë¡œê³  */
.logo-container { width: 100%; text-align: center; opacity: 0; animation: slideDown 1s ease-out 0.5s forwards; }
.intro-logo { width: 80%; max-width: 280px; height: auto; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); margin-bottom: 10px; }
.intro-subtitle { font-size: 20px; font-weight: 800; color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.8); margin: 0; letter-spacing: 1px; }

/* ì‹œì‘ ë©”ì‹œì§€ */
.start-msg { font-size: 16px; font-weight: 500; color: #fff; animation: blink 1.5s infinite 1s; opacity: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes fadeIn { to { opacity: 1; } }
@keyframes slideDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

/* 3. UI ë ˆì´ì–´: í™”ë©´ ì „ì²´ ì‚¬ìš© */
#ui-layer, #phase2-ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; display: flex; flex-direction: column; justify-content: space-between; }
        #phase2-ui-layer { display: none; } 

        .top-bar, .menu-bar, .bottom-area, .popup, #modal-overlay, #ad-overlay, .nav-btn, .debug-btn, .full-btn, .sign-btn, .project-widget { pointer-events: auto; }

        .debug-btn { position: absolute; top: 120px; left: 20px; z-index: 9999; background: rgba(255, 50, 50, 0.8); color: white; border: none; padding: 8px 12px; border-radius: 8px; font-weight: 700; cursor: pointer; }

/* 2. ìƒë‹¨ë°”: ì¢Œìš° íŒ¨ë”© 16px ì ìš© */
.top-bar { 
    position: absolute; top: 0; left: 0; width: 100%; height: auto;
    background: linear-gradient(180deg, rgba(25,31,40,0.98) 0%, rgba(25,31,40,0) 100%);
    z-index: 15;
    padding-top: calc(20px + env(safe-area-inset-top));
    padding-bottom: 10px;
    
    /* â˜… í•µì‹¬: ë‚´ìš©ë¬¼ì´ ì–‘ì˜† 16px ë–¨ì–´ì§€ê²Œ ì„¤ì • */
    padding-left: 16px; 
    padding-right: 16px; 
    
    display: flex; flex-direction: column; 
    box-sizing: border-box; /* íŒ¨ë”© í¬í•¨í•´ì„œ ë„ˆë¹„ ê³„ì‚° */
}

/* [ì‹ ê·œ] 1ì—´: ì„¤ì • ë²„íŠ¼ + ë‚ ì§œ */
.top-row {
    display: flex; 
    align-items: center; 
    margin-bottom: 4px;
}

/* [ìˆ˜ì •] ì„¤ì • ë²„íŠ¼: ë°°ê²½/í…Œë‘ë¦¬ ì œê±°í•˜ê³  ì•„ì´ì½˜ë§Œ ì‹¬í”Œí•˜ê²Œ */
.btn-gear {
    background: transparent; /* ë°°ê²½ íˆ¬ëª…í™” */
    border: none;            /* í…Œë‘ë¦¬ ì‚­ì œ */
    
    color: rgba(255, 255, 255, 0.8); /* ì•½ê°„ íˆ¬ëª…í•œ í°ìƒ‰ (ì„¸ë ¨ë¨) */
    font-size: 22px;         /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì ˆ */
    
    /* í„°ì¹˜ ì˜ì—­ í™•ë³´ë¥¼ ìœ„í•œ íŒ¨ë”© */
    padding: 4px;
    width: auto; 
    height: auto;
    
    display: flex; 
    align-items: center; 
    justify-content: center;
    cursor: pointer;
    margin-right: 2px; /* ë‚ ì§œì™€ ê°„ê²© ì¢í˜ */
    transition: transform 0.2s; /* ëˆ„ë¥¼ ë•Œ ì• ë‹ˆë©”ì´ì…˜ìš© */
}

/* ëˆŒë €ì„ ë•Œ ì‚´ì§ ëŒì•„ê°€ê²Œ (ì„ íƒì‚¬í•­) */
.btn-gear:active {
    transform: rotate(90deg);
    color: #fff;
}

/* ë‚ ì§œ í…ìŠ¤íŠ¸ */
#ui-week, #p2-ui-week {
    font-size: 13px; color: #8B95A1; font-weight: 600;
}

/* [ì‹ ê·œ] 2ì—´: ê¸ˆì•¡ + ì§ê¸‰ ë±ƒì§€ */
.money-row {
    display: flex; 
    align-items: center; 
    margin-bottom: 10px; /* ê²Œì´ì§€ë°”ì™€ ê°„ê²© */
}

#ui-money, #p2-ui-money {
    font-size: 28px; font-weight: 800; color: #fff; 
    letter-spacing: -0.5px; line-height: 1.0;
}

/* ì§ê¸‰ ë±ƒì§€ (í‹°ì–´ í¬í•¨) */
.rank-badge { 
    font-size: 12px; padding: 4px 8px; border-radius: 6px; 
    font-weight: 700; 
    background: rgba(255, 215, 0, 0.15); 
    border: 1px solid rgba(255, 215, 0, 0.4); 
    color: #FFD700; 
    margin-left: 10px; 
    transform: translateY(-1px);
}

/* [ìˆ˜ì •] ê²Œì´ì§€ ë°” (ê½‰ ì°¨ê²Œ) */
.bar-container {
    display: flex; align-items: center; 
    margin-bottom: 8px; 
    width: 100%; 
}
.bar-label { 
    width: 32px; font-weight: 700; font-size: 12px; color: #B0B8C1; 
    flex-shrink: 0; 
}
.bar-bg { 
    flex: 1; /* ë‚¨ì€ ê³µê°„ 100% ì°¨ì§€ */
    height: 10px; background: #333D4B; border-radius: 10px; 
    overflow: hidden; position: relative; 
}
        .bar-container { display: flex; align-items: center; margin-bottom: 8px; }
        .bar-label { width: 30px; font-weight: 700; font-size: 12px; color: #B0B8C1; }
        .bar-bg { flex: 1; height: 10px; background: #333D4B; border-radius: 10px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; width: 0%; border-radius: 10px; transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        
        #hp-bar, #p2-mental-bar { background: #75D06A; } 
        #exp-bar, #p2-skill-bar { background: #9956DE; } 
        #pf-bar, #p2-perf-bar { background: #FF8B8B; } 

        #ui-deadline { text-align:right; font-size:13px; color:#FF8B8B; font-weight:700; margin-top: 4px; height: 20px;}

        /* [Phase 2 í”„ë¡œì íŠ¸ ìœ„ì ¯] */
        .project-widget {
            position: absolute; top: calc(170px + env(safe-area-inset-top)); right: 16px; width: 120px;
            background: #FFF9C4; color: #333; padding: 12px; border-radius: 2px 2px 10px 2px;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.3); transform: rotate(2deg); z-index: 12;
            display: none; /* JSë¡œ ì œì–´ */ font-family: 'Pretendard', sans-serif;
            pointer-events: auto;
        }
        .project-widget h4 { margin: 0 0 5px 0; font-size: 11px; color: #F57F17; font-weight: 800; text-transform: uppercase; }
        .pw-title { font-size: 13px; font-weight: 700; line-height: 1.3; margin-bottom: 8px; display: block; }
        .pw-info { font-size: 11px; color: #555; display: flex; justify-content: space-between; margin-bottom: 4px; }
        .pw-bar-bg { width: 100%; height: 6px; background: #E0E0E0; border-radius: 3px; overflow: hidden; }
        .pw-bar-fill { height: 100%; background: #FBC02D; width: 0%; transition: width 0.3s; }
        .pw-stamp { 
            position: absolute; bottom: 5px; right: 5px; border: 2px solid #FF5F5F; color: #FF5F5F; 
            font-size: 10px; font-weight: 900; padding: 2px 4px; transform: rotate(-15deg); opacity: 0; transition: opacity 0.3s;
        }

        /* [2. ë©”ë‰´ ë²„íŠ¼] */
       .menu-bar { 
            position: absolute; 
            bottom: 250px; 
            left: 0;       
            width: 100%;   
            
            display: flex; 
            justify-content: center; 
            align-items: center;
            
            gap: 6px; /* ë²„íŠ¼ ê°„ê²© ë¯¸ì„¸ ì¡°ì • */
            
            z-index: 20;   
            pointer-events: auto; 
            
            /* â˜… í•µì‹¬: ì–‘ì˜† ì—¬ë°±ì„ 4pxë¡œ ì•„ì£¼ ì–‡ê²Œ ì¤Œ â˜… */
            padding: 0 4px; 
            box-sizing: border-box; 
        }
        .menu-btn { background: rgba(51, 61, 75, 0.95); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .menu-btn:active { transform: scale(0.95); background: #454F5D; }

        /* [3. í•˜ë‹¨ ì˜ì—­] */

.bottom-area { 
    position: absolute; bottom: 0; left: 0; width: 100%; height: auto;
    background: linear-gradient(0deg, #191F28 90%, rgba(25,31,40,0.95) 100%);
    z-index: 15;
    padding-top: 20px; 
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    
    /* â˜… í•µì‹¬: í•˜ë‹¨ UIë„ ì–‘ì˜† 16px ì—¬ë°± í™•ë³´ */
    padding-left: 16px;
    padding-right: 16px;
    
    display: flex; flex-direction: column; justify-content: flex-end;
    box-sizing: border-box; 
}
/* ê¸°ì¡´ .log-box, .action-grid ì˜ width: 94% ë“±ì€ 100%ë¡œ ë³€ê²½í•˜ê±°ë‚˜ ì‚­ì œí•´ë„ ë¬´ë°©í•¨ (íŒ¨ë”©ì´ ìˆìœ¼ë¯€ë¡œ) */
.log-box, .action-grid { width: 100%; margin: 0; }
       .log-box, .action-grid { 
    width: 100%; 
    margin: 0 0 15px 0; /* ë§ˆì§„ ì˜¤í†  ì‚­ì œ */
}
        .log-box { background: #333D4B; border-radius: 16px; padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 15px; box-sizing: border-box; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn { height: 60px; border: none; border-radius: 18px; cursor: pointer; font-family: 'Pretendard'; color: #fff; display: flex; flex-direction: column; align-items: flex-start; justify-content: center; padding: 0 20px; position: relative; overflow: hidden; transition: transform 0.1s, filter 0.2s; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .action-btn:active { transform: scale(0.96); filter: brightness(0.9); }
        .action-btn div { font-size: 16px; font-weight: 700; margin-bottom: 2px; }
        .action-btn span { font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.8); }

        .btn-skill { background-color: #9956DE; } 
        .btn-project { background-color: #FF8B8B; } 
        .btn-alba { background-color: #FFB356; } 
        .btn-social { background-color: #7274ED; } 
        .btn-rest { background-color: #75D06A; } 

        .action-btn::after { content: attr(data-icon); position: absolute; right: 15px; bottom: 12px; font-size: 24px; opacity: 0.4; }

        /* [íŒì—… UI] */
        #modal-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 9000; }
        .popup { display: none; flex-direction: column; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 320px; max-height: 80vh; background: #242A36; border: 1px solid rgba(255,255,255,0.05); padding: 24px; color: #fff; z-index: 10000; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); overflow-y: auto; overflow-x: hidden; }
        .popup h2 { margin: 0 0 20px 0; color: #fff; text-align: left; font-size: 20px; font-weight: 800; }
        .close-btn { position: absolute; top: 20px; right: 20px; background: #333D4B; color: #fff; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 16px; font-weight: bold; cursor: pointer; display:flex; align-items:center; justify-content:center; }
        
        .item-list { list-style: none; padding: 0; margin: 0; width: 100%; box-sizing: border-box; }
        .item-list li, .card-btn { background: #333D4B; border: none; padding: 16px; margin-bottom: 10px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; width: 100%; box-sizing: border-box; cursor: pointer; }
        .item-list li:active, .card-btn:active { background: #454F5D; transform: scale(0.98); }
        .card-info h3 { margin: 0; font-size: 15px; font-weight: 700; color: #fff; } .card-info p { margin: 4px 0 0 0; font-size: 12px; color: #B0B8C1; }
        
        .shop-item { display: flex !important; align-items: center; justify-content: space-between; width: 100%; }
        .shop-left { display: flex; align-items: center; flex: 1; }
        .shop-thumb { width: 44px; height: 44px; background:#191F28; margin-right: 14px; object-fit: contain; border-radius: 12px; border: 1px solid #333; }
        .shop-info { display: flex; flex-direction: column; text-align: left; }
        .shop-name { font-size: 15px; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .shop-desc { font-size: 11px; color: #8B95A1; }
        .shop-price { font-size: 13px; color: #7274ED; margin-top: 4px; font-weight: 700; }

        .btn-buy { background: #3182F6; color: #fff; padding: 8px 14px; border-radius: 8px; border:none; font-weight:600; font-size:12px; min-width: 60px; text-align: center;} .btn-buy:disabled { background: #454F5D; color: #8B95A1; }
        .btn-action { background: #FF8B8B; color: white; padding: 8px 16px; border-radius:8px; border:none; font-weight:700;}
        .btn-ad { width: 100%; padding: 14px; background: #333D4B; color: #FFB356; border: 1px dashed #FFB356; margin-top: 10px; border-radius:12px; font-weight: 700; }
        .card-btn .btn-ad { width: auto; margin-top: 0; padding: 8px 16px; border-radius: 8px; font-size: 12px; min-width: 60px; }
        .full-btn { width: 100%; padding: 14px; background: #3182F6; color: white; font-size: 16px; margin-top: 10px; border: none; border-radius: 16px; font-weight:700; cursor: pointer;}
        
        .job-card { display:flex; align-items:center; font-size:15px; color: #fff; font-weight: 600; }
        .job-tier { font-size: 11px; padding: 4px 8px; border-radius: 6px; margin-right: 12px; font-weight: 800; width: 50px; text-align: center; }
        .tier-Unicorn { background: rgba(255, 179, 86, 0.2); color: #FFB356; border:1px solid #FFB356; } 
        .tier-TopTier { background: rgba(114, 116, 237, 0.2); color: #7274ED; border:1px solid #7274ED; } 
        .tier-Agency { background: rgba(255, 255, 255, 0.1); color: #B0B8C1; border:1px solid #8B95A1; }
        .btn-apply { background: #3182F6; color: white; padding: 8px 14px; border-radius: 8px; border: none; font-weight:700; font-size:12px; min-width: 70px;} .btn-apply:disabled { background: #454F5D; color: #8B95A1; }

        .input-name { width: 100%; padding: 14px; background: #191F28; border: 1px solid #333; color: #fff; margin-bottom: 12px; box-sizing: border-box; outline: none; border-radius: 12px; font-size:14px;} .input-name:focus { border-color: #3182F6; }
        .select-group { display: flex; gap: 10px; height: 160px; margin-bottom: 15px; }
        .select-col { flex: 1; display: flex; flex-direction: column; } .select-col h3 { font-size: 13px; color: #8B95A1; margin-bottom: 8px; font-weight: 600; }
        .scroll-box { flex: 1; overflow-y: scroll; border: 1px solid #333; background: #191F28; padding: 6px; border-radius: 12px; }
        .radio-item { display: block; padding: 10px; border-bottom: 1px solid #222; font-size: 13px; cursor: pointer; color: #fff; } .radio-item:hover { background: #333; }
        
        #ad-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 20000; flex-direction: column; justify-content: center; align-items: center; pointer-events: auto; }
        #ad-overlay h1 { color: #FFF; } #ad-overlay p { color: #8B95A1; }

        .toggle-switch { position: relative; width: 40px; height: 24px;}
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #454F5D; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #3182F6; }
        input:checked + .slider:before { transform: translateX(16px); }

        .ranking-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .rank-num { width: 40px; font-size: 16px; font-weight: 800; color: #B0B8C1; text-align: center; }
        .rank-num.top { color: #FFD700; font-size: 18px; }
        .rank-name { flex: 1; font-size: 14px; font-weight: 600; color: #fff; }
        .rank-score { font-size: 14px; font-weight: 700; color: #3182F6; }
        .my-rank { background: rgba(49, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(49, 130, 246, 0.3); }

        #success-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 20000; display: none; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .paper-notice { background: #fdfbf7; width: 100%; max-width: 380px; padding: 30px 25px; border-radius: 8px; box-shadow: 0 15px 40px rgba(0,0,0,0.6), inset 0 0 60px rgba(255,253,240,0.5); text-align: center; position: relative; overflow: hidden; animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .notice-header { margin-bottom: 25px; position: relative; }
        .notice-title { color: #333; font-size: 22px; font-weight: 800; margin: 10px 0; letter-spacing: -0.5px; }
        .deco-line { height: 2px; background: #333; width: 40px; margin: 0 auto; opacity: 0.3; }
        .final-stamp { position: absolute; top: -10px; right: -10px; border: 4px double #d32f2f; color: #d32f2f; font-weight: 900; font-size: 16px; padding: 8px 12px; transform: rotate(-15deg); border-radius: 4px; text-transform: uppercase; opacity: 0.9; mix-blend-mode: multiply; }
        .approved-stamp { position: absolute; top: 30px; left: -15px; color: rgba(49, 130, 246, 0.2); font-size: 40px; font-weight: 900; transform: rotate(-30deg); z-index: 0; pointer-events: none; }
        .notice-body { display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; position: relative; z-index: 1; }
        .char-stamp-box { width: 100px; height: 120px; background: #fff; border: 1px solid #ddd; padding: 5px; margin-bottom: 15px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); transform: rotate(-2deg); }
        .success-char-img { width: 100%; height: 100%; object-fit: contain; background: #f5f5f5; }
        .notice-text { color: #555; font-size: 14px; line-height: 1.6; word-break: keep-all; }
        .company-name { color: #3182F6; font-size: 20px; font-weight: 800; display: block; margin: 8px 0; text-decoration: underline; }
        .score-box { background: linear-gradient(135deg, #fff9e6 0%, #fff 100%); border: 2px solid #FFD700; border-radius: 12px; padding: 15px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2); }
        .score-label { font-size: 13px; color: #b78a00; font-weight: 700; margin-bottom: 5px; }
        .score-value { color: #333; font-size: 18px; font-weight: 700; }
        .score-desc { font-size: 12px; color: #999; margin-top: 5px; font-style: italic; }
        .notice-footer { font-size: 13px; color: #777; }
        .footer-note { font-size: 11px; color: #aaa; margin-top: 5px; }
        .sign-btn { background: #333; margin-top: 20px; border-radius: 8px; font-size: 15px; }
        
        .quiz-box { text-align: center; margin-bottom: 20px; }
        .quiz-q { font-size: 18px; font-weight: 700; color: #FFB356; margin-bottom: 15px; word-break: keep-all; line-height: 1.4; }
        .quiz-input { width: 100%; box-sizing: border-box; padding: 14px; background: #191F28; border: 2px solid #7274ED; color: #fff; font-size: 16px; border-radius: 12px; text-align: center; margin-bottom: 10px; outline: none; }
        .quiz-input:focus { border-color: #3182F6; }
        .pantry-option { text-align: left; border: 1px solid rgba(255,255,255,0.05); }
        .pantry-tag { font-size: 11px; padding: 3px 6px; border-radius: 4px; font-weight: 700; margin-bottom: 4px; display: inline-block; }
/* [NEW] ìºë¦­í„° ë§í’ì„  ìŠ¤íƒ€ì¼ */
.speech-bubble {
    position: absolute;
    /* ìœ„ì¹˜: ìºë¦­í„° ì¢Œì¸¡ ìƒë‹¨ (í¬ìŠ¤íŠ¸ì‡ í”¼í•¨) */
    top: 230px; 
    left: 30px;
    max-width: 140px;
    
    background: #fff;
    color: #000;
    padding: 10px 12px;
    border-radius: 12px;
    border: 2px solid #000;
    font-size: 12px;
    font-weight: 700;
    line-height: 1.4;
    z-index: 14; /* UI(15)ë³´ë‹¤ëŠ” ë’¤, ìºë¦­í„°ë³´ë‹¤ëŠ” ì• */
    box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
    
    /* íŒì—… ì• ë‹ˆë©”ì´ì…˜ */
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; /* í´ë¦­ ë°©í•´ ì•ˆ í•¨ */
}

/* ë§í’ì„  ê¼¬ë¦¬ (ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ í–¥í•¨) */
.speech-bubble::after {
    content: '';
    position: absolute;
    bottom: -8px;
    right: 20px;
    border-width: 8px 8px 0;
    border-style: solid;
    border-color: #fff transparent;
    display: block;
    width: 0;
}
.speech-bubble::before { /* ê¼¬ë¦¬ í…Œë‘ë¦¬ */
    content: '';
    position: absolute;
    bottom: -11px;
    right: 18px;
    border-width: 9px 9px 0;
    border-style: solid;
    border-color: #000 transparent;
    display: block;
    width: 0;
    z-index: -1;
}
        /* [ì§ê¸‰ ë°°ì§€ ìŠ¤íƒ€ì¼] */
        .tier-Global { background: rgba(76, 217, 100, 0.2); color: #4CD964; border:1px solid #4CD964; } 
        .tier-Space { background: rgba(255, 99, 71, 0.2); color: #FF6347; border:1px solid #FF6347; }
/* [íŠœí† ë¦¬ì–¼ ìŠ¤íƒ€ì¼] */
#tutorial-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); /* ë°°ê²½ ì–´ë‘¡ê²Œ */
    z-index: 50000; /* ìµœìƒë‹¨ */
    display: flex; justify-content: center; align-items: center; /* ì¤‘ì•™ ì •ë ¬ */
}

.tuto-dialog {
    width: auto; margin: 0 24px; max-width: 340px;
    background: #fff; color: #333;
    padding: 24px; border-radius: 20px;
    border: 3px solid #3182F6;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    text-align: left;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.tuto-name { font-size: 15px; font-weight: 900; color: #3182F6; margin-bottom: 10px; display: block; }
.tuto-text { font-size: 17px; line-height: 1.6; color: #222; font-weight: 600; margin-bottom: 25px; min-height: 54px; word-break: keep-all; }
.tuto-next-btn { width: 100%; padding: 14px; background: #191F28; color: #fff; border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; transition: background 0.2s; }
.tuto-next-btn:active { background: #333; transform: scale(0.98); }

/* [í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜] */
@keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    50% { transform: translateY(-20px) scale(1.2); opacity: 1; }
    100% { transform: translateY(-40px) scale(1); opacity: 0; }
}

.float-text {
    position: absolute;
    pointer-events: none; /* í´ë¦­ ë°©í•´ ê¸ˆì§€ */
    font-family: 'Pretendard', sans-serif;
    font-weight: 900;
    font-size: 20px;
    z-index: 99999; /* ìµœìƒë‹¨ í‘œì‹œ */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* ê°€ë…ì„± ê·¸ë¦¼ì */
    animation: floatUp 0.8s ease-out forwards;
    white-space: nowrap;
}
/* [ë©´ì ‘ íŒì—… ì „ìš© ìŠ¤íƒ€ì¼] */
.interview-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.interview-question {
    font-size: 18px;
    font-weight: 700;
    color: #fff;
    text-align: center;
    margin-bottom: 8px;
    line-height: 1.4;
    word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
}

.interview-hint-badge {
    display: inline-block;
    font-size: 13px;
    font-weight: 600;
    padding: 6px 14px;
    border-radius: 20px;
    background: rgba(255, 95, 95, 0.15); /* ë¶‰ì€ìƒ‰ ë°°ê²½ ì—°í•˜ê²Œ */
    color: #FF5F5F;
    margin-bottom: 25px; /* ì§ˆë¬¸ê³¼ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
    border: 1px solid rgba(255, 95, 95, 0.3);
}

/* íŒíŠ¸ê°€ íŒŒë€ìƒ‰ì¼ ë•Œ(íƒ‘í‹°ì–´ ì´ìƒ) ë®ì–´ì”Œìš¸ í´ë˜ìŠ¤ */
.hint-blue {
    background: rgba(49, 130, 246, 0.15) !important;
    color: #3182F6 !important;
    border: 1px solid rgba(49, 130, 246, 0.3) !important;
}

/* ë‹µë³€ ë²„íŠ¼ ë””ìì¸ (ë©”ì¸ í…Œë§ˆ ì ìš©) */
/* [ìˆ˜ì •] ë©´ì ‘ ë‹µë³€ ë²„íŠ¼ (ê³µí†µ ë² ì´ìŠ¤) */
.interview-btn {
    width: 100%;
    color: #fff;
    padding: 16px 20px;
    margin-bottom: 10px;
    border-radius: 12px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    word-break: keep-all;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    
    /* ê¸°ë³¸ ë°°ê²½ìƒ‰ (í˜¹ì‹œ ëª¨ë¥¼ ëŒ€ë¹„ìš©) */
    background-color: #333D4B; 
}

/* â˜… ì²« ë²ˆì§¸ ë²„íŠ¼: ë©”ì¸ ë¸”ë£¨ (Main Blue) */
.interview-btn:nth-child(1) {
    background-color: #3182F6; 
}
.interview-btn:nth-child(1):hover { background-color: #1b64da; }

/* â˜… ë‘ ë²ˆì§¸ ë²„íŠ¼: ì¸ë””ê³  í¼í”Œ (Indigo) - ë¸”ë£¨ì™€ ìœ ì‚¬í•˜ë©´ì„œ ì„¸ë ¨ë¨ */
.interview-btn:nth-child(2) {
    background-color: #6B76FF; 
}
.interview-btn:nth-child(2):hover { background-color: #505ce6; }

/* â˜… ì„¸ ë²ˆì§¸ ë²„íŠ¼: ë”¥ ë¯¼íŠ¸/í‹¸ (Teal) - ì‚°ëœ»í•˜ê³  í¬ì¸íŠ¸ê°€ ë¨ */
.interview-btn:nth-child(3) {
    background-color: #00C4B4; 
}
.interview-btn:nth-child(3):hover { background-color: #00a396; }

/* ëˆŒë €ì„ ë•Œ ê³µí†µ íš¨ê³¼ */
.interview-btn:active {
    transform: scale(0.98);
    opacity: 0.9;
}
/* [ìŠ¤í¬ë¡¤ë°” ë””ìì¸ ì»¤ìŠ¤í…€] */
/* ìŠ¤í¬ë¡¤ë°” ì „ì²´ ë„ˆë¹„ */
.item-list::-webkit-scrollbar {
    width: 6px; 
}
/* ìŠ¤í¬ë¡¤ë°” ë’·ë°°ê²½ (íŠ¸ë™) */
.item-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2); 
    border-radius: 4px;
}
/* ì›€ì§ì´ëŠ” ë§‰ëŒ€ (ì¸) */
.item-list::-webkit-scrollbar-thumb {
    background: #555; 
    border-radius: 4px;
}
/* ë§‰ëŒ€ì— ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ */
.item-list::-webkit-scrollbar-thumb:hover {
    background: #777; 
}

/* [ëª©ë¡ê³¼ ìŠ¤í¬ë¡¤ë°” ì‚¬ì´ ê°„ê²© í™•ë³´] */
#inventory-list, #shop-list {
    padding-right: 10px; /* ìŠ¤í¬ë¡¤ë°”ì™€ ë‚´ìš©ë¬¼ì´ ë‹¿ì§€ ì•Šê²Œ ì—¬ë°± ì¶”ê°€ */
}
/* [ìƒì  ëª©ë¡ ìŠ¤í¬ë¡¤ ê°•ì œ ì ìš©] */
#shop-list {
    max-height: 300px;   /* ë†’ì´ë¥¼ ì œí•œí•´ì•¼ ìŠ¤í¬ë¡¤ì´ ìƒê¹€ */
    overflow-y: auto;    /* ìŠ¤í¬ë¡¤ë°” í™œì„±í™” */
    padding-right: 10px; /* ë‚´ìš©ë¬¼ê³¼ ìŠ¤í¬ë¡¤ë°” ì‚¬ì´ ê°„ê²© */
}
/* [í† ìŠ¤ ìŠ¤íƒ€ì¼ ì¢…ë£Œ íŒì—… ë””ìì¸] */
#exit-popup {
    /* í™”ë©´ ê³ ì • */
    position: fixed; 
    top: 0; 
    left: 0;
    width: 100%; 
    height: 100%;
    
    /* â˜… í•µì‹¬ 1: ë§¨ ìœ„ë¡œ ì˜¬ë¦¬ê¸° (ë¸”ëŸ¬ë‚˜ ë‹¤ë¥¸ UIë³´ë‹¤ ë†’ê²Œ ì„¤ì •) */
    z-index: 9999 !important; 
    
    /* â˜… í•µì‹¬ 2: ë‚´ìš©ë¬¼ ì¤‘ì•™ ì •ë ¬ */
    display: flex; 
    justify-content: center; 
    align-items: center; 
    
    /* ë°°ê²½ ì–´ë‘¡ê²Œ ì²˜ë¦¬ (ì„ íƒì‚¬í•­) */
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px); /* ë°°ê²½ íë¦¼ íš¨ê³¼ */
}
/* 1. íŒì—… ë°•ìŠ¤ (í°ìƒ‰ ì¹´ë“œ í˜•íƒœ) */
.popup-content.toss-style {
    background-color: #FFFFFF; /* í°ìƒ‰ ë°°ê²½ */
    width: 85%;
    max-width: 320px;
    border-radius: 24px; /* ë‘¥ê¸€ê²Œ (ê°€ì´ë“œ ë°˜ì˜) */
    padding: 24px 20px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    
    /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ì„¤ì • (ë¶€ëª¨ flex ì„¤ì • ë”°ë¦„) */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* 2. íƒ€ì´í‹€ í…ìŠ¤íŠ¸ */
.popup-title {
    font-size: 20px;
    font-weight: 700;
    color: #191F28; /* ì§„í•œ íšŒìƒ‰ */
    line-height: 1.4;
    margin: 10px 0 30px 0; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© í™•ë³´ */
    word-break: keep-all;
}

/* 3. ë²„íŠ¼ ê·¸ë£¹ (ê°€ë¡œ ë°°ì¹˜) */
.popup-btn-group {
    display: flex;
    width: 100%;
    gap: 12px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
}

/* 4. ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
.popup-btn {
    flex: 1; /* 1:1 ë¹„ìœ¨ë¡œ ê½‰ ì±„ìš°ê¸° */
    height: 52px; /* í„°ì¹˜í•˜ê¸° ì¢‹ì€ ë†’ì´ */
    border-radius: 12px; /* ë²„íŠ¼ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    font-size: 16px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
}

/* 5. [ë‹«ê¸°] ë²„íŠ¼ (íšŒìƒ‰ ë°°ê²½) */
.btn-cancel {
    background-color: #F2F4F6; /* ì—°í•œ íšŒìƒ‰ */
    color: #4E5968; /* ì¤‘ê°„ íšŒìƒ‰ í…ìŠ¤íŠ¸ */
}
.btn-cancel:active {
    background-color: #d1d6db; /* ëˆŒë €ì„ ë•Œ ë°˜ì‘ */
}

/* 6. [ì¢…ë£Œí•˜ê¸°] ë²„íŠ¼ (í† ìŠ¤ ë¸”ë£¨) */
.btn-confirm {
    background-color: #3182F6; /* â˜… Toss Blue */
    color: #FFFFFF; /* í°ìƒ‰ í…ìŠ¤íŠ¸ */
}
.btn-confirm:active {
    background-color: #1b64da; /* ëˆŒë €ì„ ë•Œ ë°˜ì‘ */
}

/* [ìˆ˜ì •] ë¸Œë¦¿ì§€ ë·°: í† ìŠ¤ ìŠ¤íƒ€ì¼ì˜ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
#bridge-view {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 200000; /* ìµœìƒë‹¨ */
    
    /* ìœ„ìª½ì€ ì•½ê°„ ë°ì€ ë‹¤í¬ê·¸ë ˆì´(#3a3a3a), ì•„ë˜ìª½ì€ ê²Œì„ ë°°ê²½ìƒ‰(#191F28)ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§ */
    background: linear-gradient(180deg, rgba(58, 58, 58, 0.98) 0%, #191F28 100%);
    
    display: flex; flex-direction: column; 
    justify-content: center; align-items: center;
    transition: opacity 0.8s ease-out, visibility 0.8s; /* ë¶€ë“œëŸ½ê²Œ ì‚¬ë¼ì§€ëŠ” íš¨ê³¼ */
}

/* ë¡œê³  ë°•ìŠ¤ (ìŠ¤ì¿¼í´ í˜•íƒœ) */
.bridge-logo {
    width: 72px; height: 72px;
    background-color: #333; /* ë¡œê³  ì—†ì„ ë•Œ ë°°ê²½ */
    border-radius: 22px; /* iOS/í† ìŠ¤ ìŠ¤íƒ€ì¼ ë¼ìš´ë“œ */
    display: flex; justify-content: center; align-items: center;
    margin: 0 auto 24px auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    overflow: hidden;
}
.bridge-logo img { width: 100%; height: 100%; object-fit: cover; }

/* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.bridge-text {
    font-size: 22px; font-weight: 700; color: #fff;
    line-height: 1.4; text-align: center; margin: 0;
    font-family: 'Pretendard', sans-serif;
    opacity: 0; animation: fadeUp 0.8s ease-out 0.2s forwards;
}
.highlight { color: #3182F6; } /* í† ìŠ¤ ë¸”ë£¨ í¬ì¸íŠ¸ */

/* [ìˆ˜ì •] ì—°ë ¹ ë“±ê¸‰ ë°°ì§€: ì¸íŠ¸ë¡œ í™”ë©´ ìš°ì¸¡ ìƒë‹¨ ê³ ì • */
.rating-badge-mini {
    position: absolute; 
    /* ì•„ì´í° ë…¸ì¹˜ ì˜ì—­ë§Œí¼ ë„ì›Œì¤Œ + ê¸°ë³¸ ì—¬ë°± 20px */
    top: calc(20px + env(safe-area-inset-top)); 
    right: 20px;
    z-index: 10;
    
    /* ë°°ê²½ì´ë‚˜ í…Œë‘ë¦¬ ì—†ì´ ê¹”ë”í•˜ê²Œ ì´ë¯¸ì§€ë§Œ ë³´ì—¬ì¤Œ */
    background: none; 
    border: none;
    padding: 0;
    
    /* (ì„ íƒì‚¬í•­) ì‚´ì§ ë– ìˆëŠ” ëŠë‚Œì„ ì£¼ëŠ” ê·¸ë¦¼ì */
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
}

/* ë“±ê¸‰ ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
.rating-badge-mini img {
    width: 54px; /* ë„ˆë¬´ í¬ì§€ ì•Šê²Œ ì ë‹¹í•œ í¬ê¸° */
    height: auto;
    object-fit: contain;
}


/* ì• ë‹ˆë©”ì´ì…˜ ë° ìˆ¨ê¹€ ì²˜ë¦¬ */
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* [í•„ìˆ˜] ë¸Œë¦¿ì§€ ë·° ìˆ¨ê¹€ ì²˜ë¦¬ìš© í´ë˜ìŠ¤ (ì—†ìœ¼ë©´ ì¶”ê°€í•˜ì„¸ìš”!) */
.bridge-hidden {
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important; /* í´ë¦­ í†µê³¼ì‹œí‚¤ê¸° */
}

@keyframes bridgeFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* [í† ìŠ¤ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€ ì•Œë¦¼ì°½] */
#custom-alert-overlay {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6); z-index: 999999;
    align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
    opacity: 0; transition: opacity 0.2s;
}
#custom-alert-box {
    background: #fff; width: 85%; max-width: 320px;
    border-radius: 24px; padding: 24px; text-align: center;
    transform: scale(0.9); transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
#custom-alert-msg {
    font-size: 17px; color: #333; line-height: 1.5; margin-bottom: 24px; font-weight: 600; word-break: keep-all;
}
#custom-alert-btn {
    width: 100%; padding: 16px; background: #3182F6; color: #fff;
    border: none; border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer;
}
#custom-alert-btn:active { background: #1b64da; transform: scale(0.98); }

/* í™œì„±í™” í´ë˜ìŠ¤ */
.alert-active { display: flex !important; opacity: 1 !important; }
.alert-active #custom-alert-box { transform: scale(1) !important; }

/* =========================================
   [í†µí•©] í† ìŠ¤ ìŠ¤íƒ€ì¼ ë²„íŠ¼ í„°ì¹˜ íš¨ê³¼ (ì†ë§›)
   ========================================= */

/* 1. ëª¨ë“  ë²„íŠ¼ë¥˜ì— ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì ìš© */
button, 
.menu-btn, .action-btn, .card-btn, 
.full-btn, .btn-buy, .btn-action, .btn-ad, .btn-apply, 
.close-btn, .btn-gear, .popup-btn, #custom-alert-btn {
    /* ì«€ë“í•œ í…ì…˜ (ëˆŒë €ë‹¤ ë—„ ë•Œ ì°°ë‘ê±°ë¦¬ëŠ” ëŠë‚Œ) */
    transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.2s;
    transform-origin: center center;
    cursor: pointer;
    /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸(íŒŒë€ ë°•ìŠ¤) ì œê±° */
    -webkit-tap-highlight-color: transparent; 
}

/* 2. ëˆŒë €ì„ ë•Œ (Active) ê³µí†µ íš¨ê³¼ */
button:active, 
.menu-btn:active, .action-btn:active, .card-btn:active, 
.full-btn:active, .btn-buy:active, .btn-action:active, .btn-ad:active, .btn-apply:active, 
.close-btn:active, .btn-gear:active, .popup-btn:active, #custom-alert-btn:active {
    /* 0.96ë°°ë¡œ ì‚´ì§ ì¶•ì†Œ (ë„ˆë¬´ ì‘ì•„ì§€ë©´ ì´ŒìŠ¤ëŸ¬ì›€) */
    transform: scale(0.96) !important;
    
    /* ì•„ì£¼ ì‚´ì§ ì–´ë‘ì›Œì ¸ì„œ ëˆŒë¦° ê¹Šì´ê° í‘œí˜„ */
    filter: brightness(0.92);
}

/* [ì˜ˆì™¸ ì²˜ë¦¬] í†±ë‹ˆë°”í€´ ì„¤ì • ë²„íŠ¼ì€ íšŒì „ íš¨ê³¼ ìœ ì§€ */
.btn-gear:active {
    transform: scale(0.9) rotate(90deg) !important;
}


/* [ìˆ˜ì •] ë¡œê·¸ ë©”ì‹œì§€ ë ˆì´ì–´ (ìœ„ì¹˜ ì¡°ì •) */
#scene-message-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; 
    z-index: 105;
    
    display: flex; flex-direction: column; 
    
    /* â˜… í•µì‹¬ ìˆ˜ì •: ì¤‘ì•™(center)ì´ ì•„ë‹ˆë¼ í•˜ë‹¨(flex-end) ì •ë ¬ */
    justify-content: flex-end; 
    align-items: center;
    
    /* ë°”ë‹¥ì—ì„œ ì–´ëŠ ì •ë„ ë„ìš¸ì§€ ì„¤ì • (ìºë¦­í„° ë°œ ì•„ë˜ ìœ„ì¹˜) */
    padding-bottom: 150px; 
    box-sizing: border-box;
}

/* [ìˆ˜ì •] ëŒ€í™”ì°½ ìŠ¤íƒ€ì¼ (ë‹¤í¬ ëª¨ë“œ ì ìš©) */
.scene-message-box {
    /* â˜… í•µì‹¬ 1: ë°°ê²½ì„ ì–´ë‘ìš´ ìƒ‰(#222~#333 ê³„ì—´) + ë°˜íˆ¬ëª…ìœ¼ë¡œ ë³€ê²½ */
    background: rgba(33, 37, 45, 0.95); 
    
    /* â˜… í•µì‹¬ 2: ì•„ì£¼ ì–‡ì€ í°ìƒ‰ í…Œë‘ë¦¬ë¥¼ ì¤˜ì„œ ë°°ê²½ê³¼ êµ¬ë¶„ê°(ê³ ê¸‰ì§)ì„ ì¤Œ */
    border: 1px solid rgba(255, 255, 255, 0.15);
    
    backdrop-filter: blur(12px); /* ë¸”ëŸ¬ íš¨ê³¼ */
    padding: 24px 30px;
    border-radius: 24px; 
    
    /* ê·¸ë¦¼ìë¥¼ ì¢€ ë” ì§„í•˜ê²Œ ì¤˜ì„œ ë– ìˆëŠ” ëŠë‚Œ ê°•ì¡° */
    box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
    
    max-width: 80%;
    text-align: center;
    transform: none; 
    
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
#scene-msg-text {
    font-size: 18px; 
    font-weight: 700; 
    
    /* â˜… í•µì‹¬ 3: ê¸€ì”¨ìƒ‰ì„ ë°ì€ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    color: #FFFFFF; 
    
    line-height: 1.5;
    word-break: keep-all;
    letter-spacing: -0.5px; /* ìê°„ ë¯¸ì„¸ ì¡°ì • */
}


    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
</head>
<body>
    <div id="game-container">
<div id="bridge-view">
  <div class="rating-badge-mini" style="display:none;">
    <span>ì „ì²´ì´ìš©ê°€</span>
</div>

    <div class="bridge-content">
        <div class="bridge-logo">
            <img src="icon.png" onerror="this.style.display='none'; document.getElementById('temp-icon').style.display='block';" alt="ë¡œê³ ">
            <span id="temp-icon" style="display:none; font-size: 40px;">ğŸ¨</span>
        </div>

        <h2 class="bridge-text">
            <span class="highlight">ë ˆë²¨ ì—…! ë””ìì´ë„ˆ</span><br>
            ì ‘ì† ì¤‘...
        </h2>
    </div>
</div>
<div id="custom-alert-overlay">
    <div id="custom-alert-box">
        <div id="custom-alert-msg">ì•Œë¦¼ ë‚´ìš©</div>
        <button id="custom-alert-btn" onclick="closeCustomAlert()">í™•ì¸</button>
    </div>
</div>
<div id="scene-message-layer" style="display:none;">
    <div class="scene-message-box">
        <div id="scene-msg-text">í…ìŠ¤íŠ¸ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
    </div>
</div>

<div id="intro-layer" onclick="startGame()">
    <img src="assets/intro_bg.png" class="intro-bg" alt="ë°°ê²½">
    
<div class="rating-badge-mini" style="display:none;">
    <img src="assets/grac_all.png" alt="ì „ì²´ì´ìš©ê°€"> 
</div>

    <div class="logo-container">
        <img src="assets/intro_logo.png" class="intro-logo" alt="ë¡œê³ ">
        <p class="intro-subtitle">ë ˆë²¨ ì—…! ë””ìì´ë„ˆ</p>
    </div>
    <p class="start-msg">í„°ì¹˜í•˜ì—¬ ì‹œì‘í•˜ê¸°</p>
</div>

        <div id="ui-layer" style="display:none;">
            <button class="debug-btn" style="display:none;" onclick="testEnding()">ğŸ¬ ì—”ë”© í…ŒìŠ¤íŠ¸</button>

<div class="top-bar">
    <div class="top-row">
        <button class="btn-gear" onclick="openPopup('settings-popup')">âš™ï¸</button>
        <span id="ui-week">1ë…„ 1ì›” 1ì£¼</span>
    </div>

    <div class="money-row">
        <span id="ui-money">500,000</span>
    </div>

    <div class="bar-container">
        <span class="bar-label">HP</span>
        <div class="bar-bg"><div id="hp-bar" class="bar-fill" style="width:100%"></div></div>
    </div>
    <div class="bar-container">
        <span class="bar-label">Lv.<span id="ui-lv">1</span></span>
        <div class="bar-bg"><div id="exp-bar" class="bar-fill" style="width:0%"></div></div>
    </div>
    <div class="bar-container">
        <span class="bar-label">PF</span>
        <div class="bar-bg"><div id="pf-bar" class="bar-fill" style="width:0%"></div></div>
    </div>
    <div id="ui-deadline"></div>
</div>

            <div class="menu-bar">
                <button class="menu-btn" onclick="renderShop(); openPopup('shop-popup');">ğŸ›’ ìƒì </button>
                <button class="menu-btn" onclick="renderInventory(); openPopup('inventory-popup');">ğŸ’ ì¥ë¹„</button>
                <button class="menu-btn" onclick="renderHistory(); openPopup('portfolio-popup');">ğŸ“‚ í¬í´</button>
                <button class="menu-btn" id="btn-job" onclick="openJobMarket(); openPopup('job-popup');">ğŸ’¼ ì·¨ì—…</button>
            </div>

            <div class="bottom-area">
                <div class="log-box">
                    <span id="log-text">ë ˆë²¨ ì—…! ë””ìì´ë„ˆ Start</span>
                </div>
                
                <div class="action-grid">
                    <button class="action-btn btn-skill" data-icon="âš¡" onclick="openPopup('skill-popup')"><div>ìŠ¤í‚¬ ì—…</div><span>ëŠ¥ë ¥ì¹˜ ìƒìŠ¹</span></button>
                    <button class="action-btn btn-project" id="btn-work" data-icon="ğŸ’¼" onclick="handleProjectButton()"><div>ìƒˆ í”„ë¡œì íŠ¸</div><span>í¬íŠ¸í´ë¦¬ì˜¤</span></button>
                    <button class="action-btn btn-alba" data-icon="ğŸ’¸" onclick="openAlbaPopup()"><div>ì•Œë°”í•˜ê¸°</div><span>ëˆ ë²Œê¸°</span></button>
                    <button class="action-btn btn-rest" data-icon="ğŸ›Œ" onclick="openPopup('rest-popup')"><div>íœ´ì‹í•˜ê¸°</div><span>ì²´ë ¥ íšŒë³µ</span></button>
                </div>
            </div>
        </div>

        <div id="phase2-ui-layer">
           <button class="debug-btn" style="display:none; top: 280px; background: rgba(50, 100, 255, 0.8);" onclick="testNextTier()">ğŸš€ í‹°ì–´ ìƒìŠ¹ (í…ŒìŠ¤íŠ¸)</button>
<div class="top-bar">
    <div class="top-row">
        <button class="btn-gear" onclick="openPopup('settings-popup')">âš™ï¸</button>
        <span id="p2-ui-week">1ë…„ 1ì›” 1ì¼</span>
    </div>

    <div class="money-row">
        <span id="p2-ui-money">2,500,000</span>
        <div id="p2-rank-badge" class="rank-badge">ì‚¬ì› (Agency)</div>
    </div>

    <div class="bar-container">
        <span class="bar-label">ë©˜íƒˆ</span>
        <div class="bar-bg"><div id="p2-mental-bar" class="bar-fill" style="width:100%"></div></div>
    </div>
    <div class="bar-container">
        <span class="bar-label">Lv.<span id="p2-ui-lv">1</span></span>
        <div class="bar-bg"><div id="p2-skill-bar" class="bar-fill" style="width:0%"></div></div>
    </div>
    <div class="bar-container">
        <span class="bar-label">ì„±ê³¼</span>
        <div class="bar-bg"><div id="p2-perf-bar" class="bar-fill" style="width:0%"></div></div>
    </div>
</div>

            <div id="p2-project-widget" class="project-widget">
                <h4>Current Project</h4>
                <span class="pw-title" id="pw-title">ëŒ€ê¸°ì¤‘...</span>
                <div class="pw-info"><span>ë§ˆê° D-<span id="pw-day">0</span></span><span id="pw-percent">0%</span></div>
                <div class="pw-bar-bg"><div id="pw-bar" class="pw-bar-fill"></div></div>
                <div id="pw-stamp" class="pw-stamp">ë°˜ë ¤ë¨!</div>
                
                <button id="pw-extend-btn" style="display:none; width:100%; background:#FF5F5F; color:#fff; border:none; border-radius:4px; padding:5px; font-size:11px; font-weight:bold; margin-top:8px; cursor:pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);" onclick="openExtensionPopup()">
                    ğŸ“ ì œë°œ... ê¸°í•œ ì—°ì¥
                </button>
            </div>

            <div class="menu-bar">
                <button class="menu-btn" onclick="renderShop(); openPopup('shop-popup');">ğŸ›’ ìƒì </button>
                <button class="menu-btn" onclick="renderInventory(); openPopup('inventory-popup');">ğŸ’ ì¥ë¹„</button>
                <button class="menu-btn" onclick="openHallOfFame()">ğŸ“‚ í¬í´</button>
                <button class="menu-btn" onclick="openJobMarket(); openPopup('job-popup');">ğŸš€ ì´ì§</button>
            </div>

            <div class="bottom-area">
                <div class="log-box">
                    <span id="p2-log-text">ì‹ ì… ë””ìì´ë„ˆë¡œ ì²« ì¶œê·¼í–ˆìŠµë‹ˆë‹¤!</span>
                </div>
                
                <div class="action-grid">
                    <button class="action-btn btn-skill" data-icon="ğŸ“š" onclick="openP2SkillPopup()">
                        <div>ìê¸° ê³„ë°œ</div><span>ìŠ¤í‚¬ ìƒìŠ¹</span>
                    </button>

                    <button class="action-btn btn-project" data-icon="ğŸ–¥ï¸" onclick="doP2Work()"><div>ì—…ë¬´ ìˆ˜í–‰</div><span>ì„±ê³¼ ìƒìŠ¹</span></button>
                    <button class="action-btn btn-social" data-icon="ğŸ¤" onclick="openSocialPopup()"><div>ì‚¬íšŒìƒí™œ</div><span>ì •ì¹˜/ì²˜ì„¸ìˆ </span></button>
                    <button class="action-btn btn-rest" data-icon="â˜•" onclick="openP2RestPopup()"><div>íœ´ì‹ í•˜ê¸°</div><span>ë©˜íƒˆ íšŒë³µ</span></button>
                </div>
            </div>
        </div>
<div id="interview-popup" class="popup" style="z-index: 11000; background: #191F28; border: 1px solid #333;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid #333;">
        <h2 style="margin:0; color:#fff; font-size:18px;">ğŸ‘” ë©´ì ‘ ì§„í–‰ ì¤‘</h2>
        <div style="background:rgba(0,0,0,0.4); padding:6px 12px; border-radius:15px; font-size:13px; border:1px solid #444;">
            <span id="interview-stats-display">ğŸ”¥10 | ğŸ§ 10 | âœ¨10</span>
        </div>
    </div>

    <div class="interview-container">
        <div style="font-size:48px; margin-bottom:15px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));">
            ğŸ‘¤
        </div>
        
        <div id="interview-q-text" class="interview-question">
            ì§ˆë¬¸ ë¡œë”© ì¤‘...
        </div>

        <div id="interview-q-hint" class="interview-hint-badge">
            ëª©í‘œ: ì—´ì •ì„ ë³´ì—¬ì£¼ì„¸ìš”!
        </div>
    </div>

    <div id="interview-answers" style="display:flex; flex-direction:column; gap:0; margin-top:10px;">
        </div>
</div>
        <div id="modal-overlay"></div>
        <div id="shop-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì¥ë¹„ ìƒì </h2><ul id="shop-list" class="item-list"></ul></div>
<div id="inventory-popup" class="popup" style="min-height: 400px;">
    
    <div id="inv-view-list">
        <button class="close-btn" onclick="closePopup()">Ã—</button>
        <h2>ë‚´ ì¥ë¹„</h2>
        <p style="color:#8B95A1; font-size:12px; margin-bottom:10px;">ì•„ì´í…œì„ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        <ul id="inventory-list" class="item-list" style="max-height:300px; overflow-y:auto;">
            </ul>
    </div>

    <div id="inv-view-detail" style="display:none; text-align:center; animation: fadeIn 0.3s;">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button onclick="backToInventory()" style="background:transparent; border:none; color:#fff; font-size:18px; cursor:pointer; padding:0; margin-right:10px;">
                â†
            </button>
            <h2 style="margin:0; font-size:18px;">ì¥ë¹„ ìƒì„¸</h2>
        </div>

        <div style="background: #333D4B; border-radius: 16px; padding: 30px; margin-bottom: 20px; display:flex; flex-direction:column; align-items:center; box-shadow: inset 0 0 20px rgba(0,0,0,0.2);">
            <img id="inv-detail-img" src="" style="width: 100px; height: 100px; object-fit: contain; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5)); margin-bottom:15px;">
            <div id="inv-detail-name" style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 5px;">ì´ë¦„</div>
            <div id="inv-detail-power" style="font-size: 14px; color: #3182F6; font-weight: 700;">Power +0</div>
        </div>

        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 10px;">
            <p id="inv-detail-desc" style="margin: 0; font-size: 15px; font-weight: 600; color: #B0B8C1; line-height: 1.6; font-style: italic;">
                "ì„¤ëª… í…ìŠ¤íŠ¸"
            </p>
        </div>
    </div>
</div>       
        <div id="portfolio-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì™„ì„±ì‘</h2><ul id="portfolio-list" class="item-list"></ul></div>
        <div id="planning-popup" class="popup" style="width: 320px;"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ìƒˆ í”„ë¡œì íŠ¸ ê¸°íš</h2><input type="text" id="project-name" class="input-name" placeholder="í”„ë¡œì íŠ¸ëª… ì…ë ¥"><div class="select-group"><div class="select-col"><h3>ì£¼ì œ (Genre)</h3><div id="genre-list" class="scroll-box"></div></div><div class="select-col"><h3>ìŠ¤íƒ€ì¼ (Style)</h3><div id="style-list" class="scroll-box"></div></div></div><button class="full-btn" onclick="confirmPlanning()">ë‹¤ìŒ ë‹¨ê³„</button></div>
        <div id="mission-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì „ëµ ì„ íƒ</h2><button class="full-btn" onclick="setStrategy('quality')">ğŸ¨ í€„ë¦¬í‹° ì¤‘ì‹¬</button><button class="full-btn" style="background:#4CD964;" onclick="setStrategy('speed')">âš¡ ì†ë„ ì¤‘ì‹¬</button></div>
        
        <div id="alba-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì•Œë°” ì„ íƒ</h2><div class="card-btn"><div class="card-info"><h3>â˜• ì¹´í˜ ì•Œë°”</h3><p>+5ë§Œ / HP -20</p></div><button class="btn-action" id="btn-normal-alba" onclick="startWorking('normal')">ì¶œê·¼</button></div><div class="card-btn"><div class="card-info"><h3>ğŸ”¥ íŠ¹ê¸‰ ì•¼ê·¼</h3><p>+10ë§Œ (ê´‘ê³ )</p></div><button class="btn-ad" onclick="trySpecialAlba()">ì§€ì›</button></div></div>
        
        <div id="social-popup" class="popup">
            <button class="close-btn" onclick="closePopup()">Ã—</button>
            <h2 id="social-title">ì‚¬íšŒìƒí™œ</h2>
            <div id="social-content"></div>
        </div>

        <div id="rest-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>íœ´ì‹ ì„ íƒ</h2><div class="card-btn"><div class="card-info"><h3>â˜• ì»¤í”¼ ìˆ˜í˜ˆ</h3><p>HP +30 / 5ì²œì›</p></div><button class="btn-action" onclick="doRest('coffee')">ë§ˆì‹œê¸°</button></div><div class="card-btn"><div class="card-info"><h3>ğŸ›Œ ê¿€ì </h3><p>HP +60 / ë¬´ë£Œ</p></div><button class="btn-buy" onclick="doRest('sleep')">ìê¸°</button></div><div class="card-btn"><div class="card-info"><h3>âœ¨ ì˜¨ì „í•œ íë§</h3><p>HP 100% / ê´‘ê³ </p></div><button class="btn-ad" onclick="showAd(function(){doRest('full')})">ê´‘ê³ </button></div></div>
        
        <div id="p2-rest-popup" class="popup">
    <button class="close-btn" onclick="closePopup()">Ã—</button>
    <h2>íœ´ì‹ í•˜ê¸°</h2>
    <p style="text-align:center; color:#B0B8C1; font-size:12px; margin-bottom:15px;">
        * í…Œë‹ˆìŠ¤ëŠ” í‹°ì–´ê°€ ë†’ì„ìˆ˜ë¡ ê³ ê¸‰ í´ëŸ½ì„ ì´ìš©í•©ë‹ˆë‹¤.
    </p>

    <div class="card-btn">
        <div class="card-info">
            <h3>ğŸ¾ í…Œë‹ˆìŠ¤ ë ˆìŠ¨</h3>
            <p id="p2-tennis-cost">ê°€ê²© ê³„ì‚° ì¤‘...</p> 
        </div>
        <button class="btn-buy" onclick="doP2RestAction('tennis')">ìš´ë™</button>
    </div>

    <div class="card-btn">
        <div class="card-info">
            <h3>ğŸ  ì§‘ì—ì„œ ë„·í”Œë¦­ìŠ¤</h3>
            <p>ë¬´ë£Œ (ë©˜íƒˆ +60)</p>
        </div>
        <button class="btn-buy" onclick="doP2RestAction('home')">íœ´ì‹</button>
    </div>

    <div class="card-btn" style="border:1px solid #7274ED">
        <div class="card-info">
            <h3>âœˆï¸ í•´ì™¸ì—¬í–‰ (ê´‘ê³ )</h3>
            <p>ë¬´ë£Œ (ë©˜íƒˆ ì™„ì „ íšŒë³µ)</p>
        </div>
        <button class="btn-buy" onclick="doP2RestAction('full')">ë– ë‚˜ê¸°</button>
    </div>
</div>

        <div id="skill-popup" class="popup">
            <button class="close-btn" onclick="closePopup()">Ã—</button>
            <h2>ìŠ¤í‚¬ ì—…</h2>
            <div class="card-btn"><div class="card-info"><h3>ğŸ¤– AI êµ¬ë…</h3><p>ë””ìì¸ ìŠ¤í‚¬ +2 (4ë§Œì›)</p></div><button class="btn-buy" onclick="doSkillUp('ai')">ìˆ˜ê°•</button></div>
            <div class="card-btn"><div class="card-info"><h3>ğŸ¨ ì›ë°ì´ í´ë˜ìŠ¤</h3><p>ë””ìì¸ ìŠ¤í‚¬ +10 (15ë§Œì›)</p></div><button class="btn-buy" onclick="doSkillUp('oneday')">ìˆ˜ê°•</button></div>
            <div class="card-btn" style="border:1px solid #FFB356"><div class="card-info"><h3>ğŸ”¥ ë””í”„ë ™ ì •ê·œê³¼ì •</h3><p>ë””ìì¸ ìŠ¤í‚¬ +50 (50ë§Œì›)</p></div><button class="btn-buy" onclick="doSkillUp('deprep')">ìˆ˜ê°•</button></div>
        </div>  
        
        <div id="p2-skill-popup" class="popup">
    <button class="close-btn" onclick="closePopup()">Ã—</button>
    <h2>ì§ë¬´ ëŠ¥ë ¥ í–¥ìƒ</h2>
    <div style="text-align:center; color:#B0B8C1; font-size:12px; margin-bottom:15px;">
        * ë ˆë²¨ì´ ë†’ì„ìˆ˜ë¡ ì¦ê°€ìœ¨ì€ ê°ì†Œí•˜ê³  ë¹„ìš©ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.
    </div>
    
    <div class="card-btn">
        <div class="card-info">
            <h3>ğŸ“° ìœ ë£Œ ë ˆí¼ëŸ°ìŠ¤ êµ¬ë…</h3>
            <p id="p2-cost-sub">ê°€ê²© ê³„ì‚° ì¤‘...</p> 
        </div>
        <button class="btn-buy" onclick="doP2SkillAction('sub')">êµ¬ë…</button>
    </div>

    <div class="card-btn">
        <div class="card-info">
            <h3>ğŸ¤ ì§ë¬´ ì¸ì‚¬ì´íŠ¸ ì„¸ë¯¸ë‚˜</h3>
            <p id="p2-cost-seminar">ê°€ê²© ê³„ì‚° ì¤‘...</p> 
        </div>
        <button class="btn-buy" onclick="doP2SkillAction('seminar')">ì°¸ì„</button>
    </div>

    <div class="card-btn" style="border:1px solid #FFB356">
        <div class="card-info">
            <h3>ğŸ”¥ ë””í”„ë ™ ì •ê·œê³¼ì •</h3>
            <p id="p2-cost-deprep">ê°€ê²© ê³„ì‚° ì¤‘...</p> 
        </div>
        <button class="btn-buy" onclick="doP2SkillAction('deprep')">ìˆ˜ê°•</button>
    </div>
</div>
        <div id="job-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì·¨ì—… ì‹œì¥</h2><div style="text-align:center; font-size:13px; color:#B0B8C1; margin-bottom:15px;">ë‚´ ìµœê³  ì ìˆ˜: <span id="best-score" style="color:#fff; font-weight:700;">0</span>ì <br><span style="color:#555; font-size:11px;">(2ê°œì›”ë§ˆë‹¤ ê°±ì‹ ë©ë‹ˆë‹¤)</span></div><ul id="job-list" class="item-list"></ul><button class="btn-ad" onclick="showAd(function(){refreshJobs()})">ê³µê³  ìƒˆë¡œê³ ì¹¨ (ê´‘ê³ )</button></div>
<div id="exit-popup" class="popup-layer" style="display: none;">
    <div class="popup-content toss-style">
        <h3 class="popup-title">ë ˆë²¨ ì—…! ë””ìì´ë„ˆë¥¼<br>ì¢…ë£Œí• ê¹Œìš”?</h3>
        
        <div class="popup-btn-group">
            <button class="popup-btn btn-cancel" onclick="closeExitPopup()">ë‹«ê¸°</button>
            <button class="popup-btn btn-confirm" onclick="quitGame()">ì¢…ë£Œí•˜ê¸°</button>
        </div>
    </div>
</div>
        <div id="settings-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ì„¤ì • (Settings)</h2><ul class="item-list"><li class="card-btn" onclick="closePopup(); openRankingPopup();"><div class="card-info"><h3 style="color:#FFD700">ğŸ† ë­í‚¹ í™•ì¸</h3><p>ë‚˜ì˜ ë””ìì´ë„ˆ ìˆœìœ„ ë³´ê¸°</p></div><div>></div></li><li class="card-btn" style="cursor: default;"><div class="card-info"><h3>ë°°ê²½ìŒì•…</h3><p>ê²Œì„ ì†Œë¦¬ ì¼œê¸°/ë„ê¸°</p></div><label class="toggle-switch"><input type="checkbox" id="sound-toggle" checked onchange="toggleSound()"><span class="slider"></span></label></li><li class="card-btn" onclick="resetGameData()"><div class="card-info"><h3 style="color:#FF5F5F">ë°ì´í„° ì´ˆê¸°í™”</h3><p>ëª¨ë“  ì§„í–‰ ìƒí™© ì‚­ì œ</p></div><div style="color:#FF5F5F; font-weight:700;">Reset</div></li></ul></div>
        <div id="ranking-popup" class="popup"><button class="close-btn" onclick="closePopup()">Ã—</button><h2>ğŸ† ë””ìì´ë„ˆ ë­í‚¹</h2><div style="background:#333D4B; padding:15px; border-radius:12px; margin-bottom:15px; text-align:center;"><div style="font-size:12px; color:#B0B8C1;">ë‚˜ì˜ ë­í‚¹ ì ìˆ˜</div><div id="my-rank-score" style="font-size:24px; font-weight:800; color:#FFD700; margin:5px 0;">0</div><div id="my-rank-text" style="font-size:14px; font-weight:600; color:#fff;">ìƒìœ„ ??%</div></div><ul id="ranking-list" class="item-list"></ul></div>
        <div id="meeting-popup" class="popup" style="z-index: 20002;">
    <h2 style="color:#7274ED;">â˜• í‚¥ì˜¤í”„ ë¯¸íŒ…</h2>
    <div style="text-align:center; margin-bottom:15px;">
        <p style="font-size:12px; color:#B0B8C1;">í´ë¼ì´ì–¸íŠ¸ê°€ ìš”êµ¬ì‚¬í•­ì„ ìŸì•„ëƒ…ë‹ˆë‹¤.</p>
        <div style="background:#fff; color:#333; padding:15px; border-radius:12px; margin:10px 0; font-weight:bold; font-size:14px; position:relative;">
            "<span id="client-msg">...</span>"
        </div>
    </div>
    
    <div class="card-btn" onclick="confirmMeeting('yesman')" style="padding:10px; margin-bottom:8px;">
        <div class="card-info">
            <h3>A. ë¬´ë¦¬í•œ ìˆ˜ìš© (ê¸‰í–‰)</h3>
            <p style="color:#FF5F5F">ì§„í–‰ë„ 1.5ë°° / ì²´ë ¥ì†Œëª¨ 2ë°°</p>
        </div>
    </div>
    <div class="card-btn" onclick="confirmMeeting('pro')" style="padding:10px; margin-bottom:8px;">
        <div class="card-info">
            <h3>B. ì •ì„ ëŒ€ì‘ (ê¸°ë³¸)</h3>
            <p style="color:#B0B8C1">ë³€ë™ ì—†ìŒ (í‘œì¤€)</p>
        </div>
    </div>
    <div class="card-btn" onclick="confirmMeeting('ignore')" style="padding:10px; margin-bottom:8px;">
        <div class="card-info">
            <h3>C. í˜„ì‹¤ íƒ€í˜‘ (ì ˆì•½)</h3>
            <p style="color:#4CD964">ì²´ë ¥ì†Œëª¨ 0.7ë°° / ì§„í–‰ë„ 0.6ë°°</p>
        </div>
    </div>
</div>

        <div id="offer-popup" class="popup" style="z-index: 10500;">
            <h2>ğŸ“© ì±„ìš© ì œì•ˆ ë„ì°©</h2>
            <div style="text-align:center; margin-bottom:20px;">
                <div style="font-size:16px; font-weight:bold; color:#fff; margin-bottom:10px;" id="offer-company-name">(ì£¼)íšŒì‚¬ëª…</div>
                <p style="color:#B0B8C1; font-size:13px; line-height:1.6;">"ê·€í•˜ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¸ìƒ ê¹Šê²Œ ë³´ì•˜ìŠµë‹ˆë‹¤.<br>ì €í¬ì™€ í•¨ê»˜ ì„¸ìƒì„ ë°”ê¿”ë³´ì‹œê² ìŠµë‹ˆê¹Œ?"</p>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="full-btn" style="background:#454F5D; margin-top:0;" onclick="closePopup()">ê±°ì ˆí•˜ê¸°</button>
                <button class="full-btn" style="background:#3182F6; margin-top:0;" onclick="acceptOffer()">ì…ì‚¬í•˜ê¸°</button>
            </div>
        </div>

        <div id="success-popup">
            <div class="paper-notice">
                <div class="notice-header">
                    <div class="deco-line"></div>
                    <h2 class="notice-title">ğŸ“œ ìµœì¢… í•©ê²© í†µì§€ì„œ</h2>
                    <div class="deco-line"></div>
                    <div class="final-stamp">ìµœì¢…í•©ê²©</div>
                    <div class="approved-stamp">APPROVED</div>
                </div>
                
                <div class="notice-body">
                    <div class="char-stamp-box">
                        <img src="assets/char_suit_front.png" class="success-char-img" alt="í•©ê²©ì ì‚¬ì§„">
                    </div>
                    <div class="notice-text">
                        ê·€í•˜ëŠ” ì••ë„ì ì¸ ì‹¤ë ¥ìœ¼ë¡œ ë‹¹ì‚¬ì˜ ì±„ìš© ì‹¬ì‚¬ë¥¼ í†µê³¼í•˜ì—¬,
                        <strong id="success-company" class="company-name">(ì£¼)íšŒì‚¬ëª…</strong>ì˜
                        í•µì‹¬ ë””ìì´ë„ˆë¡œ ìµœì¢… ì„ ë°œë˜ì—ˆìŒì„ ì•Œë¦½ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="score-box">
                    <div class="score-label">ğŸ–ï¸ ìµœì¢… ë””ìì´ë„ˆ í‰ê°€ ì ìˆ˜</div>
                    <div class="score-value"><span id="success-score">0</span> ì </div>
                    <div class="score-desc">"ë‹¹ì‹ ì˜ ë…¸ë ¥ì´ ì¦ëª…ëœ ìˆœê°„ì…ë‹ˆë‹¤."</div>
                </div>

                <div class="notice-footer">
                    <p>ğŸ“… <strong>ì¶œê·¼:</strong> ë‹¤ìŒì£¼ ì›”ìš”ì¼ 09:00 (íŒêµ ì‚¬ì˜¥)</p>
                    <p class="footer-note">* ì¤€ë¹„ë¬¼: íŠ¼íŠ¼í•œ ëª¸, êº¾ì´ì§€ ì•ŠëŠ” ë§ˆìŒ</p>
                    <button class="full-btn sign-btn" onclick="startPhase2()">ì„œëª…í•˜ê³  ì¶œê·¼í•˜ê¸° (ìƒˆë¡œìš´ ì‹œì‘)</button>
                </div>
            </div>
        </div>
        <div id="payday-popup" class="popup" style="z-index: 21000; text-align:center;">
    <h2 style="color:#4CD964; border-bottom:1px solid #444; padding-bottom:10px;">ğŸ’µ ê¸‰ì—¬ ëª…ì„¸ì„œ</h2>
    
    <div style="background:#fff; color:#333; padding:20px; border-radius:4px; margin-bottom:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transform: rotate(-1deg);">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px; color:#555;">
            <span>(+) ì›” ê¸‰ì—¬ì•¡</span>
            <span id="pay-income" style="font-weight:bold; color:#333;">0</span>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:14px; color:#FF5F5F;">
            <span>(-) ì„¸ê¸ˆ ë° í’ˆìœ„ ìœ ì§€ë¹„</span>
            <span id="pay-cost" style="font-weight:bold;">0</span>
        </div>
        <div style="border-top:2px dashed #aaa; margin:10px 0;"></div>
        <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:900; color:#3182F6;">
            <span>= ì‹¤ ìˆ˜ë ¹ì•¡</span>
            <span id="pay-total">0</span>
        </div>
    </div>
    
    <p id="pay-msg" style="font-size:13px; color:#B0B8C1; margin-bottom:15px;">"ì´ë²ˆ ë‹¬ë„ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤."</p>
    <button class="full-btn" onclick="closePopup()">í™•ì¸ (ì…ê¸ˆ ì™„ë£Œ)</button>
</div>
        <div id="ad-overlay"><h1>ADVERTISEMENT</h1><p>(3ì´ˆ í›„ ë‹«ê¸°)</p><button onclick="closeAd()" style="margin-top:20px; padding:10px;">ë‹«ê¸°</button></div>
        <div id="hall-of-fame-popup" class="popup" style="z-index: 20005;">
    <h2 style="color:#FFD700;">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
    <div style="text-align:center; color:#B0B8C1; font-size:12px; margin-bottom:15px;">
        Sê¸‰ í”„ë¡œì íŠ¸ë¥¼ ì „ì‹œí•˜ì—¬ ì˜êµ¬ ë²„í”„ë¥¼ íšë“í•˜ì„¸ìš”.<br>(ìµœëŒ€ 3ê°œ ìŠ¬ë¡¯)
    </div>

    <div style="background:#333; padding:10px; border-radius:8px; margin-bottom:15px; font-size:13px;">
        <span style="color:#4CD964">ğŸ’° ì—°ë´‰ +<span id="hof-wealth">0</span>%</span> | 
        <span style="color:#FFB356">âš¡ ì†ë„ +<span id="hof-speed">0</span>%</span> | 
        <span style="color:#7274ED">ğŸ–ï¸ ì„±ê³¼ +<span id="hof-fame">0</span>%</span>
    </div>

    <ul id="hof-list" class="item-list" style="max-height:200px; overflow-y:auto; margin-bottom:10px;">
        </ul>

    <button class="full-btn" onclick="openRegisterPopup()">â• Sê¸‰ í”„ë¡œì íŠ¸ ë“±ë¡í•˜ê¸°</button>
    <button class="full-btn" style="background:#454F5D; margin-top:5px;" onclick="closePopup()">ë‹«ê¸°</button>
</div>

<div id="hof-register-popup" class="popup" style="z-index: 20006;">
    <h2>ì „ì‹œí•  ì‘í’ˆ ì„ íƒ</h2>
    <p style="text-align:center; font-size:12px; color:#B0B8C1; margin-bottom:10px;">ê¸°ë¡ëœ Sê¸‰ í”„ë¡œì íŠ¸ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</p>
    <ul id="hof-candidate-list" class="item-list" style="max-height:300px; overflow-y:auto;"></ul>
    <button class="full-btn" style="background:#454F5D;" onclick="closeRegisterPopup()">ì·¨ì†Œ</button>
</div>
        <div id="extension-popup" class="popup" style="z-index: 20001;">
            <h2 style="color:#FFB356;">ğŸ“… ë§ˆê° ê¸°í•œ ì—°ì¥</h2>
            <div style="text-align:center; margin-bottom:20px;">
                <p style="font-size:14px; color:#fff; line-height:1.6; margin-bottom:15px;">
                    "ì•„... ì´ëŒ€ë¡œë©´ ë§ˆê°ì„ ëª» ë§ì¶˜ë‹¤.<br>
                    <span style="color:#FF5F5F; font-weight:bold;">ë°˜ë ¤ ë‹¹í•˜ë©´ ë©˜íƒˆì´ ë°˜í† ë§‰</span> ë‚  í…ë°..."
                </p>
                <div style="background:#333; padding:15px; border-radius:8px; font-size:13px; color:#B0B8C1;">
                    ìì¡´ì‹¬ êµ½íˆê³  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‚¬ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                    <span style="color:#4CD964;">(ê´‘ê³  ì‹œì²­ ì‹œ ë§ˆê° +1ì£¼ ì—°ì¥)</span>
                </div>
            </div>
            <button class="btn-ad" onclick="closePopup(); showAd(function(){doExtendDeadline()})">
                ğŸ“ ì „í™” ê±¸ê¸° (ê´‘ê³  ì‹œì²­)
            </button>
            <button class="full-btn" style="background:#454F5D; margin-top:10px;" onclick="closePopup()">
                âœ‹ ì•„ë‹ˆìš”, ë°¤ìƒˆì„œ ëëƒ…ë‹ˆë‹¤.
            </button>
        </div>
        <div id="tutorial-overlay" style="display:none;">
    <div class="tuto-dialog">
        <span id="tuto-name" class="tuto-name"></span>
        <div id="tuto-text" class="tuto-text"></div>
        <button id="tuto-btn" class="tuto-next-btn" onclick="nextTutorialLine()"></button>
    </div>
</div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (í•¨ìˆ˜ ë°”ê¹¥ì— ìˆì–´ì•¼ í•¨)
        let bgSprite;
        let sceneContext, sceneOverlay, sceneImage, sceneDialogText;
        let portfolioOverlay, pfDialogText, adCallback = null;
        let currentGenreId, currentStyleId, currentJobList = [];
        let isSoundOn = true; 
        let charHoodieSprite, charSuitSprite;
        let charWorkSprite, charSuitWorkSprite;
        let overlayContainer, overlayText; 
        let soundIntro, soundP1, soundP2, soundClick;
        let soundEnding;
        // [ë©´ì ‘ ì¿¨íƒ€ì„ ì €ì¥ì†Œ] { "íšŒì‚¬ì´ë¦„": ì ê¸ˆí•´ì œì‹œê°„(Timestamp) }
let interviewCooldowns = {};
let currentBgm = null;
/* [ì¶”ê°€] ì´ë¯¸ì§€ë¥¼ í™”ë©´ ë¹„ìœ¨ì— ë§ì¶° ê½‰ ì±„ì›Œì£¼ëŠ” í•¨ìˆ˜ (Cover ëª¨ë“œ) */
function fitToScreen(image) {
    if (!image || !sceneContext) return;
    
    // 1. í˜„ì¬ í™”ë©´ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
    const width = sceneContext.scale.width;
    const height = sceneContext.scale.height;
    
    // 2. ì´ë¯¸ì§€ ìŠ¤ì¼€ì¼ ì´ˆê¸°í™” (ê³„ì‚° ì˜¤ë¥˜ ë°©ì§€)
    image.setScale(1);
    
    // 3. ë¹„ìœ¨ ê³„ì‚° (ê°€ë¡œ/ì„¸ë¡œ ì¤‘ ë” ë§ì´ ëŠ˜ë ¤ì•¼ í•˜ëŠ” ìª½ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŒ)
    const scaleX = width / image.width;
    const scaleY = height / image.height;
    const scale = Math.max(scaleX, scaleY);
    
    // 4. ì ìš© (ì¤‘ì•™ ì •ë ¬)
    image.setScale(scale).setScrollFactor(0);
    image.setPosition(width / 2, height / 2);
}

// [í•µì‹¬] ë¸Œë¼ìš°ì € ê¸°ë³¸ alertë¥¼ ì»¤ìŠ¤í…€ í•¨ìˆ˜ë¡œ ë®ì–´ì“°ê¸° (ì˜¤ë²„ë¼ì´ë”©)
window.alert = function(message) {
    const overlay = document.getElementById('custom-alert-overlay');
    const msgBox = document.getElementById('custom-alert-msg');
    
    // ì¤„ë°”ê¿ˆ ë¬¸ì(\n)ë¥¼ HTML íƒœê·¸(<br>)ë¡œ ë³€í™˜
    msgBox.innerHTML = message.replace(/\n/g, '<br>');
    
    // í™”ë©´ì— í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
    overlay.classList.add('alert-active');
    
    // íš¨ê³¼ìŒ ì¬ìƒ (ì„ íƒì‚¬í•­)
    if(typeof isSoundOn !== 'undefined' && isSoundOn && typeof soundClick !== 'undefined') {
        // soundClick.play(); // í•„ìš”í•˜ë©´ ì£¼ì„ í•´ì œ
    }
};

window.closeCustomAlert = function() {
    const overlay = document.getElementById('custom-alert-overlay');
    overlay.classList.remove('alert-active');
};
// [NEW] ê³µë°±ê¸°(ì·¨ì¤€ìƒ) ì”ì†Œë¦¬ ëŒ€ì‚¬ (ì´ ì½”ë“œëŠ” ìŠ¤í¬ë¦½íŠ¸ ìœ„ìª½ì— ë‘ì„¸ìš”)
const naggingMsgs = [
    "ì˜†ì§‘ ì² ìˆ˜ëŠ” ì´ë²ˆì— Sì „ì ë“¤ì–´ê°”ë‹¤ë”ë¼... (ë¹„êµ ë‹¹í•¨)",
    "ë„ˆ ì–¸ì œê¹Œì§€ ì»´í“¨í„°ë§Œ ë¶™ì¡ê³  ìˆì„ ê±°ë‹ˆ? (ë“±ì§ ìŠ¤ë§¤ì‹±)",
    "ì˜¬í•´ ì¶”ì„ì—ëŠ” í°ì§‘ ë‚´ë ¤ê°€ì§€ ë§ì. ì—„ë§ˆê°€ ì°½í”¼í•´ì„œ ê·¸ë˜.",
    "ë‚˜ì´ê°€ ëª‡ì¸ë° ì•„ì§ë„ ìš©ëˆ íƒ€ë ¹ì´ë‹ˆ? (íŒ©íŠ¸ í­ë ¥)",
    "ëˆ„êµ¬ëŠ” ë²Œì¨ ëŒ€ë¦¬ ë‹¬ì•˜ë‹¤ë˜ë°... ë„Œ ê³„íšì´ ìˆë‹ˆ?",
    "ì¼ ì•ˆ í•  ê±°ë©´ ê¸°ìˆ ì´ë¼ë„ ë°°ì›Œë¼..."
];
  // [Ver 78.0 Update] ë©´ì ‘ ì§ˆë¬¸ ë°ì´í„° ëŒ€í­ í™•ì¥ (ì´ 15ì¢…)
const interviewData = [
    // ----------------------------------------------------
    // [ê¸°ì¡´ ì§ˆë¬¸: ì—…ë¬´ ìŠ¤íƒ€ì¼]
    // ----------------------------------------------------
    {
        q: "ë§ˆê°ì´ ì½”ì•ì¸ë°, ë” íšê¸°ì ì¸ ì•„ì´ë””ì–´ê°€ ë– ì˜¬ëë‹¤ë©´?",
        a: [
            { text: "ì¼ë‹¨ ë§ˆê°ì„ ì§€í‚¤ëŠ” ê²Œ í”„ë¡œì…ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:5, S:-2} },
            { text: "íŒ€ì„ ì„¤ë“í•´ì„œë¼ë„ ì ìš©í•´ë´…ë‹ˆë‹¤.", type: 'P', effect: {P:6, L:-2, S:0} },
            { text: "ë‹¤ìŒ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ ë©”ëª¨í•´ë‘¡ë‹ˆë‹¤.", type: 'S', effect: {P:-2, L:2, S:4} }
        ]
    },
    {
        q: "ë‹¨ìˆœ ë°˜ë³µ ì‘ì—…(ëˆ„ë¼ ë”°ê¸°)ë§Œ ê³„ì† ì£¼ì–´ì§„ë‹¤ë©´?",
        a: [
            { text: "ìë™í™” íˆ´ì´ë‚˜ íš¨ìœ¨ì  ë°©ë²•ì„ ì°¾ìŠµë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:0} },
            { text: "ê¸°ì´ˆë¥¼ ë‹¤ì§€ëŠ” ê³¼ì •ì´ë¼ ìƒê°í•˜ê³  ë²„íŒë‹ˆë‹¤.", type: 'P', effect: {P:6, L:0, S:-2} },
            { text: "ì‘ì—…í•˜ë©° ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ì„ ì—°êµ¬í•´ë´…ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:-2, S:6} }
        ]
    },
    
    // ----------------------------------------------------
    // [ì‹ ê·œ ì§ˆë¬¸: í˜‘ì—… & ì»¤ë®¤ë‹ˆì¼€ì´ì…˜]
    // ----------------------------------------------------
    {
        q: "ê°œë°œìê°€ 'ì´ ë””ìì¸ì€ êµ¬í˜„ ë¶ˆê°€ëŠ¥í•´ìš”'ë¼ê³  í•œë‹¤ë©´?",
        a: [
            { text: "ì™œ ì•ˆ ë˜ëŠ”ì§€ ê¸°ìˆ ì  ì´ìœ ë¥¼ ë¬¼ì–´ë´…ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:7, S:-2} }, // ë…¼ë¦¬ì  ì ‘ê·¼
            { text: "ìµœëŒ€í•œ ë¹„ìŠ·í•œ íƒ€í˜‘ì ì„ ì œì•ˆí•©ë‹ˆë‹¤.", type: 'S', effect: {P:-2, L:2, S:5} }, // ìœ ì—°í•¨
            { text: "êµ¬í˜„ ê°€ëŠ¥í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¾ì•„ ì„¤ë“í•©ë‹ˆë‹¤.", type: 'P', effect: {P:5, L:0, S:0} }  // ëˆê¸°
        ]
    },
    {
        q: "ë§ˆì¼€í„°ê°€ 'ë¡œê³  ì¢€ ë” í¬ê²Œ, ë¹¨ê°›ê²Œ'ë¥¼ ìš”êµ¬í•œë‹¤ë©´?",
        a: [
            { text: "ë””ìì¸ ê°€ì´ë“œë¥¼ ê·¼ê±°ë¡œ ë°©ì–´í•©ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:-2} },
            { text: "ìš”êµ¬ì‚¬í•­ì„ ë°˜ì˜í•˜ë˜, ë¯¸ì ìœ¼ë¡œ ë‹¤ë“¬ìŠµë‹ˆë‹¤.", type: 'S', effect: {P:-2, L:-2, S:8} }, // ì••ë„ì  ì„¼ìŠ¤
            { text: "Aì•ˆ, Bì•ˆì„ ëª¨ë‘ ë§Œë“¤ì–´ ë¹„êµí•´ì¤ë‹ˆë‹¤.", type: 'P', effect: {P:6, L:0, S:-2} } // ì—´ì • ë…¸ë™
        ]
    },
    {
        q: "íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ë¬´ì„ìŠ¹ì°¨í•˜ëŠ” ë™ë£Œê°€ ìˆë‹¤ë©´?",
        a: [
            { text: "ì œê°€ ê·¸ ì‚¬ëŒ ëª«ê¹Œì§€ ë‹¤ í•©ë‹ˆë‹¤.", type: 'P', effect: {P:7, L:-3, S:0} }, // í˜¸êµ¬? ì—´ì •?
            { text: "ì—…ë¬´ ë¶„ì¥í‘œë¥¼ ëª…í™•íˆ í•˜ì—¬ ì±…ì„ì„ ë¬»ìŠµë‹ˆë‹¤.", type: 'L', effect: {P:-2, L:7, S:0} },
            { text: "ìˆ  í•œì” ì‚¬ì£¼ë©° ë™ê¸°ë¶€ì—¬ë¥¼ í•´ì¤ë‹ˆë‹¤.", type: 'S', effect: {P:2, L:-2, S:5} } // ì‚¬íšŒìƒí™œ ì„¼ìŠ¤
        ]
    },

    // ----------------------------------------------------
    // [ì‹ ê·œ ì§ˆë¬¸: ë©˜íƒˆ & ê°€ì¹˜ê´€]
    // ----------------------------------------------------
    {
        q: "ìš°ë¦¬ íšŒì‚¬ì˜ ë‹¨ì ì´ ë¬´ì—‡ì´ë¼ê³  ìƒê°í•˜ë‚˜ìš”?",
        a: [
            { text: "ë‹¨ì ì€ ì—†ê³ , ì„±ì¥ ê°€ëŠ¥ì„±ë§Œ ë³´ì…ë‹ˆë‹¤!", type: 'P', effect: {P:5, L:-5, S:-2} }, // ì•„ë¶€ì„±
            { text: "UIì˜ í†µì¼ì„±ì´ ì¡°ê¸ˆ ë¶€ì¡±í•´ ë³´ì…ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:0} }, // ëƒ‰ì² í•œ ë¶„ì„
            { text: "ë¸Œëœë“œ ì»¬ëŸ¬ê°€ ì¡°ê¸ˆ ì˜¬ë“œí•œ ëŠë‚Œì…ë‹ˆë‹¤.", type: 'S', effect: {P:-2, L:0, S:6} } // ê°ê°ì  ì§€ì 
        ]
    },
    {
        q: "ì—°ë´‰ê³¼ ì›Œë¼ë°¸, ë¬´ì—‡ì´ ë” ì¤‘ìš”í•œê°€ìš”?",
        a: [
            { text: "íšŒì‚¬ê°€ ì„±ì¥í•œë‹¤ë©´ ì•¼ê·¼ë„ ì¦ê²ìŠµë‹ˆë‹¤.", type: 'P', effect: {P:8, L:0, S:-3} }, // ê´‘ê¸°
            { text: "íš¨ìœ¨ì ìœ¼ë¡œ ì¼í•˜ê³  ì •ì‹œ í‡´ê·¼í•˜ëŠ” ê²Œ ìµœê³ ì£ .", type: 'L', effect: {P:-3, L:7, S:0} },
            { text: "ëˆ ë§ì´ ì£¼ëŠ” ê³³ì´ ê³§ ë³µì§€ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:3, S:4} } // ì†”ì§í•¨
        ]
    },
    {
        q: "í´ë¼ì´ì–¸íŠ¸ê°€ 'ê·¸ëƒ¥ ì•Œì•„ì„œ ì˜ˆì˜ê²Œ í•´ì£¼ì„¸ìš”'ë¼ê³  í•œë‹¤ë©´?",
        a: [
            { text: "ì œ ê°ê°ì„ ë¯¿ê³  ì‹œì•ˆì„ ë§Œë“­ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:-3, S:7} },
            { text: "êµ¬ì²´ì ì¸ ì§ˆë¬¸ì„ ë˜ì ¸ ì˜ë„ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:0} },
            { text: "ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ë¡œ 5ê°œ ì •ë„ ì¤€ë¹„í•´ê°‘ë‹ˆë‹¤.", type: 'P', effect: {P:6, L:-2, S:0} }
        ]
    },

    // ----------------------------------------------------
    // [ì‹ ê·œ ì§ˆë¬¸: ëŒë°œ ìƒí™©]
    // ----------------------------------------------------
    {
        q: "ì¸ì‡„ë¬¼ 1ë§Œ ì¥ì„ ì°ì—ˆëŠ”ë° ì˜¤íƒ€ë¥¼ ë°œê²¬í–ˆë‹¤ë©´?",
        a: [
            { text: "ì œ ì‚¬ë¹„ë¡œë¼ë„ ìŠ¤í‹°ì»¤ë¥¼ ì œì‘í•´ ë¶™ì´ê² ìŠµë‹ˆë‹¤.", type: 'P', effect: {P:8, L:-2, S:0} }, // ì±…ì„ê°
            { text: "ì˜¤íƒ€ê°€ ì•„ë‹ˆë¼ ë””ìì¸ì  í—ˆìš©ì´ë¼ê³  ìš°ê¹ë‹ˆë‹¤.", type: 'S', effect: {P:-5, L:-5, S:8} }, // ë¯¸ì¹œ ì„¼ìŠ¤?
            { text: "ì¦‰ì‹œ ë³´ê³ í•˜ê³  ìˆ˜ìŠµ ë¹„ìš©ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:0} } // ì •ì„
        ]
    },
    {
        q: "íƒ•ë¹„ì‹¤ì— ê°„ì‹ì´ ë‹¤ ë–¨ì–´ì¡Œë‹¤ë©´?",
        a: [
            { text: "ì œ ê°œì¸ ì¹´ë“œë¡œ ì±„ì›Œ ë„£ìŠµë‹ˆë‹¤.", type: 'P', effect: {P:5, L:-3, S:0} },
            { text: "ì´ë¬´íŒ€ì— ì •ì‹ìœ¼ë¡œ ìš”ì²­ ë©”ì¼ì„ ë³´ëƒ…ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:5, S:0} },
            { text: "ë°°ê³ í””ì„ ìŠ¹í™”ì‹œì¼œ ë””ìì¸ì— ë…¹ì—¬ëƒ…ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:0, S:6} } // ì˜ˆìˆ í˜¼
        ]
    },
    {
        q: "ë‚´ì¼ ì§€êµ¬ê°€ ë©¸ë§í•œë‹¤ë©´ ì˜¤ëŠ˜ ë¬´ì—‡ì„ ë””ìì¸í•˜ê² ë‚˜?",
        a: [
            { text: "ì§€êµ¬ íƒˆì¶œìš© ìš°ì£¼ì„  UIë¥¼ ê·¸ë¦¬ê² ìŠµë‹ˆë‹¤.", type: 'L', effect: {P:0, L:5, S:3} },
            { text: "ë§ˆì§€ë§‰ê¹Œì§€ íšŒì‚¬ ë¡œê³ ë¥¼ ë‹¤ë“¬ê² ìŠµë‹ˆë‹¤.", type: 'P', effect: {P:10, L:-5, S:0} }, // ê´‘ê¸°
            { text: "'ì§€êµ¬ ë§ˆê° ì„¸ì¼' í¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.", type: 'S', effect: {P:0, L:0, S:8} } // ìœ„íŠ¸
        ]
    },
    {
        q: "ë””ìì´ë„ˆì—ê²Œ ê°€ì¥ í•„ìš”í•œ ë„êµ¬ëŠ”?",
        a: [
            { text: "ìµœì‹ í˜• ë§¥ë¶ê³¼ íƒ€ë¸”ë ›ì…ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:5, S:0} }, // ì¥ë¹„ë¹¨
            { text: "êº¾ì´ì§€ ì•ŠëŠ” ë§ˆìŒ(ì¤‘ë§ˆ)ì…ë‹ˆë‹¤.", type: 'P', effect: {P:7, L:0, S:0} },
            { text: "ì˜ê°ì„ ì£¼ëŠ” í•€í„°ë ˆìŠ¤íŠ¸ì…ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:0, S:6} }
        ]
    },
    {
        q: "ìƒì‚¬ê°€ ì´ŒìŠ¤ëŸ¬ìš´ í°íŠ¸(êµ´ë¦¼ì²´)ë¥¼ ì“°ë¼ê³  ê°•ìš”í•œë‹¤ë©´?",
        a: [
            { text: "ìƒì‚¬ì˜ ì·¨í–¥ì„ ì¡´ì¤‘í•´ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤.", type: 'P', effect: {P:4, L:0, S:-4} }, // ì‚¬íšŒìƒí™œ
            { text: "êµ´ë¦¼ì²´ë„ í™í•˜ê²Œ ë³´ì´ë„ë¡ ë ˆì´ì•„ì›ƒì„ ì§­ë‹ˆë‹¤.", type: 'S', effect: {P:0, L:0, S:8} }, // ëŠ¥ë ¥ì
            { text: "ê°€ë…ì„± ë°ì´í„°ë¥¼ ê·¼ê±°ë¡œ ë‹¤ë¥¸ í°íŠ¸ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.", type: 'L', effect: {P:0, L:6, S:0} }
        ]
    }
];

        const GameConfig = { initialMoney: 500000, workCost: 5000, workStamina: 30, deadlineRange: [16, 24], crisisChance: 0.03 };
const shopItems = [
    // [Tier 1~3: ê¸°ì¡´ 100% ìœ ì§€]
    {id:1, name:"ê¸°ë³¸ ë§ˆìš°ìŠ¤", cost:10000, power:1.5, img:"item_mouse_basic.png", desc:"ë‹¤ì´ì†Œ ì—ë””ì…˜"}, 
    {id:2, name:"ê²Œì´ë° ë§ˆìš°ìŠ¤", cost:50000, power:2, img:"item_mouse_game.png", desc:"RGB ê°ì„±"}, 
    {id:3, name:"ë§¤ì§ íŠ¸ë™íŒ¨ë“œ", cost:150000, power:3, img:"item_trackpad.png", desc:"ì†ëª© ë³´í˜¸"}, 
    {id:4, name:"ì™€ì½¤ íƒ€ë¸”ë ›", cost:300000, power:4, img:"item_wacom.png", desc:"ì…ë¬¸ìš©"}, 
    {id:5, name:"ì•¡ì • íƒ€ë¸”ë ›", cost:800000, power:6, img:"item_tablet_l.png", desc:"í™”ë©´ ê·¸ë¦¬ê¸°"}, 
    {id:6, name:"ì•„ì´íŒ¨ë“œ í”„ë¡œ", cost:1200000, power:7, img:"item_ipad.png", desc:"ìŠ¤ë²… ì…ì¥ê¶Œ"}, 
    {id:7, name:"ì»¤ë¸Œë“œ ëª¨ë‹ˆí„°", cost:2000000, power:9, img:"item_monitor.png", desc:"ëª°ì…ê° ìµœê°•"}, 
    {id:8, name:"ì•„ì´ë§¥ í”„ë¡œ", cost:5000000, power:12, img:"item_imac.png", desc:"ì „ë¬¸ê°€ ë„êµ¬"}, 
    {id:9, name:"í—ˆë¨¼ë°€ëŸ¬ ì˜ì", cost:10000000, power:20, img:"item_chair.png", desc:"êµ¬ë¦„ ìœ„"},

    // [Tier 4: Global êµ¬ê°„ (ì£¼ê¸‰ 1,500ë§Œ)]
    // ëª©í‘œ: 4ì£¼ ~ 40ì£¼(10ë‹¬) ì €ì¶•
    {id:10, name:"ê°œì¸ ë¹„ì„œ ê³ ìš©", cost:60000000, power:120, img:"char_secretary.png", desc:"ìŠ¤ì¼€ì¤„ ê´€ë¦¬ í˜ëª… (6ì²œë§Œ)"},
    {id:11, name:"ê³ ê¸‰ ì„¸ë‹¨", cost:200000000, power:250, img:"item_luxury_sedan.png", desc:"ë„ë¡œ ìœ„ì˜ ì •ìˆ™í•¨ (2ì–µ)"},
    {id:12, name:"ê°•ë‚¨ ì˜¤í”¼ìŠ¤í…” ì „ì„¸", cost:600000000, power:500, img:"bg_studio_apartment.png", desc:"ì§ì£¼ê·¼ì ‘ ì‹¤í˜„ (6ì–µ)"},
    {id:13, name:"ìŠˆí¼ì¹´", cost:1500000000, power:800, img:"item_supercar.png", desc:"ì••ë„ì  í•˜ì°¨ê° (15ì–µ)"},

    // [Tier 5: Space êµ¬ê°„ (ì£¼ê¸‰ 1.5ì–µ)]
    // ëª©í‘œ: 30ì£¼ ~ 200ì£¼(4ë…„) ì €ì¶• -> ì§„ì •í•œ ì—”ë“œ ì½˜í…ì¸ 
    {id:14, name:"ê°œì¸ ì „ì„¸ê¸°", cost:5000000000, power:2000, img:"item_private_jet.png", desc:"í•´ì™¸ ë¯¸íŒ… ë‹¹ì¼ì¹˜ê¸° (50ì–µ)"},
    {id:15, name:"ê°œì¸ìš© ì–‘ì ì»´í“¨í„°", cost:10000000000, power:5000, img:"item_quantum_pc.png", desc:"ë Œë”ë§ ì‹œê°„ 0ì´ˆ (100ì–µ)"},
    {id:16, name:"AI ìˆ˜íŠ¸ 'Mark PD'", cost:20000000000, power:10000, img:"item_design_suit.png", desc:"ìë¹„ìŠ¤ íƒ‘ì¬ (200ì–µ)"},
    {id:17, name:"ë‹¬ ê¸°ì§€ ë³„ì¥", cost:30000000000, power:25000, img:"bg_moon_base.png", desc:"ì§€êµ¬ê°€ ë„ˆë¬´ ì¢ë‹¤ (300ì–µ)"}
];
const msgs = { 
    // [ê¸°ì¡´ ì—…ë¬´ ë©˜íŠ¸ ìœ ì§€]
    work: [
        "1í”½ì…€ì˜ ë¯¸í•™(ê³ ë¬¸) ì‹¤ì²œ ì¤‘", "ìµœì¢…_ì§„ì§œìµœì¢…_ì´ê²Œì§„ì§œ.fig", "í™”ë ¤í•˜ì§€ë§Œ ì‹¬í”Œí•˜ê²Œ(??)", 
        "ë¡œê³  í¬ê²Œ, ì—¬ë°± ë§ì´.. í•˜..", "ìˆ¨ ì‰¬ë“¯ì´ Ctrl+S", "ëˆ„ë¼ ë”°ë‹¤ ì˜í˜¼ ê°€ì¶œ", 
        "ë ˆì´ì–´ ì •ë¦¬... ë‚˜ì¤‘ì— í•˜ì", "ì´ ì‹œì•ˆì€ íœ´ì§€í†µí–‰ í™•ì •", "ë„µ, ë„µ, ë„µë¬´ìƒˆ ëª¨ë“œ", 
        "ê¸ˆìœµì¹˜ë£Œ(ì›”ê¸‰) ì‹œê¸‰í•¨", "íƒ€ì ì†Œë¦¬ë¡œ ì—´ì¼ ì—°ê¸° ì¤‘", "ì ì‹¬ ë©”ë‰´ ê³ ë¯¼ì´ ì£¼ì—…ë¬´", 
        "í‡´ê·¼ ë§ˆë µë‹¤(ì¶œê·¼ 10ë¶„ì°¨)", "í˜ˆê´€ì— ì¹´í˜ì¸ ìˆ˜í˜ˆ ì¤‘", "ê±°ë¶ëª© êµì •ê¸° ê²€ìƒ‰ ì¤‘", 
        "ë¡œë˜ ë‹¹ì²¨ë˜ë©´ ë­í• ê¹Œ", "ê°œë°œíŒ€ì´ë‘ í˜‘ì˜ ì¤‘", "UX í•‘ê³„ë¡œ ë””ìì¸ í‰ì¹˜ê¸°", 
        "ë ˆí¼ëŸ°ìŠ¤ ì°¾ë‹¤ ì‡¼í•‘í•¨", "ì´ê±´ ê¸°íšë¶€í„° ê¼¬ì˜€ëŠ”ë°", "ì• ìì¼í•˜ê²Œ ê°ˆì•„ì—ëŠ” ì¤‘"
    ],
    // [ê¸°ì¡´ ì•Œë°” ë©˜íŠ¸ ìœ ì§€]
    alba: [
        "ì–´ì„œì˜¤ì„¸ìš”~ (ìë³¸ì£¼ì˜ ë¯¸ì†Œ ì¥ì°©)ğŸ˜ƒ", "ì•„ì•„ 4ì” ë‚˜ì™”ìŠµë‹ˆë‹¤~ (ëª© ì•„í””)",
        "ì„¤ê±°ì§€ ì‚°ë”ë¯¸...ğŸ˜­", "ì§„ìƒ ì†ë‹˜ ë“±ì¥... ì°¸ì•„ë¼ ë‚˜ì˜ ì¸ë‚´ì‹¬",
        "ì´ ëˆ ëª¨ì•„ì„œ ë“œë¦¼ì¹´... ì•„ë‹ˆ ë§¥ë¶ ì‚°ë‹¤ ğŸ’»", "ì‚¬ì¥ë‹˜ ëˆˆì¹˜ ë³´ëŠ” ì¤‘ (ë†ë•¡ì´ ì•„ë‹˜)",
        "ìƒ· ì¶”ê°€ ìŠì§€ ë§ì... ì§‘ì¤‘í•´!", "ì˜¤ëŠ˜ ë§¤ì¶œ ëŒ€ë°•ì´ë„¤ (ë‚´ ëˆ ì•„ë‹˜)",
        "ë‹¤ë¦¬ê°€ í‰í‰ ë¶“ëŠ”ë‹¤...", "ë§ˆê° ì²­ì†Œ ë¹¡ì„¸ë„¤",
        "ì†ë‹˜, ì£¼ë¬¸í•˜ì‹œê² ì–´ìš”? (ê²°ì •ì¥ì•  ì˜¤ì‹¬)", "ì§„ë™ë²¨ ìš¸ë ¤ë„ ì™œ ì•ˆ ì˜¤ì‹œë‚˜ìš”..."
    ],
    // [ê¸°ì¡´ ê³µë¶€ ë©˜íŠ¸ ìœ ì§€]
    study: [
        "ë””í”„ë ™ ê°•ì˜ ìµœê³ ! ğŸ‘", "ë‚´ ì—°ë´‰ì´ ë†’ì•„ì§€ëŠ” ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤ ğŸ’°",
        "íŠ¸ë Œë“œë¥¼ ì«“ì§€ ë§ˆë¼, ë¦¬ë“œí•˜ë¼", "ë¯¸ë˜ì˜ ë””ìì¸ ë¦¬ë“œëŠ” ë°”ë¡œ ë‚˜!",
        "ê°€ì¥ ê°•ë ¥í•œ ë¬´ê¸°ëŠ” ì‹¤ë ¥ì…ë‹ˆë‹¤", "ì„±ì¥í•˜ëŠ” ë‚´ ëª¨ìŠµ... ì œë²• ë©‹ì§ˆì§€ë„? âœ¨",
        "ë‹¨ì¶•í‚¤ ë§ˆìŠ¤í„°! ì´ì œ ì†ë„ 3ë°° ë¹ ë¦„", "ì´ê±° ë°°ìš°ë©´ íŒ€ì¥ë‹˜ë„ ê¹œì§ ë†€ë¼ì‹œê² ì§€?",
        "ìƒˆë¡œìš´ íˆ´? í›—, ì£¼ë§ ì•ˆì— ë§ˆìŠ¤í„°í•´ì£¼ë§ˆ", "ë‡Œê°€ ì„¹ì‹œí•´ì§€ëŠ” ì¤‘...",
        "ì˜¤ëŠ˜ ë°°ìš´ ìŠ¤í‚¬, ë‚´ì¼ ë°”ë¡œ ì¨ë¨¹ëŠ”ë‹¤!", "ì£¼ë§ì—” ì—­ì‹œ ìê¸°ê³„ë°œì´ì§€!"
    ],
    // [ê¸°ì¡´ í¬í´ ë©˜íŠ¸ ìœ ì§€]
    pf: ["ìµœì¢…_ì§„ì§œìµœì¢….psd", "ë ˆì´ì–´ ì´ë¦„ ì •ë¦¬ ì¢€...", "1í”½ì…€ë§Œ ì™¼ìª½ìœ¼ë¡œ...", "ì´ê²Œ_ì§„ì§œ_ë§ˆì§€ë§‰.zip", "ì˜í˜¼ì„ ê°ˆì•„ë„£ëŠ” ì¤‘", "ë§ˆê° 1ì‹œê°„ ì „!!!", "í´ë¼ì´ì–¸íŠ¸ ë¹™ì˜ ì¤‘", "ìƒ‰ê°ì´ ì™œ ì´ë˜?", "ë°¤ìƒ˜ì˜ ìš”ì • ì¶œëª°", "Ctrl+Z ë¬´í•œ ë°˜ë³µ", "ì œë°œ ì˜¤íƒ€ ì—†ì–´ë¼", "ë‚  ë§‰ì„ ìˆ˜ ì—†ìœ¼ì…ˆ"],

    // â–¼â–¼â–¼ [NEW] Phase 1: í¬ë§ì°¬ ì·¨ì¤€ìƒ ë©˜íŠ¸ (20ì¢…) â–¼â–¼â–¼
    idle_p1: [
        "í•©ê²© ì „í™”ê°€ ì˜¬ ê²ƒ ê°™ì€ ê¸°ë¶„ ì¢‹ì€ ì˜ˆê°!",
        "ì´ í¬íŠ¸í´ë¦¬ì˜¤... ì†”ì§íˆ ë‚´ê°€ ë´ë„ ëª…ì‘ì¸ë°?",
        "ë‚œ ë  ë†ˆì´ë‹¤! ìš°ì£¼ê°€ ë‚˜ë¥¼ ë•ê³  ìˆì–´!",
        "ì—°ë´‰ í˜‘ìƒí•  ë•Œ ë‹¤ë¦¬ ê¼¬ê³  ì•‰ì•„ë³¼ê¹Œ? (ê¹€ì¹«êµ­)",
        "ë‚˜ì¤‘ì— ìœ ëª…í•´ì§€ë©´ ì‚¬ì¸ì€ ì–´ë–»ê²Œ í•˜ì§€?",
        "ì˜¤ëŠ˜ ì ì‹¬ì€ ë§›ìˆëŠ” ê±° ë¨¹ê³  í˜ë‚´ì!",
        "ê¿ˆì€ í¬ê²Œ ê°€ì§€ë¬ì–´. ëª©í‘œëŠ” Space ê¸°ì—…!",
        "ê³§ ë””ìì¸ê³„ì— ë‚´ ì´ë¦„ì„ ë–¨ì¹  ê±°ì•¼.",
        "ì²« ì›”ê¸‰ íƒ€ë©´ ë¶€ëª¨ë‹˜ ë‚´ë³µë¶€í„°... ì•„ë‹ˆ ë§¥ë¶ë¶€í„°?",
        "ë‚´ ê°ê°ì€ ì•„ì§ ì‚´ì•„ìˆì–´! í„ë–¡í„ë–¡!",
        "ì˜¤ëŠ˜ë”°ë¼ ì»¨ë””ì…˜ ìµœê³ ì¡°! ë‹¤ ë¤ë²¼!",
        "ë”± ë§ëŠ” íšŒì‚¬ê°€ ë‚˜ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì„ ê±°ì•¼.",
        "ë©´ì ‘ ë³µì¥ì€... ìŠ¤í‹°ë¸Œ ì¡ìŠ¤ ìŠ¤íƒ€ì¼?",
        "ìœ íŠœë¸Œë¡œ ë””ìì¸ íŠ¸ë Œë“œ ì •ì£¼í–‰ ì™„ë£Œ!",
        "í¬ê¸°ë€ ë°°ì¶” ì…€ ë•Œë‚˜ ì“°ëŠ” ë§ì´ì§€.",
        "ë‚´ ë¯¸ë˜ ëª…í•¨ì„ ìƒìƒí•´ë³´ëŠ” ì¤‘... âœ¨",
        "ì–¸ì  ê°€ ë‚˜ë§Œì˜ ë¸Œëœë“œë¥¼ ë§Œë“¤ ê±°ì•¼!",
        "ì§€ê¸ˆ í˜ë¦° ë•€ë°©ìš¸ì´ ë¯¸ë˜ì˜ ì—°ë´‰ì´ ëœë‹¤!",
        "ì„¸ìƒì€ ë„“ê³  ê°ˆ íšŒì‚¬ëŠ” ë§ë‹¤. ê°€ì!",
        "ê¸ì •ì˜ í˜! ë‚˜ëŠ” ë¬´ì¡°ê±´ ì„±ê³µí•œë‹¤!"
    ],

    // â–¼â–¼â–¼ [NEW] Phase 2: ì„±ê³µí•œ ì§ì¥ì¸ ë©˜íŠ¸ (20ì¢…) â–¼â–¼â–¼
    idle_p2: [
        "ì˜¤ëŠ˜ ì—…ë¬´ ì™ ì§€ ìˆ ìˆ  í’€ë¦¬ëŠ”ë°? ë‚˜ ì²œì¬ì¸ê°€?",
        "ì›”ê¸‰ë‚ ì—” ë¬´ì¡°ê±´ í•œìš° ì˜¤ë§ˆì¹´ì„¸ ê°„ë‹¤!",
        "ì„±ê³¼ê¸‰ ë°›ìœ¼ë©´ ìœ ëŸ½ ì—¬í–‰ ê°€ì•¼ì§€~ âœˆï¸",
        "ì¹¼í‡´í•˜ê³  ì·¨ë¯¸ ìƒí™œ ì¢€ ì¦ê²¨ë³¼ê¹Œ?",
        "ìš°ë¦¬ íšŒì‚¬ ì—ì´ìŠ¤? ê·¸ê±´ ë°”ë¡œ ë‚˜!",
        "ìŠ¹ì§„ì´ ëˆˆì•ì— ë³´ì¸ë‹¤ ë³´ì—¬! (ì•¼ë§)",
        "ì˜¤ëŠ˜ ì ì‹¬ ë©”ë‰´ ì´ˆì´ìŠ¤... ì™„ë²½í–ˆì–´.",
        "ì‚¬ì¥ë‹˜ì´ ë‚  íë­‡í•˜ê²Œ ë³´ì‹œëŠ” ê²ƒ ê°™ì•„ (ì°©ê°?)",
        "ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ëŒ€ë°• ëƒ„ìƒˆê°€ ë‚œë‹¤.",
        "ë‘ë‘‘í•œ í†µì¥ ì”ê³ ë¥¼ ë³´ë‹ˆ í˜ì´ ì†ŸëŠ”ë‹¤!",
        "ëª¨ë‹ ì»¤í”¼ í•œ ì”ì˜ ì—¬ìœ ... ì´ê²Œ ì„±ê³µí•œ ì‚¶ì´ì§€.",
        "ë‚´ë…„ì—” ì—°ë´‰ ì•ìë¦¬ê°€ ë¬´ì¡°ê±´ ë°”ë€ë‹¤!",
        "ì£¼ë§ì— ë­ í•˜ê³  ë†€ì§€? ë²Œì¨ ì„¤ë Œë‹¤!",
        "ë‹¨ì¶•í‚¤ê°€ ì†ì— ì°©ì°© ê°ê¸°ëŠ”êµ¬ë§Œ.",
        "ë‚´ ë””ìì¸ì´ ì„¸ìƒì„ ë°”ê¿€ì§€ë„ ëª°ë¼.",
        "ì´ ì •ë„ í€„ë¦¬í‹°ë©´ íŒ€ì¥ë‹˜ë„ ê¸°ë¦½ë°•ìˆ˜ ì¹  ë“¯?",
        "ì˜¤ëŠ˜ë”°ë¼ ë‚´ê°€ ì¢€ ë©‹ì ¸ ë³´ì´ëŠ”ë°? (ìì•„ë„ì·¨)",
        "ì €ë…ì— í…Œë‹ˆìŠ¤ë‚˜ í•œ ê²Œì„ ì¹˜ëŸ¬ ê°ˆê¹Œ?",
        "ë‹¤ìŒ íœ´ê°€ëŠ” ë‹¬ ê¸°ì§€ ë³„ì¥ìœ¼ë¡œ ê°€ë³¼ê¹Œ?",
        "ìì‚°ì´ ëŠ˜ì–´ë‚˜ëŠ” ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤. ğŸ’°"
    ]
};
// [1] í´ë¼ì´ì–¸íŠ¸ ë©˜íŠ¸ ë°ì´í„°
const clientMentions = [
    "ì‹¬í”Œí•œë° í™”ë ¤í•˜ê²Œ í•´ì£¼ì„¸ìš”. ëŠë‚Œ ì•„ì‹œì£ ?",
    "ì—¬ë°±ì€ ì¢‹ì€ë° ê½‰ ì°¨ ë³´ì´ê²Œ í•´ì£¼ì„¸ìš”.",
    "ë¡œê³  ì¢€ ë” í‚¤ì›Œì£¼ì„¸ìš”. (10ë²ˆì§¸ ìš”ì²­)",
    "ì €í¬ ì¡°ì¹´ê°€ í¬í† ìƒµì„ ì¢€ í•˜ëŠ”ë°...",
    "ì´ ìƒ‰ê¹” ë§ê³  'ëœ¨ê±°ìš´ ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸' ìƒ‰ìœ¼ë¡œìš”.",
    "ì¼ë‹¨ ì‹œì•ˆ 10ê°œë§Œ ë¨¼ì € ë³¼ê¹Œìš”?",
    "ìš”ì¦˜ ìŠ¤íƒ€ì¼ë¡œ í™í•˜ê²Œ ë¶€íƒí•´ìš”.",
    "ë‚´ì¼ ì•„ì¹¨ê¹Œì§€ ë¬´ì¡°ê±´ ë©ë‹ˆë‹¤. ê·¸ì£ ?",
    "ì˜ˆì‚°ì€ ì—†ì§€ë§Œ í€„ë¦¬í‹°ëŠ” ëŒ€ê¸°ì—…ì²˜ëŸ¼!"
];
  const companyPool = { 
    // [1. Agency: í—ê·¸ë¦¬ ì •ì‹  & ê¸°ì´ˆ ì²´ë ¥]
    agency: [
        {
            name:"Red Dot Studio", req:250, tier:'Agency', label:"ì—ì´ì „ì‹œ", 
            reqStats: { P:18, L:0, S:0 }, // [ì—´ì •] ì•¼ê·¼
            hint: "ëª©í‘œ: ë¬´ì¡°ê±´ <span style='color:#FF5F5F'>ğŸ”¥ì—´ì •</span>! ëˆê¸°ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”." 
        }, 
        {
            name:"Pixel Lab", req:260, tier:'Agency', label:"ì—ì´ì „ì‹œ", 
            reqStats: { P:12, L:12, S:0 }, // [ì—´ì •+ë…¼ë¦¬] ê³µì¥í˜• íš¨ìœ¨
            hint: "ëª©í‘œ: <span style='color:#FF5F5F'>ğŸ”¥ì„±ì‹¤í•¨</span>ê³¼ <span style='color:#3182F6'>ğŸ§ íš¨ìœ¨ì„±</span>ì„ ë™ì‹œì—!" 
        }, 
        {
            name:"Vector Corp", req:280, tier:'Agency', label:"ì—ì´ì „ì‹œ", 
            reqStats: { P:10, L:0, S:14 }, // [ì„¼ìŠ¤] ë¶€í‹°í¬
            hint: "ëª©í‘œ: ìš°ë¦¬ì—ê²Œ í•„ìš”í•œ ê±´ <span style='color:#FFD700'>âœ¨ì„¼ìŠ¤</span>ì…ë‹ˆë‹¤." 
        },
        // [New] 4. ì¹´í˜ì¸ ë””ìì¸ (ì•¼ê·¼ íŠ¹í™”)
        {
            name:"Caffeine Design", req:270, tier:'Agency', label:"ì—ì´ì „ì‹œ",
            reqStats: { P:15, L:8, S:0 }, // [ì—´ì •+ë…¼ë¦¬ ì¡°ê¸ˆ] ì¢€ë¹„ì²˜ëŸ¼ ì¼í•¨
            hint: "ëª©í‘œ: ì ë“¤ì§€ ì•ŠëŠ” <span style='color:#FF5F5F'>ğŸ”¥ì²´ë ¥</span>ì„ ë´…ë‹ˆë‹¤."
        },
        // [New] 5. Ctrl+C (ì¹´í”¼ìº£)
        {
            name:"Ctrl+C Corp", req:250, tier:'Agency', label:"ì—ì´ì „ì‹œ",
            reqStats: { P:5, L:5, S:15 }, // [ì„¼ìŠ¤] ì˜ ë² ë¼ëŠ” ê²ƒë„ ëŠ¥ë ¥
            hint: "ëª©í‘œ: ë¹ ë¥´ê²Œ ìºì¹˜í•˜ëŠ” <span style='color:#FFD700'>âœ¨ëˆˆì¹˜(ì„¼ìŠ¤)</span>ê°€ ìƒëª…!"
        }
    ],

    // [2. TopTier: ì„±ì¥ & ê¸°ì—… ë¬¸í™”]
    toptier: [
        {
            name:"Bamin", req:500, tier:'TopTier', label:"íƒ‘í‹°ì–´", prevRank: 1,
            reqStats: { P:10, L:0, S:15 }, // [ì„¼ìŠ¤+ì—´ì •] í‚¤ì¹˜í•¨
            hint: "ëª©í‘œ: <span style='color:#FFD700'>âœ¨ìœ„íŠ¸</span>ì™€ <span style='color:#FF5F5F'>ğŸ”¥ì£¼ë„ì„±</span>ì„ ë´…ë‹ˆë‹¤."
        }, 
        {
            name:"Karrot", req:500, tier:'TopTier', label:"íƒ‘í‹°ì–´", prevRank: 1,
            reqStats: { P:0, L:18, S:0 }, // [ë…¼ë¦¬] ì§€ì—­ ë°ì´í„°
            hint: "ëª©í‘œ: ì˜¤ì§ <span style='color:#3182F6'>ğŸ§ ë…¼ë¦¬ì ì¸</span> í•´ê²° ëŠ¥ë ¥ë§Œ ë´…ë‹ˆë‹¤."
        }, 
        {
            name:"RagZag", req:500, tier:'TopTier', label:"íƒ‘í‹°ì–´", prevRank: 1,
            reqStats: { P:0, L:12, S:12 }, // [ë…¼ë¦¬+ì„¼ìŠ¤] íŒ¨ì…˜ ë°ì´í„°
            hint: "ëª©í‘œ: <span style='color:#3182F6'>ğŸ§ ë°ì´í„°</span>ì™€ <span style='color:#FFD700'>âœ¨íŠ¸ë Œë“œ</span>ì˜ ì¡°í™”!"
        },
        // [New] 4. Never (ë„¤ì´ë²„ íŒ¨ëŸ¬ë”” - ê³µì±„ì˜ ì •ì„)
        {
            name:"Never", req:550, tier:'TopTier', label:"íƒ‘í‹°ì–´", prevRank: 1,
            reqStats: { P:12, L:12, S:0 }, // [ì—´ì •+ë…¼ë¦¬] ìœ¡ê°í˜• ì¸ì¬
            hint: "ëª©í‘œ: ê¸°ë³¸ê¸°ê°€ íƒ„íƒ„í•œ <span style='color:#3182F6'>ğŸ§ ëª¨ë²”ìƒ</span> ìŠ¤íƒ€ì¼."
        },
        // [New] 5. InstaMood (ì¸ìŠ¤íƒ€ íŒ¨ëŸ¬ë”” - ê°ì„± ì¶©ë§Œ)
        {
            name:"InstaMood", req:520, tier:'TopTier', label:"íƒ‘í‹°ì–´", prevRank: 1,
            reqStats: { P:0, L:5, S:18 }, // [ì„¼ìŠ¤ ëª°ë¹µ] 
            hint: "ëª©í‘œ: ì„¤ëª…ì´ í•„ìš” ì—†ëŠ” <span style='color:#FFD700'>âœ¨ë¹„ì£¼ì–¼ ê°ê°</span>."
        }
    ], 

    // [3. Unicorn: í˜ì‹  & ì„íŒ©íŠ¸]
    unicorn: [
        {
            name:"Tooss", req:1500, tier:'Unicorn', label:"ìœ ë‹ˆì½˜", prevRank: 2,
            reqStats: { P:14, L:14, S:0 }, // [ì—´ì •+ë…¼ë¦¬] ê¸ˆìœµ í˜ì‹ 
            hint: "ëª©í‘œ: ë¯¸ì¹œ <span style='color:#FF5F5F'>ğŸ”¥ì‹¤í–‰ë ¥</span>ê³¼ <span style='color:#3182F6'>ğŸ§ ë…¼ë¦¬</span>ê°€ í•„ìš”í•©ë‹ˆë‹¤."
        }, 
        {
            name:"Kakaa", req:1500, tier:'Unicorn', label:"ìœ ë‹ˆì½˜", prevRank: 2,
            reqStats: { P:0, L:10, S:18 }, // [ì„¼ìŠ¤+ë…¼ë¦¬] êµ­ë¯¼ ì•±
            hint: "ëª©í‘œ: ì „ êµ­ë¯¼ì„ ì‚¬ë¡œì¡ì„ <span style='color:#FFD700'>âœ¨ì„¼ìŠ¤</span>ê°€ ì••ë„ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤."
        }, 
        {
            name:"Cuupang", req:1500, tier:'Unicorn', label:"ìœ ë‹ˆì½˜", prevRank: 2,
            reqStats: { P:20, L:8, S:0 }, // [ì—´ì • ê·¹í•œ] ë¡œì¼“ ë°°ì†¡
            hint: "ëª©í‘œ: <span style='color:#FF5F5F'>ğŸ”¥ì†ë„</span>ì™€ <span style='color:#FF5F5F'>ğŸ”¥ì§‘ìš”í•¨</span>! ë‚˜ë¨¸ì§„ í•„ìš” ì—†ìŠµë‹ˆë‹¤."
        },
        // [New] 4. PlayNow (ì•¼ë†€ì íŒ¨ëŸ¬ë”” - ë…¸ëŠ” ê²Œ ì¼)
        {
            name:"PlayNow", req:1500, tier:'Unicorn', label:"ìœ ë‹ˆì½˜", prevRank: 2,
            reqStats: { P:15, L:0, S:15 }, // [ì—´ì •+ì„¼ìŠ¤] ì˜ ë…¸ëŠ” ì‚¬ëŒ
            hint: "ëª©í‘œ: ì¼í•  ë• ì¼í•˜ê³  <span style='color:#FFD700'>âœ¨ë†€ ë• ë…¸ëŠ”</span> ì—ë„ˆì§€!"
        },
        // [New] 5. MushingSa (ë¬´ì‹ ì‚¬ íŒ¨ëŸ¬ë”” - í™í•œ ì»¤ë¨¸ìŠ¤)
        {
            name:"MushingSa", req:1500, tier:'Unicorn', label:"ìœ ë‹ˆì½˜", prevRank: 2,
            reqStats: { P:0, L:15, S:12 }, // [ë…¼ë¦¬+ì„¼ìŠ¤] 
            hint: "ëª©í‘œ: <span style='color:#FFD700'>âœ¨ìŠ¤íƒ€ì¼</span>ì„ <span style='color:#3182F6'>ğŸ§ ì‹œìŠ¤í…œ</span>ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤."
        }
    ], 

    // [4. Global: ì„¸ê³„ ë¬´ëŒ€]
    global: [
        {
            name:"Googol", req:4000, tier:'Global', label:"ê¸€ë¡œë²Œ", prevRank: 2,
            reqStats: { P:0, L:22, S:0 }, // [ë…¼ë¦¬ ê·¹í•œ] ì•Œê³ ë¦¬ì¦˜
            hint: "ëª©í‘œ: ì™„ë²½í•œ <span style='color:#3182F6'>ğŸ§ ì„¤ê³„</span>ì™€ <span style='color:#3182F6'>ğŸ§ ìµœì í™”</span>."
        }, 
        {
            name:"Pear", req:4000, tier:'Global', label:"ê¸€ë¡œë²Œ", prevRank: 2,
            reqStats: { P:0, L:10, S:20 }, // [ì„¼ìŠ¤ ê·¹í•œ] ê°ì„±
            hint: "ëª©í‘œ: ì„¸ìƒì„ ë°”ê¿€ <span style='color:#FFD700'>âœ¨ë””ìì¸ ì² í•™</span>ê³¼ <span style='color:#FFD700'>âœ¨ë””í…Œì¼</span>."
        }, 
        {
            name:"Netflox", req:4000, tier:'Global', label:"ê¸€ë¡œë²Œ", prevRank: 2,
            reqStats: { P:15, L:0, S:15 }, // [ì—´ì •+ì„¼ìŠ¤] ì½˜í…ì¸ 
            hint: "ëª©í‘œ: <span style='color:#FFD700'>âœ¨ì°½ì˜ì„±</span>ê³¼ <span style='color:#FF5F5F'>ğŸ”¥ììœ </span>ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤."
        },
        // [New] 4. Amazone (ì•„ë§ˆì¡´ íŒ¨ëŸ¬ë”” - ì›ì¹™ì£¼ì˜)
        {
            name:"Amazone", req:4200, tier:'Global', label:"ê¸€ë¡œë²Œ", prevRank: 2,
            reqStats: { P:20, L:15, S:0 }, // [ì—´ì •+ë…¼ë¦¬] ê³ ê° ì§‘ì°©
            hint: "ëª©í‘œ: ê³ ê°ì„ í–¥í•œ <span style='color:#FF5F5F'>ğŸ”¥ì§‘ì°©</span>ê³¼ ì°¨ê°€ìš´ <span style='color:#3182F6'>ğŸ§ ì´ì„±</span>."
        },
        // [New] 5. Adobi (ì–´ë„ë¹„ íŒ¨ëŸ¬ë”” - íˆ´ì˜ ì œì™•)
        {
            name:"Adobi", req:4100, tier:'Global', label:"ê¸€ë¡œë²Œ", prevRank: 2,
            reqStats: { P:0, L:15, S:18 }, // [ë…¼ë¦¬+ì„¼ìŠ¤] í¬ë¦¬ì—ì´í‹°ë¸Œ íˆ´
            hint: "ëª©í‘œ: ì°½ì‘ìë¥¼ ìœ„í•œ <span style='color:#3182F6'>ğŸ§ ê¸°ëŠ¥</span>ê³¼ <span style='color:#FFD700'>âœ¨ê°ì„±</span>ì˜ ê²°í•©."
        }
    ],

    // [5. Space: íƒˆì§€êµ¬]
    space: [
        {
            name:"MarsX", req:10000, tier:'Space', label:"ìŠ¤í˜ì´ìŠ¤", prevRank: 3,
            reqStats: { P:25, L:0, S:0 }, // [ì—´ì • ì´ˆì›”] í™”ì„± ê°ˆ ë„ë‹ˆê¹Œ
            hint: "ëª©í‘œ: ì§€êµ¬ë¥¼ ë– ë‚  <span style='color:#FF5F5F'>ğŸ”¥ê´‘ê¸°</span>ì— ê°€ê¹Œìš´ ì—´ì •."
        }, 
        {
            name:"NASA Ops", req:10000, tier:'Space', label:"ìŠ¤í˜ì´ìŠ¤", prevRank: 3,
            reqStats: { P:15, L:15, S:15 }, // [ì™„ì „ì²´] ìš°ì£¼ë¹„í–‰ì‚¬
            hint: "ëª©í‘œ: <span style='color:#FF5F5F'>ğŸ”¥ì²´ë ¥</span>, <span style='color:#3182F6'>ğŸ§ ì§€ëŠ¥</span>, <span style='color:#FFD700'>âœ¨ë©˜íƒˆ</span> ëª¨ë“  ê²Œ ì™„ë²½í•´ì•¼ í•©ë‹ˆë‹¤."
        }, 
        {
            name:"Alien Ware", req:10000, tier:'Space', label:"ìŠ¤í˜ì´ìŠ¤", prevRank: 3,
            reqStats: { P:0, L:0, S:25 }, // [ì„¼ìŠ¤ ì´ˆì›”] ì™¸ê³„ ë¬¸ëª…
            hint: "ëª©í‘œ: ì¸ê°„ì˜ ìƒì‹ì„ ë›°ì–´ë„˜ëŠ” <span style='color:#FFD700'>âœ¨ì™¸ê³„ì  ë°œìƒ</span>."
        },
        // [New] 4. Blue Ocean (ë¸”ë£¨ì˜¤ë¦¬ì§„ íŒ¨ëŸ¬ë””)
        {
            name:"Blue Ocean", req:11000, tier:'Space', label:"ìŠ¤í˜ì´ìŠ¤", prevRank: 3,
            reqStats: { P:18, L:20, S:0 }, // [ë…¼ë¦¬+ì—´ì •] ì •êµí•œ ê¶¤ë„
            hint: "ëª©í‘œ: ì •êµí•œ <span style='color:#3182F6'>ğŸ§ ê³„ì‚°</span> ìœ„ì— ì„¸ì›Œì§„ <span style='color:#FF5F5F'>ğŸ”¥ì•¼ë§</span>."
        },
        // [New] 5. Jedi Order (ìŠ¤íƒ€ì›Œì¦ˆ íŒ¨ëŸ¬ë””)
        {
            name:"Jedi Order", req:12000, tier:'Space', label:"ìŠ¤í˜ì´ìŠ¤", prevRank: 3,
            reqStats: { P:20, L:0, S:22 }, // [ì„¼ìŠ¤+ì—´ì •] í¬ìŠ¤
            hint: "ëª©í‘œ: ë‹¹ì‹ ì˜ <span style='color:#FFD700'>âœ¨ì§ê´€(Force)</span>ì„ ë¯¿ìœ¼ì„¸ìš”."
        }
    ]
};
        const projectPools = {
            Agency: ["ì „ë‹¨ì§€ ë””ìì¸", "ìƒì„¸í˜ì´ì§€", "ë°°ë„ˆ ê´‘ê³ ", "ëª…í•¨ ì œì‘", "ì‡¼í•‘ëª° ë¦¬ë‰´ì–¼"],
            TopTier: ["ì•± GUI ê°œí¸", "ë””ìì¸ ì‹œìŠ¤í…œ", "ë¸Œëœë“œ ê°€ì´ë“œ", "ì•„ì´ì½˜ íŒ¨í‚¤ì§€"],
            Unicorn: ["ìŠˆí¼ì•± í†µí•©", "ì‹ ê·œ ì„œë¹„ìŠ¤ ëŸ°ì¹­", "UX ë¦¬ì„œì¹˜", "ê¸€ë¡œë²Œ í”„ë¡œë•íŠ¸"],
            Global: ["ì „ì‚¬ì  OS êµ¬ì¶•", "ë‹¤êµ­ì–´ í”Œë«í¼", "AI ì¸í„°í˜ì´ìŠ¤", "ì ‘ê·¼ì„± ê°œì„ "],
            Space: ["í™”ì„± ê±°ì£¼ì§€ OS", "ìš°ì£¼ì„  ê´€ì œ UI", "ì™¸ê³„ì–´ ë²ˆì—­ê¸°", "ë¬´ì¤‘ë ¥ UX"]
        };
        
        const RANKS = ["ì‚¬ì›", "ëŒ€ë¦¬", "íŒ€ì¥", "ì´ì‚¬"];
        
// [Ver 62.1] ê¸‰ì—¬ í˜„ì‹¤í™” (ë„ˆë¬´ í¼ì£¼ì§€ ì•ŠìŒ)
const BASE_SALARY = { 
    Agency: 450000,       
    TopTier: 800000,      
    Unicorn: 3000000,     
    Global: 15000000,     
    Space: 150000000      
};        const RANK_MULTIPLIER = [1, 1.2, 1.5, 2.0]; 

// [Ver 60.2] ì•„ì¬ê°œê·¸ ë¦¬ìŠ¤íŠ¸ (ìš”ì²­ì‚¬í•­ ë°˜ì˜: ì•™íŒ¡, ì·¨ì†Œ, ì£¼ë§ ì‚­ì œ)
const dadJokes = [
    {q:"ì™•ì´ ë„˜ì–´ì§€ë©´?", a:"í‚¹ì½©"}, 
    {q:"ë”¸ê¸°ê°€ ì§ì¥ì„ ìƒìœ¼ë©´?", a:"ë”¸ê¸°ì‹œëŸ½"}, 
    {q:"ì‹ ë°œì´ í™”ê°€ ë‚˜ë©´?", a:"ì‹ ë°œëˆ"}, 
    {q:"ë°˜ì„±ë¬¸ì„ ì˜ì–´ë¡œ í•˜ë©´?", a:"ê¸€ë¡œë²Œ"}, 
    {q:"ì†Œê°€ ë…¸ë˜ë¥¼ ë¶€ë¥´ë©´?", a:"ì†Œì†¡"}, 
    {q:"ì„¸ìƒì—ì„œ ì œì¼ ì§€ë£¨í•œ ì¤‘í•™êµëŠ”?", a:"ë¡œë”©ì¤‘"}, 
    {q:"ë¹„ê°€ 1ì‹œê°„ ë™ì•ˆ ë‚´ë¦¬ë©´?", a:"ì¶”ì 60ë¶„"}, 
    {q:"í• ì•„ë²„ì§€ê°€ ì œì¼ ì¢‹ì•„í•˜ëŠ” ëˆì€?", a:"í• ë¨¸ë‹ˆ"}, 
    {q:"ë¶ˆì´ 4ê³³ì— ë‚˜ë©´?", a:"ì‚¬íŒŒì´ì–´"}, 
    {q:"ì–¼ìŒì´ ì£½ìœ¼ë©´?", a:"ë‹¤ì´ë¹™"}, 
    {q:"ì„¸ìƒì—ì„œ ê°€ì¥ ì°©í•œ ì‚¬ìëŠ”?", a:"ìì›ë´‰ì‚¬ì"}, 
    {q:"ì•„ëª¬ë“œê°€ ì£½ìœ¼ë©´?", a:"ë‹¤ì´ì•„ëª¬ë“œ"}, 
    {q:"ìë™ì°¨ê°€ ìš¸ë©´?", a:"ì‰ì¹´"}, 
    {q:"ì‚¬ê³¼ê°€ ì›ƒìœ¼ë©´?", a:"í’‹ì‚¬ê³¼"}, 
    {q:"ê°œê°€ ì‚¬ëŒì„ ê°€ë¥´ì¹˜ë©´?", a:"ê°œì¸ì§€ë„"}, 
    {q:"ì˜¤ë¦¬ê°€ ì–¼ë©´?", a:"ì–¸ë•"}, 
    {q:"ê°€ì¥ ì–µìš¸í•œ ë„í˜•ì€?", a:"ì›í†µ"}, 
    {q:"ì‹¸ì›€ì„ ì œì¼ ì˜í•˜ëŠ” ì˜¤ë¦¬ëŠ”?", a:"ì„ì§€ë¬¸ë•"},
    {q:"ì„¸ìƒì—ì„œ ê°€ì¥ ëœ¨ê±°ìš´ ê³¼ì¼ì€?", a:"ì²œë„ë³µìˆ­ì•„"},
    {q:"ì‹ ì‚¬ê°€ ìê¸°ì†Œê°œí•˜ë©´?", a:"ì‹ ì‚¬ì„ë‹¹"},
    {q:"ë„ë‘‘ì´ í›”ì¹œ ëˆì€?", a:"ìŠ¬ê·¸ë¨¸ë‹ˆ"},
    {q:"ë°”ë‚˜ë‚˜ê°€ ì›ƒìœ¼ë©´?", a:"ë°”ë‚˜ë‚˜í‚¥"},
    {q:"ì˜¤ë¦¬ë¥¼ ìƒìœ¼ë¡œ ë¨¹ìœ¼ë©´?", a:"íšŒì˜¤ë¦¬"},
    {q:"ìë™ì°¨ë¥¼ í†¡ í•˜ê³  ì¹˜ë©´?", a:"ì¹´í†¡"},
    {q:"ë‹¤ë¦¬ë¯¸ê°€ ì¢‹ì•„í•˜ëŠ” ìŒì‹ì€?", a:"í”¼ì"},
    {q:"3ì›”ì— ëŒ€í•™ìƒë“¤ì´ ê°•í•œ ì´ìœ ëŠ”?", a:"ê°œê°•í•´ì„œ"}
];        const p1ProjectThemes = ["ê¸ˆìœµ ì•±", "ë°°ë‹¬ í”Œë«í¼", "ì»¤ë¨¸ìŠ¤ ì›¹", "ê¸°ì—… ì œì•ˆì„œ", "ì‹ ê·œ ë¸Œëœë”©", "SaaS ëŒ€ì‹œë³´ë“œ", "ì´ë²¤íŠ¸ ëœë”©"];

        const initialPlayerState = { 
            totalWeeks: 1, hp: 100, maxHp: 100, money: 500000, designStat: 10, portfolioProgress: 0, portfolioQuality: 0, 
            inventory: ["ê¸°ë³¸ ë§ˆìš°ìŠ¤"], currentPower: 1, isBusy: false, isProjectStarted: false, currentSynergy: 1.0, currentStrategy: 'speed', 
            currentProjectName: '', bestPortfolioScore: 0, jobMarketOpen: false, history: [], mastery: { genre: {}, style: {} }, workedThisWeek: false, premiumJobCount: 0, deadline: 0, currentWeekInProject: 0, pendingCrisis: null,
            
            isPhase2: false, 
            performance: 0, 
            salary: 0, 
            tier: 'Agency', 
            rank: 0, 
            currentProject: null,
            isTutorialDone: false, 
            isP2TutorialDone: false,
            idleWeeks: 0
    
        };
        let player = JSON.parse(JSON.stringify(initialPlayerState)); 

const genres = [
    {id:'g1',name:'ê¸ˆìœµ'},
    {id:'g2',name:'ë°°ë‹¬'},
    {id:'g3',name:'ê²Œì„'},
    {id:'g4',name:'ê³µê³µ'},
    {id:'g5',name:'íŒ¨ì…˜'},
    {id:'g6',name:'AI/í…Œí¬'},   // New
    {id:'g7',name:'í—¬ìŠ¤/ì˜ë£Œ'}, // New
    {id:'g8',name:'êµìœ¡/í‚¤ì¦ˆ'}, // New
    {id:'g9',name:'í™˜ê²½/ESG'}   // New
];
const styles = [
    {id:'s1',name:'ì‹ ë¢°ê°'},
    {id:'s2',name:'íŒí•œ'},
    {id:'s3',name:'ë¯¸ë‹ˆë©€'},
    {id:'s4',name:'ë ˆíŠ¸ë¡œ'},
    {id:'s5',name:'ëŸ­ì…”ë¦¬'},
    {id:'s6',name:'ê°ì„±/ì˜¤ê°€ë‹‰'}, // New
    {id:'s7',name:'ì‚¬ì´ë²„í‘í¬'},  // New
    {id:'s8',name:'ë¸Œë£¨íƒˆë¦¬ì¦˜'}   // New (ê±°ì¹ ê³  í™í•œ ìŠ¤íƒ€ì¼)
];        genres.forEach(g => player.mastery.genre[g.id] = 1); styles.forEach(s => player.mastery.style[s.id] = 1);

const config = { 
    type: Phaser.AUTO, 
    width: 360, 
    height: 640, 
    backgroundColor: '#191F28', 
    parent: 'game-container', 
    resolution: window.devicePixelRatio || 1,
    pixelArt: false, // ë„íŠ¸ ê²Œì„ ì•„ë‹ˆë©´ ë¬´ì¡°ê±´ false
    antialias: true, // ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬ (ì´ê²Œ êº¼ì§€ë©´ ê³„ë‹¨ í˜„ìƒ ë°œìƒ)
    
    scale: {
        // â˜… í•µì‹¬: FIT(ê³ ì •) -> RESIZE(ë°˜ì‘í˜•)ë¡œ ë³€ê²½
        mode: Phaser.Scale.RESIZE, 
        autoCenter: Phaser.Scale.NO_CENTER, 
        width: '100%',
        height: '100%'
    },
    
    pixelArt: false, 
    scene: { preload: preload, create: create, update: update } 
};

const game = new Phaser.Game(config);

        function preload() {
            this.load.image('bg_main', 'assets/bg_main.png'); 
            this.load.image('bg_alba', 'assets/bg_alba.png'); 
            this.load.image('bg_office', 'assets/bg_office.png'); 
            
            // [ìˆ˜ì •ë¨] ë¬´ì¡°ê±´ .pngë¡œ ë¡œë“œ (íŒŒì¼ëª… í†µì¼ í•„ìˆ˜)
            this.load.image('bg_toptier', 'assets/bg_toptier.png');
            this.load.image('bg_unicorn', 'assets/bg_unicorn.png');
            this.load.image('bg_global', 'assets/bg_global.png');
            this.load.image('bg_space', 'assets/bg_space.png');
            this.load.image('bg_main_night', 'assets/bg_main_night.png');
    this.load.image('bg_office_night', 'assets/bg_office_night.png');
    this.load.image('bg_toptier_night', 'assets/bg_toptier_night.png');
    this.load.image('bg_unicorn_night', 'assets/bg_unicorn_night.png');
    this.load.image('bg_global_night', 'assets/bg_global_night.png');
    this.load.image('bg_space_night', 'assets/bg_space_night.png');
            
            this.load.image('bg_netflix', 'assets/bg_netflix.png');
            this.load.image('bg_tenis', 'assets/bg_tenis.png');
            this.load.image('bg_travel', 'assets/bg_travel.png');

            this.load.image('scene_study', 'assets/scene_study.png');      
            this.load.image('scene_burning', 'assets/scene_burning.png'); 
            this.load.image('bg_sleep', 'assets/bg_sleep.png');
            this.load.image('bg_empty_room', 'assets/bg_empty_room.png'); 
            this.load.image('char_hoodie_front', 'assets/char_hoodie_front.png'); 
            this.load.image('char_suit_front', 'assets/char_suit_front.png'); 
            this.load.image('item_mouse_basic.png', 'assets/item_mouse_basic.png'); 
         // â˜…â˜…â˜… [ìˆ˜ì •] í˜ì´ì¦ˆ 1 (í›„ë“œ) ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ (4ì¥) â˜…â˜…â˜…
    this.load.image('char_work', 'assets/char_work.png');       // ê¸°ë³¸
    this.load.image('char_work_2', 'assets/char_work_2.png');   // í”„ë ˆì„ 2
    this.load.image('char_work_3', 'assets/char_work_3.png');   // í”„ë ˆì„ 3
    this.load.image('char_work_4', 'assets/char_work_4.png');   // í”„ë ˆì„ 4

    // â˜…â˜…â˜… [ìˆ˜ì •] í˜ì´ì¦ˆ 2 (ì •ì¥) ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ (4ì¥) â˜…â˜…â˜…
    this.load.image('char_suit_work', 'assets/char_suit_work.png');     // ê¸°ë³¸
    this.load.image('char_suit_work_2', 'assets/char_suit_work_2.png'); // í”„ë ˆì„ 2
    this.load.image('char_suit_work_3', 'assets/char_suit_work_3.png'); // í”„ë ˆì„ 3
    this.load.image('char_suit_work_4', 'assets/char_suit_work_4.png'); // í”„ë ˆì„ 4


            this.load.audio('bgm', 'assets/bgm.mp3');
            // [ì‚¬ìš´ë“œ ë¡œë“œ] wav íŒŒì¼ ë¡œë“œ
    this.load.audio('bgm_intro', ['assets/bgm_intro.ogg', 'assets/bgm_intro.m4a']);
    this.load.audio('bgm_p1', ['assets/bgm_p1.ogg', 'assets/bgm_p1.m4a']);
    this.load.audio('bgm_p2', ['assets/bgm_p2.ogg', 'assets/bgm_p2.m4a']);
    this.load.audio('sfx_btn', 'assets/sfx_btn.wav');
    this.load.audio('sfx_ending', 'assets/sfx_ending.ogg','assets/sfx_ending.m4a');
            loadGameData();
        }

       // [3] create í•¨ìˆ˜ ìˆ˜ì • (ê¸°ì¡´ create ë®ì–´ì“°ê¸°)
// [ê¸°ì¡´ create í•¨ìˆ˜ë¥¼ ì´ê±¸ë¡œ í†µì§¸ë¡œ êµì²´í•˜ì„¸ìš”]
function create() {
    sceneContext = this;
    
    // 1. ì‚¬ìš´ë“œ ë° ë²„íŠ¼ ì„¤ì •
    soundIntro = this.sound.add('bgm_intro', { loop: false, volume: 0.6 });
    soundP1 = this.sound.add('bgm_p1', { loop: true, volume: 0.5 });
    soundP2 = this.sound.add('bgm_p2', { loop: true, volume: 0.5 });
    soundClick = this.sound.add('sfx_btn', { volume: 0.8 });
    soundEnding = this.sound.add('sfx_ending', { loop: false, volume: 1.0 });

    document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => { if(isSoundOn && soundClick) soundClick.play(); });
    });
    try { document.getElementById('sound-toggle').checked = isSoundOn; } catch(e) {}

    // 2. ì´ë¯¸ì§€ ìƒì„±
    let bgKey = 'bg_main';
    if (isNightTime()) bgKey += '_night';

    bgSprite = this.add.image(180, 320, bgKey).setDepth(0);
    sceneImage = this.add.image(180, 320, 'bg_alba'); 
    let pfImg = this.add.image(180, 320, 'scene_burning'); 

    // 3. ìºë¦­í„° ìƒì„±
    // (1) ì„œìˆëŠ” ìºë¦­í„° (ìˆ¨ê¹€ ìƒíƒœ)
    charHoodieSprite = this.add.image(180, 380, 'char_hoodie_front').setDepth(5).setVisible(false); 
    charSuitSprite = this.add.image(180, 380, 'char_suit_front').setDepth(5).setVisible(false); 

    // (2) ì¼í•˜ëŠ” ìºë¦­í„° (ìŠ¤í”„ë¼ì´íŠ¸ë¡œ ìƒì„±í•˜ë˜, ì• ë‹ˆë©”ì´ì…˜ì€ ì•ˆ ì”€)
    // â˜… ì´ˆê¸° ì´ë¯¸ì§€ëŠ” ê¸°ë³¸(char_work, char_suit_work)ìœ¼ë¡œ ì„¤ì •
    charWorkSprite = this.add.sprite(180, 380, 'char_work').setScale(0.5).setDepth(5).setVisible(false);
    charSuitWorkSprite = this.add.sprite(180, 380, 'char_suit_work').setScale(0.5).setDepth(5).setVisible(false);

    // â˜…â˜…â˜… [ì‹ ê·œ] ëœë¤ í–‰ë™ ë¡œì§ ì‹œì‘ â˜…â˜…â˜…
    // ì‚¬ìš©í•  ì´ë¯¸ì§€ ëª©ë¡ ì •ì˜
    const p1_frames = ['char_work', 'char_work_2', 'char_work_3', 'char_work_4'];
    const p2_frames = ['char_suit_work', 'char_suit_work_2', 'char_suit_work_3', 'char_suit_work_4'];

    // ëœë¤í•˜ê²Œ ìì„¸ë¥¼ ë°”ê¾¸ëŠ” í•¨ìˆ˜
    const changePoseRandomly = () => {
        // 1. ëœë¤ ì´ë¯¸ì§€ ì„ íƒ (0 ~ 3ë²ˆ ì¤‘ í•˜ë‚˜)
        const randIdx = Math.floor(Math.random() * 4);
        
        // 2. í…ìŠ¤ì²˜(ì´ë¯¸ì§€) êµì²´
        if(charWorkSprite) charWorkSprite.setTexture(p1_frames[randIdx]);
        if(charSuitWorkSprite) charSuitWorkSprite.setTexture(p2_frames[randIdx]);

        // 3. ë‹¤ìŒ í–‰ë™ ì˜ˆì•½ (2ì´ˆ ~ 5ì´ˆ ì‚¬ì´ ëœë¤í•œ ì‹œê°„ì— ë‹¤ì‹œ ì‹¤í–‰)
        // 2000(2ì´ˆ) + 0~3000(0~3ì´ˆ) = 2~5ì´ˆ ê°„ê²©
        let nextDelay = 3000 + Math.floor(Math.random() * 4000);
        
        sceneContext.time.addEvent({
            delay: nextDelay,
            callback: changePoseRandomly,
            callbackScope: sceneContext
        });
    };

    // ìµœì´ˆ ì‹¤í–‰ (ê²Œì„ ì‹œì‘ 1ì´ˆ ë’¤ë¶€í„° í–‰ë™ ê°œì‹œ)
    sceneContext.time.addEvent({ delay: 1000, callback: changePoseRandomly });
    // â˜…â˜…â˜… [ì‹ ê·œ] ëœë¤ í–‰ë™ ë¡œì§ ë â˜…â˜…â˜…


    // 4. ì˜¤ë²„ë ˆì´ ì„¤ì •
    let overlayBg = this.add.rectangle(180, 320, 5000, 5000, 0x000000); 
    sceneOverlay = this.add.container(0, 0, [overlayBg, sceneImage]).setVisible(false).setDepth(100);

    let pfBg = this.add.rectangle(180, 320, 5000, 5000, 0x000000).setAlpha(0.8);
    portfolioOverlay = this.add.container(0, 0, [pfBg, pfImg]).setVisible(false).setDepth(101);

    let olBg = this.add.rectangle(180, 320, 5000, 5000, 0x000000).setAlpha(0.7);
    overlayText = this.add.text(180, 320, "", { fontSize: '20px', color: '#fff', align: 'center' }).setOrigin(0.5);
    overlayContainer = this.add.container(0, 0, [olBg, overlayText]).setVisible(false).setDepth(100);

    // 5. ë¦¬ì‚¬ì´ì¦ˆ
    const resizeAll = () => {
        const w = sceneContext.scale.width;
        const h = sceneContext.scale.height;

        if(bgSprite) fitToScreen(bgSprite);
        if(sceneImage && sceneImage.visible) fitToScreen(sceneImage);
        if(portfolioOverlay && portfolioOverlay.visible && portfolioOverlay.list[1]) {
            fitToScreen(portfolioOverlay.list[1]);
        }
        
        if(charWorkSprite && charWorkSprite.visible) adjustCharacterSize(charWorkSprite, w, h);
        if(charSuitWorkSprite && charSuitWorkSprite.visible) adjustCharacterSize(charSuitWorkSprite, w, h);

        sceneContext.cameras.main.centerOn(w / 2, h / 2);
    };
    resizeAll();
    this.scale.on('resize', resizeAll);

    // 6. ì´ˆê¸°í™” ë° ì‹œì‘
    setupBackButton();
    initPlanningUI(); generateJobs(); updateUI();
    
    if(player.isPhase2) {
        document.getElementById('ui-layer').style.display = 'none';
        document.getElementById('phase2-ui-layer').style.display = 'flex';
        setBgByTier(player.tier);
    }
    if (isSoundOn && soundIntro && !player.isPhase2) {
        soundIntro.play();
        currentBgm = soundIntro;
    }
}

// [ê¸°ì¡´ setBgByTier í•¨ìˆ˜ë¥¼ ì´ê±¸ë¡œ êµì²´í•˜ì„¸ìš”]
function setBgByTier(tier) {
    let bgKey = 'bg_office'; // ê¸°ë³¸(Agency)

    if (tier === 'TopTier') bgKey = 'bg_toptier';
    else if (tier === 'Unicorn') bgKey = 'bg_unicorn';
    else if (tier === 'Global') bgKey = 'bg_global';
    else if (tier === 'Space') bgKey = 'bg_space';
    
    // â˜…â˜…â˜… [í•µì‹¬] ë°¤ì´ë©´ íŒŒì¼ëª… ë’¤ì— _night ë¶™ì´ê¸°
    if (isNightTime()) {
        bgKey += '_night';
    }
    
    if (bgSprite) {
        // ì´ë¯¸ì§€ê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ ì•ˆì „ ì¥ì¹˜ (í˜¹ì‹œ ì˜¤íƒ€ ë‚¬ì„ê¹Œë´)
        if (sceneContext.textures.exists(bgKey)) {
            bgSprite.setTexture(bgKey);
        } else {
            console.log("ì´ë¯¸ì§€ ëˆ„ë½ë¨:", bgKey); // ì½˜ì†”ì— ê²½ê³ 
            // ë°¤ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë‚® ì´ë¯¸ì§€ë¼ë„ ë³´ì—¬ì¤Œ (ì˜¤ë¥˜ ë°©ì§€)
            bgSprite.setTexture(bgKey.replace('_night', '')); 
        }
    }
}

        function update() { updateUI(); }

        let pendingOffer = null;

// [ìˆ˜ì •ëœ applyJob í•¨ìˆ˜: ëª¨ë“  ì§€ì›ì ë©´ì ‘ ì§„í–‰]
window.applyJob = function(name, req, tier) {
    // 1. ì„œë¥˜(ì ìˆ˜) ì»·
    if(player.bestPortfolioScore < req) { 
        return alert(`[ì§€ì› ë¶ˆê°€] ğŸ“„\ní¬íŠ¸í´ë¦¬ì˜¤ ì ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.\n(ë‚˜ì˜ ì ìˆ˜: ${player.bestPortfolioScore} / ì»¤íŠ¸ë¼ì¸: ${req})`); 
    }
    
    // 2. ì§ê¸‰ ì»· (ê²½ë ¥ì§ ì´ì§ ì‹œ í™•ì¸)
    const targetJob = currentJobList.find(j => j.name === name);
    if (targetJob && targetJob.prevRank && player.rank < targetJob.prevRank) {
        return alert(`[ì§€ì› ë¶ˆê°€] ê²½ë ¥(ì§ê¸‰)ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\ní˜„ì¬ ì§ê¸‰ë³´ë‹¤ ë” ë†’ì€ ë‹¨ê³„ì˜ íšŒì‚¬ì…ë‹ˆë‹¤.`);
    }

    // 3. ì„œë¥˜ í•©ê²© -> ë©´ì ‘ì¥ ì´ë™ (í˜ì´ì¦ˆ êµ¬ë¶„ ì—†ìŒ!)
    closePopup(); // ì±„ìš©ê³µê³  ë‹«ê¸°
    
    // ë¬¸êµ¬ë§Œ ì‚´ì§ ë‹¤ë¥´ê²Œ (ì‹ ì… vs ê²½ë ¥)
    let msg = player.isPhase2 
        ? `[ì„œë¥˜ í†µê³¼] ğŸ‰\n"${name}"ì—ì„œ ì´ì§ ë©´ì ‘ì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.`
        : `[ì„œë¥˜ í•©ê²©] ğŸ‰\n"${name}"ì—ì„œ ë©´ì ‘ ì œì•ˆì´ ì™”ìŠµë‹ˆë‹¤!`;

    alert(`${msg}\në©´ì ‘ì¥ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
    
    // ë©´ì ‘ ì‹œì‘
    setTimeout(() => {
        startInterview(name, tier);
    }, 300);
};

        window.acceptOffer = function() {
            closePopup();
            
            const isFirstTime = !player.isPhase2;
            
            player.tier = pendingOffer.newTier;
            player.rank = 0; 
            player.hp = 100;
            player.performance = 0;
            updateSalary();

            if(isFirstTime) {
                playEndingSequence(pendingOffer.name, pendingOffer.score);
            } else {
                playTransferSequence(pendingOffer.name);
            }
        };

        function playTransferSequence(companyName) {
            player.isBusy = true;
            document.getElementById('phase2-ui-layer').style.display = 'none'; 
            
            const leaveMsgs = ["ì¸ìˆ˜ì¸ê³„ì„œ ì™„ë²½í•˜ê²Œ ì •ë¦¬ ë!", "ì •ë“  ë™ë£Œë“¤ê³¼ ì‘ë³„ ì¸ì‚¬...", "ë‚´ ì†ë•Œ ë¬»ì€ í‚¤ë³´ë“œì•¼ ì•ˆë…•", "ì´ê³³ì—ì„œì˜ ê²½í—˜ì´ í—›ë˜ì§€ ì•Šì•˜ê¸°ë¥¼...", "ì±…ìƒ ì •ë¦¬ ì™„ë£Œ, ê°€ë²¼ìš´ ë§ˆìŒìœ¼ë¡œ ë– ë‚©ë‹ˆë‹¤"];
            const arriveMsgs = ["ìƒˆë¡œìš´ ì‚¬ì›ì¦! ì´ˆì‹¬ìœ¼ë¡œ ëŒì•„ê°€ë³´ì", "ì˜¤í”¼ìŠ¤ ë·°ê°€ ì¢‹ë„¤, ì˜ê°ì´ ë– ì˜¤ë¥¼ ë“¯!", "íŒ€ì›ë“¤ì´ í™˜ì˜í•´ì£¼ë‹ˆ ì˜ìš•ì´ ìƒ˜ì†ŸëŠ”ë‹¤", "ë” ë„“ì–´ì§„ ì±…ìƒ, ë” ì»¤ì§„ ê¿ˆ!", "ì´ íšŒì‚¬ì˜ í•µì‹¬ ì¸ì¬ê°€ ë˜ì–´ì£¼ê² ì–´"];
            
            const lMsg = leaveMsgs[Math.floor(Math.random()*leaveMsgs.length)];
            const aMsg = arriveMsgs[Math.floor(Math.random()*arriveMsgs.length)];

            playScene(bgSprite.texture.key, ["ì§ì„ ìŒ‰ë‹ˆë‹¤...", lMsg, "ë” ë†’ì€ ê³³ì„ í–¥í•´!"], () => {
                
                const flash = sceneContext.add.rectangle(180, 320, 360, 640, 0x000000).setDepth(200).setAlpha(0);
                sceneContext.tweens.add({
                    targets: flash, alpha: 1, duration: 800, yoyo: true, hold: 500,
                    onYoyo: () => {
                        setBgByTier(player.tier); 
                    },
                    onComplete: () => {
                        flash.destroy();
                        document.getElementById('phase2-ui-layer').style.display = 'flex';
                        player.isBusy = false;
                        player.currentProject = null;
                        assignProject(); 
                        alert(`[ì´ì§ ì™„ë£Œ]\n${companyName}ì— ì²« ì¶œê·¼í–ˆìŠµë‹ˆë‹¤.\n"${aMsg}"`);
                        updateUI();
                    }
                });
            });
        }

        window.testEnding = function() {
            if(confirm("ì—”ë”© ì‹œí€€ìŠ¤ë¥¼ ì¬ìƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (í…ŒìŠ¤íŠ¸ ë°ì´í„°)")) {
                playEndingSequence('(ì£¼)í…ŒìŠ¤íŠ¸ ì»´í¼ë‹ˆ', 99999);
            }
        }

        function playEndingSequence(companyName, requiredScore) {
    // 1. ì‚¬ìš´ë“œ ì²˜ë¦¬
    if(soundP1 && soundP1.isPlaying) {
        soundP1.stop();
    }
    if(isSoundOn && soundEnding) {
        soundEnding.play();
    }
    
    player.isBusy = true;
    document.getElementById('ui-layer').style.opacity = '0'; // UI ìˆ¨ê¹€
    
    // â˜…â˜…â˜… [í•µì‹¬ ìˆ˜ì •] ì—”ë”© ì‹œì‘ ì‹œ 'ì¼í•˜ëŠ” ìºë¦­í„°' ê°•ì œë¡œ ìˆ¨ê¸°ê¸° â˜…â˜…â˜…
    if(charWorkSprite) charWorkSprite.setVisible(false);
    if(charSuitWorkSprite) charSuitWorkSprite.setVisible(false);
    
    // í˜¹ì‹œ ì¼œì ¸ ìˆì„ì§€ ëª¨ë¥´ëŠ” ì„œìˆëŠ” ìºë¦­í„°ë“¤ë„ ì¼ë‹¨ ìˆ¨ê¹€ (ì• ë‹ˆë©”ì´ì…˜ì—ì„œ ë‹¤ì‹œ ì¼¤ ê²ƒì„)
    if(charHoodieSprite) charHoodieSprite.setVisible(false);
    if(charSuitSprite) charSuitSprite.setVisible(false);
    
    // 2. í™”ë©´ ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
    const centerX = sceneContext.scale.width / 2;
    const centerY = sceneContext.scale.height / 2;

    // 3. í™”ì´íŠ¸ í”Œë˜ì‹œ íš¨ê³¼
    const flash = sceneContext.add.rectangle(centerX, centerY, 5000, 5000, 0xFFFFFF).setDepth(200).setAlpha(0);
    
    sceneContext.tweens.add({
        targets: flash,
        alpha: 1,
        duration: 600,
        yoyo: true,
        hold: 200,
        onYoyo: () => {
            // [í™”ë©´ì´ í•˜ì–—ê²Œ ë˜ì—ˆì„ ë•Œ ì‹¤í–‰]
            
            // ë°°ê²½ì„ 'ë¹ˆ ë°©'ìœ¼ë¡œ êµì²´
            bgSprite.setTexture('bg_empty_room');
            fitToScreen(bgSprite); 

            // â˜…â˜…â˜… ì—”ë”©ìš© ìºë¦­í„°(í›„ë“œ ì„œìˆëŠ” ëª¨ìŠµ) ë“±ì¥ ë° ìœ„ì¹˜/í¬ê¸° ì¡°ì • â˜…â˜…â˜…
            // ì•„ê¹Œ ë§Œë“  adjustCharacterSize í•¨ìˆ˜ë¥¼ ì“°ê±°ë‚˜, ì§ì ‘ ì„¤ì •
            charHoodieSprite.setVisible(true);
            
            // ì—”ë”© ì—°ì¶œì„ ìœ„í•´ ì¡°ê¸ˆ ë” í¬ê²Œ(ê¸°ë³¸ í¬ê¸°) ì„¤ì •í•˜ê±°ë‚˜ ì¡°ì •
            // ì—¬ê¸°ì„œëŠ” ê¸°ì¡´ adjustCharacterSize ë¹„ìœ¨ì„ ë”°ë¥´ë„ë¡ ì„¤ì •
            adjustCharacterSize(charHoodieSprite, sceneContext.scale.width, sceneContext.scale.height);
            
            // ìœ„ì¹˜ ë¯¸ì„¸ ì¡°ì • (ì—”ë”©ì´ë‹ˆê¹Œ ì¤‘ì•™ì— ë”±)
            charHoodieSprite.setPosition(centerX, centerY + (sceneContext.scale.height * 0.05));
        },
        onComplete: () => {
            flash.destroy();
            
            // 4. ì˜· ê°ˆì•„ì…ëŠ” ì• ë‹ˆë©”ì´ì…˜ (í›„ë“œ -> ì •ì¥)
            sceneContext.tweens.add({
                targets: charHoodieSprite,
                scaleX: 0, // í™€ì­‰í•´ì§€ë©´ì„œ ì‚¬ë¼ì§
                duration: 300,
                onComplete: () => {
                    charHoodieSprite.setVisible(false);
                    
                    // ì •ì¥ ìºë¦­í„° ë“±ì¥
                    charSuitSprite.setVisible(true);
                    charSuitSprite.scaleX = 0; // 0ì—ì„œ ì‹œì‘
                    
                    // ìœ„ì¹˜/í¬ê¸° ë§ì¶¤
                    adjustCharacterSize(charSuitSprite, sceneContext.scale.width, sceneContext.scale.height);
                    charSuitSprite.scaleX = 0; // ë‹¤ì‹œ 0ìœ¼ë¡œ (adjust ë•Œë¬¸ì— ì»¤ì¡Œì„ ìˆ˜ ìˆìŒ)

                    sceneContext.tweens.add({
                        targets: charSuitSprite,
                        scaleX: charHoodieSprite.scaleY, // ì›ë˜ ë¹„ìœ¨ëŒ€ë¡œ ì»¤ì§
                        duration: 800,
                        ease: 'Back.out',
                        onComplete: () => {
                            setTimeout(() => {
                                showSuccessPopup(companyName);
                            }, 500);
                        }
                    });
                }
            });
        }
    });
}
        function showSuccessPopup(companyName) {
            document.getElementById('success-company').innerText = companyName;
            document.getElementById('success-score').innerText = calculateTotalScore().toLocaleString();
            const popup = document.getElementById('success-popup');
            popup.style.display = 'flex'; 
            player.isBusy = false;
        }
        
  // [Ver 69.2 Fix] Bê¸‰ í”„ë¡œì íŠ¸ ê¸°í•œ ì—°ì¥ (6~7ì¼)
function assignProject() {
    const tiers = ['S', 'A', 'B'];
    const tier = tiers[Math.floor(Math.random()*tiers.length)]; 
    const pool = projectPools[player.tier] || projectPools['Agency'];
    const theme = pool[Math.floor(Math.random()*pool.length)];
    
    // [ìˆ˜ì •] ë§ˆê° ê¸°í•œ ì¡°ì •
    // Sê¸‰: 10~11ì¼ (ìœ ì§€)
    // Aê¸‰: 8~9ì¼ (ìœ ì§€)
    // Bê¸‰: 6~7ì¼ (ê¸°ì¡´ 5~6ì¼ì—ì„œ +1ì¼ ìƒí–¥) -> ì´ì œ ì‚¬ì´í´ìƒ í´ë¦¬ì–´ ê°€ëŠ¥
    let dead = 0;
    if (tier === 'S') dead = Math.floor(Math.random() * 3) + 8;
    else if (tier === 'A') dead = Math.floor(Math.random() * 2) + 8;
    else dead = Math.floor(Math.random() * 2) + 6;
    
    // ë²„í”„ íƒ€ì… íŒë³„
    let type = 'fame'; 
    if (theme.includes("ì‡¼í•‘") || theme.includes("ê´‘ê³ ") || theme.includes("ì „ë‹¨") || 
        theme.includes("ìƒì„¸") || theme.includes("ì»¤ë¨¸ìŠ¤") || theme.includes("ê¸ˆìœµ")) type = 'wealth';
    else if (theme.includes("ì•±") || theme.includes("ì‹œìŠ¤í…œ") || theme.includes("UX") || 
             theme.includes("GUI") || theme.includes("OS") || theme.includes("ì¸í„°í˜ì´ìŠ¤") || 
             theme.includes("í”Œë«í¼") || theme.includes("ê²Œì„")) type = 'speed';
    
    player.currentProject = {
        name: `${theme}`,
        tier: tier,
        companyTier: player.tier, 
        originalTier: tier,
        progress: 0,
        deadline: dead, 
        currentWeek: 0, 
        isExtended: false,
        meetingDone: false, 
        progMult: 1.0, 
        costMult: 1.0,
        strategyName: "ë¯¸ì •",
        buffType: type 
    };
    
    let hint = "";
    if(type === 'wealth') hint = "(ğŸ’°ì—°ë´‰ íŠ¹í™”)";
    else if(type === 'speed') hint = "(âš¡ì†ë„ íŠ¹í™”)";
    else hint = "(ğŸ–ï¸ì„±ê³¼ íŠ¹í™”)";

    showP2Log(`[${player.tier}] ì‹ ê·œ ${tier}ê¸‰ ì—…ë¬´ í• ë‹¹! (ë§ˆê° D-${dead})`);
}

  // [Ver 82.1 Fix] ì—ì´ì „ì‹œ 20 ê³ ì • + ìƒìœ„ í‹°ì–´ ì†Œëª¨ëŸ‰ ì™„í™”
window.doP2Work = function() {
    if (!player.currentProject) return;
    
    // ì•ˆì „ì¥ì¹˜
    if (typeof player.currentProject.meetingDone === 'undefined') {
        player.currentProject.meetingDone = false;
        player.currentProject.progMult = 1.0;
        player.currentProject.costMult = 1.0;
        player.currentProject.strategyName = "ë¯¸ì •";
    }

    if (!player.currentProject.meetingDone) {
        const msgList = (typeof clientMentions !== 'undefined') ? clientMentions : ["ìš”êµ¬ì‚¬í•­ í™•ì¸ ì¤‘..."];
        const msg = msgList[Math.floor(Math.random() * msgList.length)];
        const msgEl = document.getElementById('client-msg');
        if(msgEl) msgEl.innerText = msg;
        openPopup('meeting-popup');
        return; 
    }

    // [ìˆ˜ì •] ì²´ë ¥ ë¹„ìš© ë°¸ëŸ°ìŠ¤ ì¡°ì •
    // ì—ì´ì „ì‹œëŠ” 20ìœ¼ë¡œ ìœ ì§€í•˜ë˜, ìƒìœ„ êµ¬ê°„ ìƒìŠ¹í­ì„ ì¤„ì„ (2ì”© ì¦ê°€)
    let baseCost = 20; 
    
    if(player.tier === 'Agency') baseCost = 20;       // 5íšŒ (ë”± ì ë‹¹í•¨)
    else if(player.tier === 'TopTier') baseCost = 22; // 4.5íšŒ
    else if(player.tier === 'Unicorn') baseCost = 24; // 4íšŒ
    else if(player.tier === 'Global') baseCost = 26;  // 3.8íšŒ
    else if(player.tier === 'Space') baseCost = 28;   // 3.5íšŒ (ê¸°ì¡´ 40 ëŒ€ë¹„ ëŒ€í­ ì™„í™”)

    let mult = player.currentProject.costMult || 1.0;
    let finalCost = Math.floor(baseCost * mult);

    if(player.hp < finalCost) return alert(`ì²´ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš” ${finalCost})`);
    
    realWork(player.currentProject.progMult, finalCost, player.currentProject.strategyName);
}

// [4-2] ë¯¸íŒ… ì „ëµ ì„ íƒ
window.confirmMeeting = function(strategy) {
    closePopup();
    
    if (strategy === 'yesman') {
        player.currentProject.progMult = 1.5;
        player.currentProject.costMult = 2.0;
        player.currentProject.strategyName = "ğŸ”¥ë¬´ë¦¬í•œ ìˆ˜ìš©";
    } else if (strategy === 'pro') {
        player.currentProject.progMult = 1.0;
        player.currentProject.costMult = 1.0;
        player.currentProject.strategyName = "ğŸ‘”ì •ì„ ì§„í–‰";
    } else if (strategy === 'ignore') {
        player.currentProject.progMult = 0.6;
        player.currentProject.costMult = 0.7;
        player.currentProject.strategyName = "ğŸ›¡ï¸í˜„ì‹¤ íƒ€í˜‘";
    }

    player.currentProject.meetingDone = true;
    doP2Work(); // ì„¤ì • ëë‚¬ìœ¼ë‹ˆ ë°”ë¡œ ì—…ë¬´ 1íšŒ ì‹¤í–‰
}

// [Ver 68.5 Fix] ì§„í–‰ë„ ì œí•œ í•´ì œ (ëŠ¥ë ¥ê» í•˜ì„¸ìš”)
function realWork(progMult, finalCost, strategyName) {
    playScene(bgSprite.texture.key, msgs.work, () => {
        player.hp -= finalCost;
        
      // [ìˆ˜ì •ëœ ë‚œì´ë„ ë°¸ëŸ°ìŠ¤]
// ê¸°ì¡´ë³´ë‹¤ ì „ë°˜ì ìœ¼ë¡œ ìƒí–¥í•˜ì—¬ ì„±ì·¨ê°ì„ ë†’ì„
const tierCoef = { 
    Agency: 3,      // ê¸°ì¡´ 2 -> 3 (ê¸°ì´ˆ ì²´ë ¥ ìš”êµ¬)
    TopTier: 5.5,     // ê¸°ì¡´ 5 -> 8 (ë³¸ê²©ì ì¸ ì—…ë¬´)
    Unicorn: 12,    // ê¸°ì¡´ 15 -> 22 (ìŠ¤í™ì—… í•„ìˆ˜)
    Global: 20,     // ê¸°ì¡´ 25 -> 45 (ì—˜ë¦¬íŠ¸ ì½”ìŠ¤)
    Space: 45      // ê¸°ì¡´ 80 -> 100 (íƒˆì§€êµ¬ê¸‰ ë‚œì´ë„)
};

let baseDiff = tierCoef[player.tier] || 3;

// â˜… [í•µì‹¬ ìˆ˜ì •] ì§ê¸‰ íŒ¨ë„í‹° í•˜í–¥ (ê¸°ì¡´ 0.35 -> 0.25)
        // ì‚¬ì›(1.0) -> ëŒ€ë¦¬(1.25) -> íŒ€ì¥(1.5) -> ì´ì‚¬(1.75)
        // ê¸°ì¡´ì—ëŠ” íŒ€ì¥ì´ë©´ 1.7ë°°ì˜€ì§€ë§Œ, ì´ì œëŠ” 1.5ë°°ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤.
        let rankDiffMult = 1 + (player.rank * 0.25);

let difficulty = Math.floor(baseDiff * rankDiffMult);

        let base = 5; 
        let statBonus = Math.floor(player.designStat * 0.06); 
        let itemBonus = player.currentPower || 0;
        let totalPower = base + statBonus + itemBonus;
        // [â˜… ì¶”ê°€ 1] ì²´ë ¥ ê°ì†Œ í”Œë¡œíŒ… (ë¹¨ê°„ìƒ‰)
   // â˜… [ìˆ˜ì •] ì²´ë ¥ ê°ì†Œ ìœ„ì¹˜ ìƒí–¥: 350 -> 280 (ì–¼êµ´ ë†’ì´)
        showFloatingText(180, 280, `-${finalCost} HP`, '#FF5F5F');

        // 1. ê¸°ë³¸ ì§„í–‰ë„ ê³„ì‚°
        let prog = Math.max(1, Math.floor(totalPower / difficulty));
        if(player.currentProject.tier === 'S') prog = Math.ceil(prog * 0.6);
        else if(player.currentProject.tier === 'A') prog = Math.ceil(prog * 0.7);

        // 3. ë°°ìœ¨ ì ìš©
        prog = Math.ceil(prog * progMult);

        // 4. ë²„í”„ ì ìš©
        if (typeof getHofBuffs === 'function') {
            let speedBuff = getHofBuffs().speed; 
            if (speedBuff > 0) prog = Math.ceil(prog * (1 + speedBuff/100));
        }
        
        // ìµœì†Œ 1% ë³´ì¥
        prog = Math.max(1, prog);

        player.currentProject.progress += prog;
        
        // [â˜… ì¶”ê°€ 2] ì§„í–‰ë„ ìƒìŠ¹ í”Œë¡œíŒ… (íŒŒë€ìƒ‰)
        // ìœ„ì¹˜: í™”ë©´ ì¤‘ì•™ ìƒë‹¨
        showFloatingText(180, 240, `+${prog}%`, '#3182F6');

        if(player.currentProject.progress >= 100) {
            completeProject();
        } else {
            showP2Log(`[${strategyName}] ì§„í–‰ë„ +${prog}%...`); 
            addTime(true); 
        }
    });
}
 // [Ver 69.3 Fix] ìŠ¹ì§„ ë‚œì´ë„ ì™„í™” (ëŒ€ë¦¬ 0.75 / íŒ€ì¥ 0.5)
function completeProject() {
    let tier = player.currentProject.tier;
    
    // 1. ê¸°ë³¸ ìŠ¹ì§„ ì ìˆ˜ (Base Promo)
    let basePromo = tier === 'S' ? 20 : (tier === 'A' ? 10 : 5);
    
    // 2. ì§ê¸‰ë³„/ìƒí™©ë³„ ë°°ìœ¨ ê³„ì‚°
    let rankMult = 1.0;

    if (player.rank === 0) {
        // [ì‹ ì… ì‚¬ì› ë¡œì§ ìœ ì§€]
        // ë°˜ë ¤ ì´ë ¥ ìˆìœ¼ë©´ 1.0, ì—†ìœ¼ë©´ í‹°ì–´ë³„ ì°¨ë“±(Globalì€ 1.0)
        if (player.currentProject.isExtended) {
            rankMult = 1.0; 
        } else {
            if (player.tier === 'Global' || player.tier === 'Space') rankMult = 1.0; 
            else if (player.tier === 'Unicorn') rankMult = 1.1; 
            else rankMult = 1.2; 
        }
    } else {
        // [ìˆ˜ì •] ëŒ€ë¦¬/íŒ€ì¥ê¸‰ ì„±ê³¼ ì¸ì • ë¹„ìœ¨ ìƒí–¥ (ë³‘ëª© í•´ì†Œ)
        if (player.rank === 1) {
            rankMult = 0.75; // ëŒ€ë¦¬: 0.6 -> 0.75 (25% ìƒí–¥)
        } else if (player.rank === 2) {
            rankMult = 0.5;  // íŒ€ì¥: 0.4 -> 0.5 (ì†Œí­ ìƒí–¥)
        } else if (player.rank === 3) {
            rankMult = 0.25; // ì´ì‚¬: 0.2 -> 0.25 (ë¯¸ì„¸ ì¡°ì •)
        }
    }
    
    // ìµœì¢… ìŠ¹ì§„ ì ìˆ˜ ê³„ì‚° (ë°˜ì˜¬ë¦¼ ì²˜ë¦¬)
    let finalPromo = Math.max(1, Math.round(basePromo * rankMult));

    // 3. ì ìˆ˜(Score) ê³„ì‚° (ê¸°ì¡´ ìœ ì§€)
    let tierMult = 1;
    if (player.tier === 'Space') tierMult = 50;
    else if (player.tier === 'Global') tierMult = 20;
    else if (player.tier === 'Unicorn') tierMult = 8; 
    else if (player.tier === 'TopTier') tierMult = 3; 

    let baseScore = (tier === 'S' ? 500 : (tier === 'A' ? 300 : 100));
    let rawScore = baseScore * tierMult;

    let randomFactor = 1.0; 
    let isViral = false;
    if (tier === 'S') {
        randomFactor = 0.8 + (Math.random() * 0.4); 
        if (Math.random() < 0.1) { isViral = true; randomFactor += 0.3; }
    }
    
    let rankBonus = 1 + (player.rank * 0.05);
    let finalScore = Math.floor(rawScore * randomFactor * rankBonus);

    // 4. ë°ì´í„° ë°˜ì˜
    player.performance += finalPromo;
    
    let historyName = player.currentProject.name;
    if (isViral) historyName = "ğŸ”¥ " + historyName;

    player.history.push({ 
        name: historyName, 
        score: finalScore, 
        grade: tier,
        companyTier: player.currentProject.companyTier || player.tier, 
        buffType: player.currentProject.buffType || 'fame'
    });
    
    if(finalScore > player.bestPortfolioScore) player.bestPortfolioScore = finalScore;

    // 5. ê²°ê³¼ ë©”ì‹œì§€
    let msg = `âœ… ê²°ì¬ ìŠ¹ì¸! [${tier}ê¸‰] ì™„ë£Œ!\n`;
    if (isViral) msg += `ğŸ”¥ ëŒ€ë°• í„°ì§! ì‹œì¥ ë°˜ì‘ í­ë°œ! ğŸ”¥\n`;
    else if (tier === 'S' && randomFactor < 1.0) msg += `ğŸ“‰ ì‹œì¥ ë°˜ì‘ì´ ë¯¸ì§€ê·¼í•©ë‹ˆë‹¤...\n`;
    
    msg += `(ìŠ¹ì§„ì‹¬ì‚¬ +${finalPromo})`;

    if (player.rank === 0) {
        if (player.currentProject.isExtended) msg += `\nâ€» ë°˜ë ¤ ì´ë ¥ìœ¼ë¡œ ì‹ ì… ê°€ì‚°ì  ì œì™¸ë¨`;
        else if (rankMult > 1.0) msg += `\nâœ¨ ì‹ ì… ê°€ì‚°ì  ${Math.round((rankMult-1)*100)}% ì ìš©!`;
    }

    alert(msg);
    
    player.currentProject = null; 
    assignProject(); 
    addTime(true);
}

 // [Ver 69.0 Fix] Cê¸‰ ì‚¼ì§„ ì•„ì›ƒ (ë¬´í•œ ë£¨í”„ ë°©ì§€ ë° ê°•ì œ ì¢…ë£Œ)
function rejectProject() {
    let curr = player.currentProject.tier;
    
    // 1. ë©˜íƒˆ ë°˜í† ë§‰ (ê³µí†µ)
    player.hp = Math.floor(player.hp / 2); 

    // ----------------------------------------------------
    // [CASE 1] Cê¸‰ í”„ë¡œì íŠ¸ (êµ¬ì œ or íê¸° ì‹¬ì‚¬)
    // ----------------------------------------------------
    if (curr === 'C') {
        // ë°˜ë ¤ íšŸìˆ˜ ì¹´ìš´íŠ¸ (ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì‹œì‘)
        if (typeof player.currentProject.rejectCount === 'undefined') {
            player.currentProject.rejectCount = 0;
        }
        player.currentProject.rejectCount++;

        // [ì‚¼ì§„ ì•„ì›ƒ ì²´í¬] 3ë²ˆì§¸ ë°˜ë ¤ë¼ë©´?
        if (player.currentProject.rejectCount >= 3) {
            // í”„ë¡œì íŠ¸ í­íŒŒ (Reset)
            let penalty = 15; // ëŒ€í˜• ì‚¬ê³  íŒ¨ë„í‹°
            player.performance = Math.max(0, player.performance - penalty);
            
            alert(`â›” [í”„ë¡œì íŠ¸ íê¸° ì²˜ë¶„]\n\níŒ€ì¥: "ë” ì´ìƒ ëª» ê¸°ë‹¤ë ¤ì£¼ê² ë„¤. ì´ í”„ë¡œì íŠ¸ëŠ” ë“œëì´ì•¼."\n(3íšŒ ì—°ì† ì‹¤íŒ¨ë¡œ ì—…ë¬´ íšŒìˆ˜ë¨ / ì„±ê³¼ -${penalty})`);
            
            // ì•„ì˜ˆ ìƒˆ í”„ë¡œì íŠ¸ ë°›ê¸° (ì§€ì˜¥ íƒˆì¶œ)
            player.currentProject = null;
            assignProject();
            updateUI();
            return; // í•¨ìˆ˜ ì¢…ë£Œ
        }

        // [ì•„ì§ ê¸°íšŒ ìˆìŒ] 1~2íšŒì°¨ ë°˜ë ¤
        player.performance = Math.max(0, player.performance - 1); // ì„±ê³¼ -1 (ì”ì†Œë¦¬)
        player.currentProject.deadline += 1; // ê¸°í•œ +1ì¼ (ì—°ì¥)
        
        // ë‹¤ì‹œ ì²˜ìŒë¶€í„°
        player.currentProject.progress = 0;
        player.currentProject.currentWeek = 0;
        
        alert(`â›” [Cê¸‰] ì—…ë¬´ ì‹¤íŒ¨! (ê²½ê³  ${player.currentProject.rejectCount}/3)\n(ì„±ê³¼ -1, ë©˜íƒˆ ë°˜í† ë§‰)\n\n"ê¸°íšŒë¥¼ í•œë²ˆ ë” ì¤ë‹ˆë‹¤. 3ë²ˆ ì‹¤íŒ¨í•˜ë©´ í”„ë¡œì íŠ¸ëŠ” íê¸°ë©ë‹ˆë‹¤."\n(ìƒˆ ë§ˆê° D-${player.currentProject.deadline})`);
    }
    
    // ----------------------------------------------------
    // [CASE 2] S/A/Bê¸‰ ì‹¤íŒ¨ ì‹œ (ê¸°ì¡´ ë¡œì§: ê°•ë“±)
    // ----------------------------------------------------
    else {
        let next = curr === 'S' ? 'A' : (curr === 'A' ? 'B' : 'C');
        
        // ì§ê¸‰ë³„ íŒ¨ë„í‹°
        let penalty = 0;
        if (player.rank > 0) {
            penalty = (player.rank * 2) + 1;
            player.performance = Math.max(0, player.performance - penalty);
        }

        // ê°•ë“± ì²˜ë¦¬
        player.currentProject.tier = next;
        player.currentProject.progress = 0;
        player.currentProject.currentWeek = 0;
        
        // ê°•ë“± ì‹œ ë°˜ë ¤ ì¹´ìš´íŠ¸ ì´ˆê¸°í™” (ìƒˆ ë“±ê¸‰ì—ì„œ ë‹¤ì‹œ ì‹œì‘)
        player.currentProject.rejectCount = 0;

        // ê¸°í•œ ì¬ì„¤ì •
        if (next === 'A') {
            player.currentProject.deadline = Math.floor(Math.random() * 3) + 6; 
        } else if (next === 'B') {
            player.currentProject.deadline = Math.floor(Math.random() * 2) + 6;  
        } else {
            player.currentProject.deadline = Math.floor(Math.random() * 2) + 6; 
        }

        let msg = `â›” ë§ˆê° ì´ˆê³¼! ë“±ê¸‰ í•˜ë½ [${curr} -> ${next}]\n(ë©˜íƒˆ ë°˜í† ë§‰`;
        if (penalty > 0) msg += `, ì„±ê³¼ -${penalty})\n[${RANKS[player.rank]}] ì§ê¸‰ ì±…ì„ ì§•ê³„.`;
        else msg += `)\nğŸ”° ì‹ ì…ì´ë¼ ì„±ê³¼ ì°¨ê° ë©´ì œ.`;
        
        alert(msg);
    }
    
    updateUI();
}

// [Ver 69.1 Fix] ê²½ì œ ë¶€ì–‘ì±… (ì›”ê¸‰ ì¸ìƒ & ë¬¼ê°€ ì•ˆì •)
function addTime(workDone = true) {
    player.totalWeeks++; 
    player.workedThisWeek = false;
// â–¼â–¼â–¼ [ì—¬ê¸°ë¶€í„° ì”ì†Œë¦¬ ë¡œì§ ì¶”ê°€] â–¼â–¼â–¼
    // í˜ì´ì¦ˆ 1(ì·¨ì¤€ìƒ)ì´ê³ , í”„ë¡œì íŠ¸ë¥¼ ì•ˆ í•˜ê³  ìˆë‹¤ë©´?
    if (!player.isPhase2 && !player.isProjectStarted) {
        // ê³µë°±ê¸° ì¹´ìš´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
        if (!player.idleWeeks) player.idleWeeks = 0;
        
        player.idleWeeks++; // 1ì£¼ ì¶”ê°€

        // 4ì£¼(í•œ ë‹¬) ì—°ì† ë†€ì•˜ìœ¼ë©´ ì”ì†Œë¦¬ ë°œë™!
        if (player.idleWeeks >= 4) {
            triggerNaggingEvent();
        }
    } else {
        // í”„ë¡œì íŠ¸ ì¤‘ì´ê±°ë‚˜ ì§ì¥ì¸ì´ë©´ ì¹´ìš´í„° ì´ˆê¸°í™” (ì•ˆì‹¬)
        player.idleWeeks = 0;
    }
    // â–²â–²â–² [ì—¬ê¸°ê¹Œì§€ ì¶”ê°€] â–²â–²â–²

 // 1. ì›”ê¸‰ë‚  ì²´í¬ (30ì¼ì— í•œ ë²ˆ)
    let isPayDay = (player.totalWeeks % 30 === 0); 
    
    if (isPayDay) {
        let monthlyIncome = 0;
        let monthlyCost = 0;
        let costName = "ê¸°íƒ€ ë¹„ìš©"; // ëª…ì„¸ì„œì— ì°í ì´ë¦„

        if (player.isPhase2) {
            // [Phase 2: ì§ì¥ì¸] ì›”ê¸‰ O, í’ˆìœ„ìœ ì§€ë¹„(ë†’ìŒ)
            monthlyIncome = Math.floor(player.salary * 4.5);
            
            const costTable = { Agency: 300000, TopTier: 600000, Unicorn: 1400000, Global: 20000000, Space: 200000000 };
            let base = costTable[player.tier] || 500000;
            let rankMult = 1 + (player.rank * 0.2);
            monthlyCost = Math.floor(base * rankMult);
            costName = "ì„¸ê¸ˆ ë° í’ˆìœ„ ìœ ì§€ë¹„";
        } 
        else {
            // [Phase 1: ì·¨ì¤€ìƒ] ìˆ˜ì… 0ì›, ìƒí™œë¹„(ë‚®ìŒ)
            // â˜… ì›” 150,000ì› ê³ ì • ì§€ì¶œ (ì•Œë°” ì•½ 4íšŒ ë¶„ëŸ‰)
            monthlyIncome = 0;
            monthlyCost = 150000;
            costName = "ìƒí™œë¹„ (ì‹ë¹„/í†µì‹ ë¹„)";
        }

        // ëˆ ì²˜ë¦¬
        player.money += monthlyIncome;
        if (player.money >= monthlyCost) {
            player.money -= monthlyCost;
        } else {
            // ëˆ ì—†ìœ¼ë©´ 0ì› (ì¶”í›„ ë¹š ì‹œìŠ¤í…œ ë„ì… ê°€ëŠ¥)
            player.money = 0; 
        }

        // íŒì—… í˜¸ì¶œ (ì´ë¦„ ì „ë‹¬)
        setTimeout(() => {
            openPaydayPopup(monthlyIncome, monthlyCost, costName);
        }, 300); 
    }

    // 2. í”„ë¡œì íŠ¸ ê¸°í•œ ì²´í¬
    if(!player.isPhase2 && player.isProjectStarted) { 
        player.currentWeekInProject++; 
        if(player.currentWeekInProject >= player.deadline) finishProject(); 
    }
    
    if(player.isPhase2 && player.currentProject) { 
        player.currentProject.currentWeek++;
        if(player.currentProject.currentWeek > player.currentProject.deadline) rejectProject();
    }
    
    // 3. ìŠ¹ì§„ ë¡œì§
    if(player.isPhase2 && player.performance >= 100) {
        if(player.rank < 3) { 
            player.rank++;
            player.performance = 0;
            updateSalary();
            alert(`ğŸ‰ [${RANKS[player.rank]}]ë¡œ ìŠ¹ì§„! ì—°ë´‰ í˜‘ìƒ ì™„ë£Œ!`);
        } else { 
            player.performance = 0;
            // ì„ì› ì„±ê³¼ê¸‰ (ì›”ê¸‰ì˜ 50% ì •ë„ ë³´ë„ˆìŠ¤)
            let bonus = Math.floor(player.salary * 2.5); // 4.5ì£¼ê¸‰ì˜ ì ˆë°˜ ìˆ˜ì¤€ì¸ 2.5ë°°ë¡œ ìƒí–¥
            player.money += bonus;
            alert(`ğŸ‰ ì„ì› ì„±ê³¼ê¸‰ ì§€ê¸‰! (+${bonus.toLocaleString()}ì›)`);
        }
    }

    if(player.totalWeeks % 60 === 0) { 
        generateJobs(); 
        if(document.getElementById('job-popup').style.display === 'flex') openJobMarket(); 
    }
    
    saveGameData(); 
    updateUI();
}

// [ìˆ˜ì •] openPaydayPopup í•¨ìˆ˜ (í•­ëª© ì´ë¦„í‘œì‹œ ì¶”ê°€)
// costName íŒŒë¼ë¯¸í„° ì¶”ê°€ë¨
window.openPaydayPopup = function(income, cost, costName="ì„¸ê¸ˆ ë° í’ˆìœ„ ìœ ì§€ë¹„") {
    
    document.getElementById('pay-income').innerText = `+ ${income.toLocaleString()}`;
    
    // ì§€ì¶œ í•­ëª© ì´ë¦„ ë³€ê²½ ë¡œì§
    // HTMLì— <span id="pay-cost-label">...</span> íƒœê·¸ê°€ ì—†ìœ¼ë¯€ë¡œ
    // pay-cost ìš”ì†Œì˜ í˜•ì œ ìš”ì†Œ(í…ìŠ¤íŠ¸)ë¥¼ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤. 
    // ê°€ì¥ ì‰¬ìš´ ë°©ë²•: HTML êµ¬ì¡°ë¥¼ ì‚´ì§ ê±´ë“œë¦¬ì§€ ì•Šê³  JSë¡œ ì²˜ë¦¬
    
    const costLabel = document.querySelector('#pay-cost').previousElementSibling;
    if(costLabel) costLabel.innerText = `(-) ${costName}`;

    document.getElementById('pay-cost').innerText = `- ${cost.toLocaleString()}`;
    
    let total = income - cost;
    let color = total >= 0 ? '#3182F6' : '#FF5F5F';
    let sign = total >= 0 ? '+' : '';
    
    document.getElementById('pay-total').innerText = `${sign} ${total.toLocaleString()}`;
    document.getElementById('pay-total').style.color = color;

    // ë©˜íŠ¸ ì„¤ì •
    let msg = "ì´ë²ˆ ë‹¬ë„ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.";
    if(total < 0) msg = "âš ï¸ ì”ê³ ê°€ ì¤„ì–´ë“¤ê³  ìˆìŠµë‹ˆë‹¤. (ì ì)";
    else if(total > 10000000) msg = "ğŸ’° ê¸ˆìœµ ì¹˜ë£Œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
    
    document.getElementById('pay-msg').innerText = msg;
    
    openPopup('payday-popup');
}

function updateSalary() {
    let base = BASE_SALARY[player.tier] || 180000;
    let multi = RANK_MULTIPLIER[player.rank] || 1;
    
    // [NEW] ëª…ì˜ˆì˜ ì „ë‹¹(Wealth) ë²„í”„ ì ìš©
    let buff = getHofBuffs().wealth; // ì˜ˆ: 3, 6, 9
    let buffMult = 1 + (buff / 100);

    player.salary = Math.floor(base * multi * buffMult);
}

   // [Ver 67.0] UI ë‚ ì§œ í‘œì‹œ ë³€ê²½ (ì£¼ -> ì¼)
// [ìˆ˜ì •ëœ updateUI í•¨ìˆ˜] : ë‚ ì§œ ë° ì§ê¸‰ í‘œì‹œ ë¡œì§ ë³€ê²½
function updateUI() {
    // 1ë…„ = 360ì¼, 1ë‹¬ = 30ì¼ ê¸°ì¤€ ê³„ì‚°
    let totalDays = player.totalWeeks; 
    let y = Math.floor(totalDays / 360) + 1;
    let m = Math.floor((totalDays % 360) / 30) + 1;
    let d = (totalDays % 30) + 1;
    
    let dateStr = `${y}ë…„ ${m}ì›” ${d}ì¼`;

    if(!player.isPhase2) { 
        // Phase 1 UI
        if(document.getElementById('ui-money')) {
            document.getElementById('ui-week').innerText = dateStr;
            document.getElementById('ui-money').innerText = player.money.toLocaleString();
            document.getElementById('hp-bar').style.width = player.hp + "%";
            document.getElementById('exp-bar').style.width = (player.designStat % 100) + "%";
            document.getElementById('ui-lv').innerText = Math.floor(player.designStat / 100) + 1;
            document.getElementById('pf-bar').style.width = Math.min(player.portfolioProgress, 100) + "%";
            
            // ... (ë²„íŠ¼ ë¡œì§ ê¸°ì¡´ ìœ ì§€) ...
            const btn = document.getElementById('btn-work');
            if(player.isProjectStarted) {
                btn.querySelector('div').innerText="í¬í´ ì‘ì—…"; 
                let left = player.deadline - player.currentWeekInProject;
                btn.querySelector('span').innerText=`ë§ˆê° D-${left}`; 
                btn.style.backgroundColor="#FF8B8B";
                document.getElementById('ui-deadline').innerText = `ë§ˆê° D-${left}`;
            } else {
                btn.querySelector('div').innerText="ìƒˆ í”„ë¡œì íŠ¸"; 
                btn.querySelector('span').innerText="ê¸°íší•˜ê¸°"; 
                btn.style.backgroundColor="#FF8B8B";
                document.getElementById('ui-deadline').innerText = "";
            }
        }
    } else { 
        // Phase 2 UI
        if(document.getElementById('p2-ui-money')) {
            // [ìˆ˜ì •] ë‚ ì§œì—ì„œ í‹°ì–´ ì œê±° -> ê·¸ëƒ¥ ë‚ ì§œë§Œ í‘œì‹œ
            document.getElementById('p2-ui-week').innerText = dateStr; 
            
            document.getElementById('p2-ui-money').innerText = player.money.toLocaleString();
            
            let maxHp = getMaxHp();
            let hpPercent = Math.min(100, (player.hp / maxHp) * 100);
            document.getElementById('p2-mental-bar').style.width = hpPercent + "%"; 
            
            document.getElementById('p2-skill-bar').style.width = (player.designStat%100)+"%"; 
            document.getElementById('p2-ui-lv').innerText = Math.floor(player.designStat/100)+1;
            document.getElementById('p2-perf-bar').style.width = Math.min(player.performance,100)+"%";
            
            // [ìˆ˜ì •] ì§ê¸‰ ë±ƒì§€ì— íšŒì‚¬ í‹°ì–´ í‘œì‹œ -> "ì‚¬ì› (Agency)"
            const rankEl = document.getElementById('p2-rank-badge');
            if(rankEl) {
                rankEl.innerText = `${RANKS[player.rank]} (${player.tier})`;
            }
            
            renderProjectWidget();
        }
    }
}
        function renderProjectWidget() {
            const w = document.getElementById('p2-project-widget');
            if(!player.currentProject) { w.style.display='none'; return; }
            w.style.display = 'block';
            
            document.getElementById('pw-title').innerText = `${player.currentProject.name} (${player.currentProject.tier}ê¸‰)`;
            let left = player.currentProject.deadline - player.currentProject.currentWeek;
            document.getElementById('pw-day').innerText = left < 0 ? 0 : left;
            
            let per = Math.min(100, Math.floor(player.currentProject.progress));
            document.getElementById('pw-percent').innerText = per + "%";
            document.getElementById('pw-bar').style.width = per + "%";
            
            document.getElementById('pw-stamp').style.opacity = player.currentProject.tier !== player.currentProject.originalTier ? 1 : 0; 

            // ë§ˆê° ì„ë°• ë²„íŠ¼ í‘œì‹œ ë¡œì§
            const extBtn = document.getElementById('pw-extend-btn');
            if (extBtn) {
                if (left <= 1 && per < 100 && !player.currentProject.isExtended) {
                    extBtn.style.display = 'block';
                    extBtn.style.animation = 'blink 1s infinite alternate'; 
                } else {
                    extBtn.style.display = 'none';
                    extBtn.style.animation = 'none';
                }
            }
        }

        window.openExtensionPopup = function() {
            openPopup('extension-popup');
        }

        window.doExtendDeadline = function() {
            closePopup();
            if (player.currentProject && !player.currentProject.isExtended) {
                player.currentProject.deadline += 1; 
                player.currentProject.isExtended = true; 
                
                alert("ğŸ“ [í†µí™” ì„±ê³µ]\ní´ë¼ì´ì–¸íŠ¸: \"ë”± í•œ ë²ˆë§Œ ë´ë“œë¦¬ëŠ” ê²ë‹ˆë‹¤. ë‹¤ìŒì€ ì—†ì–´ìš”.\"\n(ë§ˆê° ê¸°í•œ +1ì£¼ ì—°ì¥ë¨ / ì¬ì‚¬ìš© ë¶ˆê°€)");
                
                updateUI(); 
            }
        }

/* [ìˆ˜ì •] ì»·ì‹  ì¬ìƒ í•¨ìˆ˜ (ì•Œë°”, íœ´ì‹, ê³µë¶€, ì—…ë¬´ ë“± ê³µìš©) */
/* [ìˆ˜ì •] ì»·ì‹  ì¬ìƒ í•¨ìˆ˜ (ì—…ë¬´, ì•Œë°”, íœ´ì‹ ë“± ê³µìš©) */
function playScene(key, msgs, cb) {
    player.isBusy = true; 
    updateAudioState('mute');
    
    // 1. UI ìˆ¨ê¹€
    document.getElementById(player.isPhase2 ? 'phase2-ui-layer' : 'ui-layer').style.display = 'none';
    
    // 2. ë°°ê²½ ì„¤ì •
    let tex = key; 
    if(!sceneContext.textures.exists(tex)) tex = 'bg_main'; // ì•ˆì „ì¥ì¹˜
    
    sceneImage.setTexture(tex); 
    fitToScreen(sceneImage); // ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ê½‰ ì°¨ê²Œ ë§ì¶¤
    
    // ë°°ê²½ë§‰(ì˜¤ë²„ë ˆì´) ì¼œê¸° (Depth: 100)
    sceneOverlay.setVisible(true); 

    // 3. ìºë¦­í„° í‘œì‹œ ë¡œì§ ìˆ˜ì •
    // â˜… [í•µì‹¬ 1] 'bg_company'ê°€ ì•„ë‹ˆë¼, ì‹¤ì œ ì‚¬ë¬´ì‹¤ ë°°ê²½ ì´ë¦„ë“¤ì„ ì²´í¬í•´ì•¼ í•¨
    const officeBgs = ['bg_office', 'bg_toptier', 'bg_unicorn', 'bg_global', 'bg_space', 
                       'bg_office_night', 'bg_toptier_night', 'bg_unicorn_night', 'bg_global_night', 'bg_space_night'];

    // í˜ì´ì¦ˆ 2ì´ê³ , í˜„ì¬ ë°°ê²½ì´ ì‚¬ë¬´ì‹¤ ë°°ê²½ ì¤‘ í•˜ë‚˜ë¼ë©´?
    if (player.isPhase2 && officeBgs.includes(key)) {
        if (charSuitWorkSprite) {
            charSuitWorkSprite.setVisible(true);
            
            // â˜… [í•µì‹¬ 2] ìºë¦­í„°ë¥¼ ë°°ê²½ë§‰(100)ë³´ë‹¤ ì•ìœ¼ë¡œ ê°€ì ¸ì˜´ (101)
            charSuitWorkSprite.setDepth(101); 
            
            // í¬ê¸° ë° ìœ„ì¹˜ ì¬ì¡°ì •
            adjustCharacterSize(charSuitWorkSprite, sceneContext.scale.width, sceneContext.scale.height);
        }
        
        // ë‚˜ë¨¸ì§€ ìºë¦­í„°ëŠ” ìˆ¨ê¹€
        if (charHoodieSprite) charHoodieSprite.setVisible(false);
        if (charSuitSprite) charSuitSprite.setVisible(false);
        if (charWorkSprite) charWorkSprite.setVisible(false);

    } else {
        // ì—…ë¬´ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì»·ì‹ (ì•Œë°”, íœ´ì‹, ì—¬í–‰ ë“±)ì—ì„œëŠ” ìºë¦­í„° ëª¨ë‘ ìˆ¨ê¹€
        if (charHoodieSprite) charHoodieSprite.setVisible(false);
        if (charSuitSprite) charSuitSprite.setVisible(false);
        if (charWorkSprite) charWorkSprite.setVisible(false);
        if (charSuitWorkSprite) charSuitWorkSprite.setVisible(false);
    }

    // 4. ëŒ€í™”ì°½ í‘œì‹œ
    const msgLayer = document.getElementById('scene-message-layer');
    const msgText = document.getElementById('scene-msg-text');
    msgLayer.style.display = 'flex';
    
    let count = 0; 
    msgText.innerText = msgs[Math.floor(Math.random() * msgs.length)];
    
    let iv = setInterval(() => { 
        msgText.innerText = msgs[Math.floor(Math.random() * msgs.length)]; 
        count++; 
        if(count >= 3) { 
            clearInterval(iv); 
            
            // 5. ì¢…ë£Œ ë° ë³µêµ¬
            sceneOverlay.setVisible(false); // ì»·ì‹  ë„ê¸°
            msgLayer.style.display = 'none'; 
            
            // ì»·ì‹  ì¢…ë£Œ í›„ ì›ë˜ ë©”ì¸ í™”ë©´ ìºë¦­í„° ë³µêµ¬
            if(player.isPhase2) {
                if(charSuitWorkSprite) {
                    charSuitWorkSprite.setVisible(true);
                    // â˜… [í•µì‹¬ 3] ëë‚˜ë©´ ë‹¤ì‹œ ì›ë˜ ê¹Šì´(5)ë¡œ ë˜ëŒë¦¼ (ì•ˆì „ì¥ì¹˜)
                    charSuitWorkSprite.setDepth(5); 
                }
            } else {
                if(charWorkSprite) {
                    charWorkSprite.setVisible(true);
                    charWorkSprite.setDepth(5);
                }
            }

            // UI ë³µêµ¬
            document.getElementById(player.isPhase2 ? 'phase2-ui-layer' : 'ui-layer').style.display = 'flex'; 
            player.isBusy = false; 
            
            cb(); // ì½œë°± ì‹¤í–‰ (ëˆ ì¦ê°€ ë“±)
            updateUI(); 
            updateAudioState('main');
        } 
    }, 1000);
}
/* [ìˆ˜ì •] playPortfolioSequence: ë°•ìŠ¤ ì œì–´ ì½”ë“œ ì‚­ì œ & ë¦¬ì‚¬ì´ì§• ìœ ì§€ */
function playPortfolioSequence(cb) {
    player.isBusy = true; 
    document.getElementById('ui-layer').style.display = 'none';
    
    // 1. ì´ë¯¸ì§€ êµì²´
    if(sceneContext.textures.exists('scene_burning')) {
        portfolioOverlay.list[1].setTexture('scene_burning');
    }
    
    // 2. ì˜¤ë²„ë ˆì´ ì¼œê¸°
    portfolioOverlay.setVisible(true);

    // â˜… ì´ë¯¸ì§€ í¬ê¸° ë§ì¶¤ (í•„ìˆ˜)
    if(typeof fitToScreen === 'function') fitToScreen(portfolioOverlay.list[1]);

    // 3. HTML ëŒ€í™”ì°½
    const msgLayer = document.getElementById('scene-message-layer');
    const msgText = document.getElementById('scene-msg-text');
    msgLayer.style.display = 'flex';

    let count = 0;
    msgText.innerText = msgs.pf[Math.floor(Math.random() * msgs.pf.length)];

    let iv = setInterval(() => { 
        msgText.innerText = msgs.pf[Math.floor(Math.random() * msgs.pf.length)]; 
        count++; 
        if(count >= 3) { 
            clearInterval(iv); 
            portfolioOverlay.setVisible(false); 
            msgLayer.style.display = 'none'; 
            document.getElementById('ui-layer').style.display = 'flex'; 
            player.isBusy = false; 
            cb(); 
            updateUI(); 
        } 
    }, 1000);
}

        window.openPopup = function(id) { if(player.isBusy) return; document.getElementById('modal-overlay').style.display='block'; document.getElementById(id).style.display='flex';updateAudioState('mute'); }
        window.closePopup = function() { document.getElementById('modal-overlay').style.display='none'; document.querySelectorAll('.popup').forEach(p=>p.style.display='none'); updateAudioState('main');}
        window.showAd = function(cb) { document.getElementById('ad-overlay').style.display='flex'; adCallback = cb;updateAudioState('mute'); }
        window.closeAd = function() { document.getElementById('ad-overlay').style.display = 'none'; if(adCallback) { adCallback(); adCallback=null;updateAudioState('main'); } }

        window.openAlbaPopup = function() { document.getElementById('btn-normal-alba').disabled = player.workedThisWeek; openPopup('alba-popup'); }
// [1] ì•Œë°”ë¹„ ì¸ìƒ ë¡œì§ (40,000 -> 50,000)
window.startWorking = function(type) {
    if(player.hp < 20) return alert("ì²´ë ¥ ë¶€ì¡±");
    
    // â˜… [ìˆ˜ì •] ì¼ë°˜ ì•Œë°”ë¹„ 50,000ì›ìœ¼ë¡œ ë³€ê²½
    let reward = (type === 'normal') ? 50000 : 100000;
    
    closePopup();
    
    playScene('bg_alba', msgs.alba, () => {
        player.money += reward; 
        player.hp -= 20; 
        if(type === 'normal') player.workedThisWeek = true; 
        
        showLog(`ì•Œë°” ì™„ë£Œ! +${reward.toLocaleString()}ì›`); 
        
        // ëˆ íšë“ í”Œë¡œíŒ…
        showFloatingText(180, 230, `+${reward/10000}ë§Œ`, '#FFD700');
        // ì²´ë ¥ ê°ì†Œ í”Œë¡œíŒ…
        showFloatingText(180, 280, `-20 HP`, '#FF5F5F');

        addTime();
    });
}

// [2] íŒì—…ì°½ í…ìŠ¤íŠ¸ë„ ìë™ìœ¼ë¡œ ìˆ˜ì • (+4ë§Œ -> +5ë§Œ)
// ì´ ì½”ë“œëŠ” ì¦‰ì‹œ ì‹¤í–‰ë˜ì–´ í™”ë©´ì˜ ê¸€ìë¥¼ ë°”ê¿”ì¤ë‹ˆë‹¤.
const albaLabel = document.querySelector('#alba-popup .card-btn:nth-of-type(1) p');
if(albaLabel) {
    albaLabel.innerText = "+5ë§Œ / HP -20";
}
// [NEW] íŠ¹ê¸‰ ì•¼ê·¼(ê´‘ê³ ) ì‹œë„ í•¨ìˆ˜ (ì²´ë ¥ ì„ ì²´í¬)
window.trySpecialAlba = function() {
    // 1. ì²´ë ¥ì„ ë¨¼ì € ì²´í¬í•©ë‹ˆë‹¤ (ì´ê²Œ í•µì‹¬!)
    if(player.hp < 20) {
        return alert("ì²´ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: 20)");
    }
    
    // 2. ì²´ë ¥ì´ ì¶©ë¶„í•  ë•Œë§Œ ê´‘ê³ ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤
    showAd(function(){
        startWorking('special');
    });
}
// [Ver 64.8 Fix] íœ´ì‹ íŒì—… (í…Œë‹ˆìŠ¤ ë©˜íƒˆ íšŒë³µëŸ‰ í‘œê¸° ì¶”ê°€)
window.openP2RestPopup = function() {
    // 1. í‹°ì–´ë³„ ë¹„ìš© ë° ì„±ê³¼ ê³„ì‚°
    let cost = 50000;
    let bonus = 1;
    
    if (player.tier === 'Space') { cost = 50000000; bonus = 3; }
    else if (player.tier === 'Global') { cost = 5000000; bonus = 2; }
    else if (player.tier === 'Unicorn') { cost = 1000000; bonus = 2; }
    else if (player.tier === 'TopTier') { cost = 150000; bonus = 1; }
    else { cost = 50000; bonus = 1; } // Agency

    // 2. UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ë©˜íƒˆ +30 ë¬¸êµ¬ ì¶”ê°€)
    const costEl = document.getElementById('p2-tennis-cost');
    if (costEl) {
        // [ìˆ˜ì •ë¨] "50,000ì› (ë©˜íƒˆ +30, ì„±ê³¼ +1)" í˜•ì‹ìœ¼ë¡œ ë³€ê²½
        costEl.innerText = `${cost.toLocaleString()}ì› (ë©˜íƒˆ +30, ì„±ê³¼ +${bonus})`;
    }

    // 3. íŒì—… ì—´ê¸°
    openPopup('p2-rest-popup');
}
        // [Ver 60.0] ì‚¬íšŒìƒí™œ íŒì—… ë‚´ìš© ê°œí¸
window.openSocialPopup = function() {
    if(player.hp < 10) return alert("ë©˜íƒˆì´ ë„ˆë¬´ ì•½í•´ì„œ ì‚¬ëŒì„ ëŒ€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    
    const rand = Math.random();
    const container = document.getElementById('social-content');
    const title = document.getElementById('social-title');
    
    // 50% í™•ë¥ ë¡œ í€´ì¦ˆ, 50% í™•ë¥ ë¡œ íƒ•ë¹„ì‹¤ ì´ë²¤íŠ¸
    if(rand < 0.5) {
        const quiz = dadJokes[Math.floor(Math.random() * dadJokes.length)];
        title.innerText = "ğŸ‘¨â€ğŸ’¼ ë¶€ì¥ë‹˜ì˜ ê¸°ìŠµ í€´ì¦ˆ!";
        container.innerHTML = `
            <div class="quiz-box">
                <div class="quiz-q">"ìë„¤, ${quiz.q}"</div>
                <input type="text" id="quiz-input" class="quiz-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
                <button class="full-btn" onclick="checkDadJoke('${quiz.a}')">ì •ë‹µ ì™¸ì¹˜ê¸°</button>
            </div>
        `;
    } else {
        title.innerText = "â˜• íƒ•ë¹„ì‹¤ ìƒì¡´ ì „ëµ";
        container.innerHTML = `
            <div class="card-btn pantry-option" onclick="doPantryAction('politics')">
                <div class="card-info">
                    <span class="pantry-tag" style="background:#7274ED; color:#fff">ì•¼ë§</span>
                    <h3>ğŸ‘¨â€ğŸ’¼ ì‚¬ë‚´ ë¼ì¸ íƒ€ê¸°</h3>
                    <p>ì„±ê³µ(30%): <span style="color:#FFD700">ì„±ê³¼ +15</span> / ì‹¤íŒ¨: ë©˜íƒˆ -30, ì„±ê³¼ -5</p>
                </div>
            </div>
            
            <div class="card-btn pantry-option" onclick="doPantryAction('gossip')">
                <div class="card-info">
                    <span class="pantry-tag" style="background:#FF5F5F; color:#fff">ìœ„í—˜</span>
                    <h3>ğŸ¤¬ ë’·ë‹´í™” í•˜ê¸°</h3>
                    <p>ì„±ê³µ(40%): <span style="color:#4CD964">ë©˜íƒˆ +50</span> / ì‹¤íŒ¨: ì„±ê³¼ -5</p>
                </div>
            </div>
            
            <div class="card-btn pantry-option" onclick="doPantryAction('snack')">
                <div class="card-info">
                    <span class="pantry-tag" style="background:#FFB356; color:#fff">ì•ˆì „</span>
                    <h3>ğŸª ë²•ì¹´ë¡œ ê°„ì‹ ë¨¹ê¸°</h3>
                    <p>ì„±ê³µ(90%): ë©˜íƒˆ +10 / ì‹¤íŒ¨: ë©˜íƒˆ -5</p>
                </div>
            </div>
        `;
    }
    openPopup('social-popup');
}

        window.checkDadJoke = function(answer) {
            const input = document.getElementById('quiz-input').value.replace(/\s+/g, ''); 
            const cleanAnswer = answer.replace(/\s+/g, '');
            closePopup();
            if(input === cleanAnswer) {
                player.performance += 10; player.hp = Math.min(100, player.hp + 5);
                alert(`ë¶€ì¥ë‹˜: "ì˜¤ì˜¤!! ì—­ì‹œ ìë„¤ëŠ” ì„¼ìŠ¤ê°€ ìˆì–´!"\n(ì„±ê³¼ +10, ë©˜íƒˆ +5)`);
            } else {
                player.performance = Math.max(0, player.performance - 10); 
                player.hp -= 5;
                alert(`ë¶€ì¥ë‹˜: "ì—ì‰ ì¯§ì¯§.. ì„¼ìŠ¤ê°€ ì—†êµ¬ë§Œ."\n(ì„±ê³¼ -5, ë©˜íƒˆ -10)`);
            }
            addTime(true);
        }

       // [Ver 60.0] íƒ•ë¹„ì‹¤ ì•¡ì…˜ ë¡œì§ (ë°¸ëŸ°ìŠ¤ ì ìš©)
window.doPantryAction = function(type) {
    closePopup();
    const rand = Math.random();
    
    // 1. ì‚¬ë‚´ ë¼ì¸ íƒ€ê¸° (Politics)
    if(type === 'politics') {
        if(rand < 0.3) { // 30% ì„±ê³µ
            player.performance = Math.min(100, player.performance + 15); 
            alert("ì´ì‚¬ë‹˜ ë¼ì¸ì„ ì œëŒ€ë¡œ íƒ”ìŠµë‹ˆë‹¤!\n(ì„±ê³¼ +15 ë–¡ìƒ!)");
        } else { 
            player.hp -= 30; 
            // â˜… ì‹¤íŒ¨ ì‹œ ì„±ê³¼ -5 ì¶”ê°€
            player.performance = Math.max(0, player.performance - 5);
            alert("ì¤„ì„ ì˜ëª» ì„°ìŠµë‹ˆë‹¤... ì´ì‚¬ë‹˜ì´ ì €ë¥¼ ì§¸ë ¤ë´…ë‹ˆë‹¤.\n(ë©˜íƒˆ -30, ì„±ê³¼ -5)");
        }
    }
    // 2. ë’·ë‹´í™” (Gossip)
    else if(type === 'gossip') {
        if(rand < 0.4) { // 40% ì„±ê³µ
            player.hp = Math.min(100, player.hp + 50); 
            alert("ìƒì‚¬ í‰ì„ ë³´ë‹ˆ ì‹­ë…„ ë¬µì€ ì²´ì¦ì´ ë‚´ë ¤ê°‘ë‹ˆë‹¤!\n(ë©˜íƒˆ +50 íšŒë³µ)");
        } else { // 50% ì‹¤íŒ¨
            player.performance = Math.max(0, player.performance - 5);
            alert("ë¬¸ ë’¤ì— ë¶€ì¥ë‹˜ì´ ê³„ì…¨ìŠµë‹ˆë‹¤...\n(ì„±ê³¼ -5 ê°ì )");
        }
    } 
    // 3. ê°„ì‹ (Snack)
    else if(type === 'snack') {
        if(rand < 0.9) { // 90% ì„±ê³µ
            player.hp = Math.min(100, player.hp + 10); 
            alert("ë‹¹ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤. (ë©˜íƒˆ +10)");
        } else {
            player.hp -= 5; 
            alert("ë¶€ì¥ë‹˜: \"ìë„¤ë§Œ ì…ì¸ê°€?\"\n(ëºê¹€, ë©˜íƒˆ -5)");
        }
    }
    
    addTime(true); // ì‚¬íšŒìƒí™œë„ ì—…ë¬´ì˜ ì—°ì¥ì„  (ì‹œê°„ ê²½ê³¼)
}

        window.doSkillUp = function(type) {
            if(player.hp < 20) return alert("ì²´ë ¥ ë¶€ì¡±");
            let cost=0, gain=0;
            if(type === 'ai') { cost = 40000; gain = 2; } 
            else if(type === 'oneday') { cost = 150000; gain = 10; } 
            else { cost = 500000; gain = 50; }
            if(player.money < cost) return alert("ëˆ ë¶€ì¡±");
            closePopup();
            playScene('scene_study', msgs.study, () => { 
                player.money -= cost; player.hp -= 20; player.designStat += gain; 
                showLog(`ìŠ¤í‚¬ ì—…! (+${gain})`); addTime(); 
            });
        }
        
// [Ver 73.2 Fix] êµìœ¡ë¹„ ì¦ê°€í­ ì™„í™” (ë ˆë²¨ë‹¹ 70% -> 50%)
function getSkillCost(type) {
    let baseCost = 0;
    
    // ê¸°ë³¸ ê°€ê²© (ë³€ê²½ ì—†ìŒ)
    if (type === 'sub') baseCost = 40000;          
    else if (type === 'seminar') baseCost = 150000; 
    else if (type === 'deprep') baseCost = 500000;  

    let lvl = Math.floor(player.designStat / 100); 

    return Math.floor(baseCost * (1 + (lvl * 0.4)));
}

// [Ver 83.0 Fix] ìê¸°ê³„ë°œ íš¨ìœ¨ ê°ì†Œí­ ì™„í™” (í‘œê¸° ë¡œì§)
window.openP2SkillPopup = function() {
    // 1. ë¹„ìš© ê³„ì‚°
    const c1 = getSkillCost('sub');
    const c2 = getSkillCost('seminar');
    const c3 = getSkillCost('deprep');

    // 2. íš¨ìœ¨ ê³„ì‚° (ì™„í™”ëœ ë¡œì§ ì ìš©)
    let lvl = Math.floor(player.designStat / 100);
    let efficiency = 1.0; 
    
    // [ìˆ˜ì •] Lv.15ê¹Œì§€ 100% ìœ ì§€ -> ì´í›„ ì²œì²œíˆ ê°ì†Œ
    if (lvl >= 50) efficiency = 0.6;      // ì´ˆê³ ë ˆë²¨ (60%)
    else if (lvl >= 30) efficiency = 0.8; // ê³ ë ˆë²¨ (80%)
    else if (lvl >= 15) efficiency = 0.9; // ì¤‘ë ˆë²¨ (90%)
    else efficiency = 1.0;                // ì´ˆë°˜ (100%)
    
    // 3. ì‹¤ì œ íšë“ëŸ‰ ê³„ì‚°
    const g1 = Math.max(1, Math.floor(2 * efficiency));
    const g2 = Math.max(1, Math.floor(10 * efficiency));
    const g3 = Math.max(1, Math.floor(40 * efficiency));

    // 4. UI ì—…ë°ì´íŠ¸
    if(document.getElementById('p2-cost-sub')) {
        document.getElementById('p2-cost-sub').innerText = `ìŠ¤í‚¬ +${g1} (${c1.toLocaleString()}ì›)`;
        document.getElementById('p2-cost-seminar').innerText = `ìŠ¤í‚¬ +${g2} (${c2.toLocaleString()}ì›)`;
        document.getElementById('p2-cost-deprep').innerText = `ìŠ¤í‚¬ +${g3} (${c3.toLocaleString()}ì›)`;
    }

    openPopup('p2-skill-popup');
}

// [Ver 83.0 Fix] ìê¸°ê³„ë°œ íš¨ìœ¨ ê°ì†Œí­ ì™„í™” (ì‹¤ì œ ì ìš©)
window.doP2SkillAction = function(type) {
    if(player.hp < 20) return alert("ë©˜íƒˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: 20)");
    
    // 1. ë¹„ìš© ê³„ì‚°
    let cost = getSkillCost(type);
    
    // 2. ê¸°ë³¸ íšë“ëŸ‰
    let baseGain = 0;
    if (type === 'sub') baseGain = 2;
    else if (type === 'seminar') baseGain = 10;
    else if (type === 'deprep') baseGain = 40;

    if(player.money < cost) {
        return alert(`ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.\ní•„ìš” ê¸ˆì•¡: ${cost.toLocaleString()}ì›`);
    }

    // 3. [ìˆ˜ì •] íš¨ìœ¨ ê°ì†Œ ë¡œì§ ì™„í™” (Soft Cap)
    let lvl = Math.floor(player.designStat / 100);
    let efficiency = 1.0; 
    
    if (lvl >= 50) efficiency = 0.6;      // Lv.50~ : 60% (ê¸°ì¡´ 40%ì—ì„œ ìƒí–¥)
    else if (lvl >= 30) efficiency = 0.8; // Lv.30~ : 80% (ê¸°ì¡´ 40%ì—ì„œ ëŒ€í­ ìƒí–¥)
    else if (lvl >= 15) efficiency = 0.9; // Lv.15~ : 90% (ê¸°ì¡´ 60~80%ì—ì„œ ìƒí–¥)
    else efficiency = 1.0;                // Lv.0~14: 100% (íŒ¨ë„í‹° ì—†ìŒ)
    
    // ìµœì¢… íšë“ëŸ‰ (ìµœì†Œ 1ì  ë³´ì¥)
    let actualGain = Math.max(1, Math.floor(baseGain * efficiency));

    closePopup();
    
    playScene('scene_study', msgs.study, () => {
        player.money -= cost; 
        player.hp -= 20; 
        player.designStat += actualGain;
        
        // ê²°ê³¼ ë¡œê·¸
        let resultMsg = `ìê¸°ê³„ë°œ ì™„ë£Œ! (ìŠ¤í‚¬ +${actualGain})`;
        if (efficiency < 1.0) {
            resultMsg += ` [íš¨ìœ¨ ${Math.round(efficiency*100)}%]`;
        }
        
        showP2Log(resultMsg); 
        addTime(false);
    });
}

        window.doRest = function(type) {
            closePopup(); let rec=0, cost=0; 
            if(type==='coffee'){rec=30; cost=5000;} else if(type==='sleep'){rec=60; cost=0;} else {rec=100; cost=0;}
            if(player.money < cost) return alert("ëˆ ë¶€ì¡±");
            player.money -= cost; 
            playScene('bg_sleep', ["íœ´ì‹ ì¤‘..."], () => { player.hp = Math.min(100, player.hp + rec); 
                // [â˜… ì¶”ê°€] íšŒë³µ í”Œë¡œíŒ… (ì´ˆë¡ìƒ‰)
    showFloatingText(180, 230, `+${rec} HP`, '#4CD964');
                if(type==='sleep') addTime(); else updateUI(); showLog("íœ´ì‹ ì™„ë£Œ."); });
        }
        
        // [ìˆ˜ì •ë¨] íœ´ì‹ í•¨ìˆ˜ (ìˆœìˆ˜ íšŒë³µ + ìµœëŒ€ ì²´ë ¥ ë°˜ì˜)
// [Ver 64.5 Fix] íœ´ì‹ í•¨ìˆ˜ (í…Œë‹ˆìŠ¤ ë¹„ìš© í˜„ì‹¤í™” & ì„±ê³¼ ë„ˆí”„)
window.doP2RestAction = function(type) {
    closePopup();
    let rec=0, cost=0, msg="", bgKey="";
    let perfBonus = 0; 

    if(type==='tennis') { 
        rec=30; // ì²´ë ¥ íšŒë³µëŸ‰ì€ 30 ê³ ì •
        bgKey = 'bg_tenis';
        
        // [NEW] í‹°ì–´ë³„ í…Œë‹ˆìŠ¤ ë¹„ìš© & ì„±ê³¼ ì°¨ë“± ì ìš©
        // Agency: 5ë§Œ (+1) / Space: 5,000ë§Œ (+3)
        if (player.tier === 'Space') {
            cost = 50000000; perfBonus = 3;
            msg = "ìš°ì£¼ ì •ê±°ì¥ ì½”íŠ¸ì—ì„œ í•œ ê²Œì„! (ì„±ê³¼ +3)";
        } else if (player.tier === 'Global') {
            cost = 5000000; perfBonus = 2;
            msg = "VIP ì „ë‹´ ì½”ì¹˜ ë ˆìŠ¨! (ì„±ê³¼ +2)";
        } else if (player.tier === 'Unicorn') {
            cost = 1000000; perfBonus = 2;
            msg = "í˜¸í…” ë©¤ë²„ì‹­ í´ëŸ½ ë¼ìš´ë”© (ì„±ê³¼ +2)";
        } else if (player.tier === 'TopTier') {
            cost = 150000; perfBonus = 1;
            msg = "ì‚¬ì„¤ ì‹¤ë‚´ í…Œë‹ˆìŠ¤ì¥ ë ˆìŠ¨ (ì„±ê³¼ +1)";
        } else {
            // Agency
            cost = 50000; perfBonus = 1;
            msg = "ë™ë„¤ í…Œë‹ˆìŠ¤ì¥ ëŒ€ê´€ (ì„±ê³¼ +1)";
        }
    }
    else if(type==='home') { 
        rec=60; cost=0; msg="ë„·í”Œë¦­ìŠ¤ ì •ì£¼í–‰... (íë§)"; 
        bgKey = 'bg_netflix';
    }
    else if(type==='full') { 
        rec=0; // ì•„ë˜ì—ì„œ Maxë¡œ ì²˜ë¦¬
        cost=0; msg="í•´ì™¸ì—¬í–‰ ë‹¤ë…€ì™”ìŠµë‹ˆë‹¤! (ë©˜íƒˆ ì™„ì „ íšŒë³µ)"; 
        bgKey = 'bg_travel';
    }
    
    // ë¹„ìš© ì²´í¬
    if(player.money < cost) return alert(`ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${cost.toLocaleString()}ì›)`);
    player.money -= cost; 
    
    playScene(bgKey, [msg], () => {
        let max = getMaxHp(); 

        if (type === 'full') {
            player.hp = max; // ì—¬í–‰ì€ í’€ì¶©ì „
            rec = max; 
        } else {
            player.hp = Math.min(max, player.hp + rec);
        }
        
        // ì„±ê³¼ ë³´ë„ˆìŠ¤ ì ìš©
        if(perfBonus > 0) {
            player.performance = Math.min(100, player.performance + perfBonus);
            showP2Log(`íœ´ì‹ ì™„ë£Œ! (ë©˜íƒˆ +${rec}, ì„±ê³¼ +${perfBonus})`);
        } else {
            if (type === 'full') showP2Log("íœ´ì‹ ì™„ë£Œ! (ë©˜íƒˆ ì™„ì „ íšŒë³µ)");
            else showP2Log(`íœ´ì‹ ì™„ë£Œ! (ë©˜íƒˆ +${rec})`);
        }
showFloatingText(180, 230, `+${rec} ë©˜íƒˆ`, '#4CD964');
        addTime(false); 
    });
}
        window.handleProjectButton = function() {
            if(player.isBusy) return; if(!player.isProjectStarted) { if(player.hp < 30) { showLog("ì²´ë ¥ ë¶€ì¡±"); return; } openPopup('planning-popup'); } else { doProjectWork(); }
        }
        window.confirmPlanning = function() {
            const g = document.querySelector('input[name="genre"]:checked'); const s = document.querySelector('input[name="style"]:checked');
            if(!g || !s) return alert("ì„ íƒ í•„ìˆ˜"); player.currentProjectName = document.getElementById('project-name').value || "ë¬´ì œ"; currentGenreId = g.value; currentStyleId = s.value; closePopup(); openPopup('mission-popup');
        }
        window.setStrategy = function(st) {
            player.currentStrategy = st; closePopup(); player.isProjectStarted = true; player.deadline = Math.floor(Math.random() * 5) + 8; player.currentWeekInProject = 0; player.portfolioProgress = 0; showLog("í”„ë¡œì íŠ¸ ì‹œì‘!"); updateUI(); playScene('scene_burning', ["ì ì´ì œ ì‹œì‘ì´ì•¼!!"], ()=>{});
        }
        
        // [Ver 58.1] Phase 1 í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì—… (íˆë“  ì‹œë„ˆì§€ ì¶”ê°€)
window.doProjectWork = function() {
    // 1. ë¹„ìš©/ì²´ë ¥ ì²´í¬
    if(player.hp < 30) return alert("ì²´ë ¥ ë¶€ì¡± (í•„ìš”: 30)"); 
    

    closePopup();

    // 2. ì‘ì—… ì—°ì¶œ
    playPortfolioSequence(() => {
        player.hp -= 30; 
    
        
    // [ìˆ˜ì • 1] ì§„í–‰ë„ í•˜í–¥ (15 -> 9) : ì•½ 11~12íšŒ í´ë¦­ í•„ìš” (ê²Œì„ì‹œê°„ 1ë‹¬ ì†Œìš”)
        let progress = 9; 
        player.portfolioProgress += progress;

        // [ìˆ˜ì • 2] í€„ë¦¬í‹°(ì ìˆ˜) ë³´ìƒ ì†Œí­ ìƒí–¥ (ê³ ìƒí•œ ë§Œí¼ ë³´ìƒ)
        // ê¸°ë³¸ 1~5 -> 2~6ì ìœ¼ë¡œ ë³€ê²½
        let baseGain = Math.floor(Math.random() * 5) + 2; 
        let statBonus = player.designStat * 0.04; 
        let equipBonus = player.currentPower * 0.5;
        let qualityGain = baseGain + statBonus + equipBonus;

        // ---------------------------------------------------------
        // [NEW] íˆë“  ì‹œë„ˆì§€(ê¶í•©) ë¡œì§ í™•ì¥ (Ver 71.0)
        // ---------------------------------------------------------
        let synergyMult = 1.0;
        let synergyMsg = ""; 

        const pair = currentGenreId + '+' + currentStyleId;

        // 1) ì°°ë–¡ê¶í•© (Best): +20%
        if (
            pair === 'g1+s1' || // ê¸ˆìœµ+ì‹ ë¢°
            pair === 'g2+s2' || // ë°°ë‹¬+íŒ
            pair === 'g3+s4' || // ê²Œì„+ë ˆíŠ¸ë¡œ
            pair === 'g4+s3' || // ê³µê³µ+ë¯¸ë‹ˆë©€
            pair === 'g5+s5' || // íŒ¨ì…˜+ëŸ­ì…”ë¦¬
            // --- ì‹ ê·œ ì¡°í•© ---
            pair === 'g6+s7' || // AI + ì‚¬ì´ë²„í‘í¬ (êµ­ë£°)
            pair === 'g7+s1' || // ì˜ë£Œ + ì‹ ë¢°ê° (í•„ìˆ˜)
            pair === 'g8+s2' || // í‚¤ì¦ˆ + íŒí•œ (ê·€ì—¬ì›€)
            pair === 'g9+s6'    // í™˜ê²½ + ì˜¤ê°€ë‹‰ (ìì—°)
        ) {
            synergyMult = 1.2;
            synergyMsg = " (ì»¨ì…‰ ëŒ€ë°•! +20%)";
        }
        // 2) ìƒê·¹ (Worst): -20% (íŒ¨ë„í‹° ê°•í™”)
        else if (
            pair === 'g1+s8' || // ê¸ˆìœµ + ë¸Œë£¨íƒˆë¦¬ì¦˜ (ì€í–‰ì•±ì´ ë„ˆë¬´ ê±°ì¹ ì–´)
            pair === 'g7+s7' || // ì˜ë£Œ + ì‚¬ì´ë²„í‘í¬ (ë¬´ì„œìš´ ë³‘ì›)
            pair === 'g4+s5' || // ê³µê³µ + ëŸ­ì…”ë¦¬ (ì„¸ê¸ˆ ë‚­ë¹„ ë…¼ë€)
            pair === 'g9+s5'    // í™˜ê²½ + ëŸ­ì…”ë¦¬ (ê·¸ë¦°ì›Œì‹± ì˜ì‹¬)
        ) {
            synergyMult = 0.8;
            synergyMsg = " (ì»¨ì…‰ ë¯¸ìŠ¤... -20%)";
        }
        // 3) ë‚˜ì˜ì§€ ì•ŠìŒ (So-so): -10%
        else if (
            pair === 'g1+s2' || // ê¸ˆìœµ+íŒ
            pair === 'g3+s3'    // ê²Œì„+ë¯¸ë‹ˆë©€
        ) {
            synergyMult = 0.9;
            synergyMsg = " (ì• ë§¤í•¨... -10%)";
        }
        // ---------------------------------------------------------

        // ì „ëµ(ì†ë„/í€„ë¦¬í‹°) ë°˜ì˜
        if(player.currentStrategy === 'speed') qualityGain *= 0.7;

        // ìµœì¢… ì‹œë„ˆì§€ ì ìš©
        qualityGain = Math.floor(qualityGain * synergyMult);
        player.portfolioQuality += qualityGain;

        // ë¡œê·¸ ì¶œë ¥ (ì—¬ê¸°ì„œ ìœ ì €ê°€ ê¹¨ë‹«ê²Œ ë¨)
        showLog(`ì‘ì—… ì™„ë£Œ! í€„ë¦¬í‹° +${qualityGain}${synergyMsg}`); 
        
        addTime();
    });
}

        function finishProject() {
            player.isProjectStarted = false; let score = Math.floor(player.portfolioQuality);
            let grade = 'C'; if(score >= 800) grade='S'; else if(score >= 400) grade='A'; else if(score >= 150) grade='B';
            player.history.push({name:player.currentProjectName, score:score, grade:grade});
            if(score > player.bestPortfolioScore) player.bestPortfolioScore = score;
            alert(`[ë§ˆê°] ${player.currentProjectName}\në“±ê¸‰: ${grade} (${score}ì )`);
            player.portfolioProgress = 0; player.portfolioQuality = 0; saveGameData(); updateUI();
        }

        function showLog(m) { document.getElementById('log-text').innerText = m; }
        function showP2Log(m) { document.getElementById('p2-log-text').innerText = m; } 

        function initPlanningUI() { 
            const gb = document.getElementById('genre-list'); gb.innerHTML=''; genres.forEach((g,i) => { const d = document.createElement('label'); d.className = 'radio-item'; d.innerHTML = `<input type="radio" name="genre" value="${g.id}"> ${g.name}</label>`; gb.appendChild(d); }); 
            const sb = document.getElementById('style-list'); sb.innerHTML=''; styles.forEach((s,i) => { const d = document.createElement('label'); d.className = 'radio-item'; d.innerHTML = `<input type="radio" name="style" value="${s.id}"> ${s.name}</label>`; sb.appendChild(d); }); 
        }
        window.renderShop = function() {
            const l = document.getElementById('shop-list'); l.innerHTML='';
            shopItems.forEach(i => {
                const has = player.inventory.includes(i.name); const btnHtml = has ? `<button class="btn-buy" disabled>ë³´ìœ ì¤‘</button>` : `<button class="btn-buy" onclick="buyItem(${i.id})">êµ¬ë§¤</button>`;
                l.innerHTML += `<li class="shop-item"><div class="shop-left"><img src="assets/${i.img}" class="shop-thumb"><div class="shop-info"><span class="shop-name">${i.name}</span><span class="shop-desc">${i.desc}</span><span class="shop-price">${i.cost.toLocaleString()}ì›</span></div></div>${btnHtml}</li>`;
            });
        }
        window.buyItem = function(id) {
            let item = shopItems.find(i=>i.id===id); if(player.money >= item.cost) { player.money-=item.cost; player.inventory.push(item.name); player.currentPower = item.power; alert(`${item.name} êµ¬ë§¤ ì™„ë£Œ!`); saveGameData(); updateUI(); renderShop(); } else alert("ëˆ ë¶€ì¡±!");
        }
// [UPDATE] ì¸ë²¤í† ë¦¬ ì—´ê¸° (ìŠ¤í¬ë¡¤ë°” ê°„ê²© & í™”ì‚´í‘œ ê°œì„  ì ìš©)
window.renderInventory = function() {
    // 1. í™”ë©´ ì´ˆê¸°í™”
    document.getElementById('inv-view-list').style.display = 'block';
    document.getElementById('inv-view-detail').style.display = 'none';

    // 2. ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    const l = document.getElementById('inventory-list');
    l.innerHTML = '';

    player.inventory.forEach(itemName => {
        const itemData = shopItems.find(i => i.name === itemName);
        const img = itemData ? itemData.img : 'item_mouse_basic.png';

        l.innerHTML += `
        <li onclick="showInvDetail('${itemName}')" style="cursor: pointer; transition: 0.2s; align-items: center;">
            <div style="display:flex; align-items:center;">
                <img src="assets/${img}" style="width:40px; height:40px; margin-right:15px; border-radius:8px; background:#222; border:1px solid #444; object-fit: contain;">
                
                <div>
                    <div style="font-weight:700; font-size:15px; color:#fff; margin-bottom: 2px;">${itemName}</div>
                    <div style="font-size:11px; color:#888;">ë³´ìœ  ì¤‘</div>
                </div>
            </div>

            <div style="
                font-size: 24px; 
                color: #B0B8C1; 
                font-weight: 300; 
                margin-right: 5px;
                padding-bottom: 4px; /* ë†’ì´ ì¤‘ì•™ ì •ë ¬ ë¯¸ì„¸ ì¡°ì • */
            ">â€º</div>
        </li>`;
    });
}

// [NEW] ìƒì„¸ í™”ë©´ìœ¼ë¡œ ì „í™˜ (Drill-down)
window.showInvDetail = function(itemName) {
    const item = shopItems.find(i => i.name === itemName);
    if (!item) return;

    // ë°ì´í„° ì±„ìš°ê¸°
    document.getElementById('inv-detail-img').src = `assets/${item.img}`;
    document.getElementById('inv-detail-name').innerText = item.name;
    document.getElementById('inv-detail-power').innerText = `ì‘ì—… íš¨ìœ¨ +${item.power}`;
    document.getElementById('inv-detail-desc').innerText = `"${item.desc}"`;

    // í™”ë©´ ì „í™˜ (ëª©ë¡ ìˆ¨ê¹€ -> ìƒì„¸ ë³´ì„)
    document.getElementById('inv-view-list').style.display = 'none';
    document.getElementById('inv-view-detail').style.display = 'block';
}

// [NEW] ëª©ë¡ í™”ë©´ìœ¼ë¡œ ë³µê·€ (Back)
window.backToInventory = function() {
    document.getElementById('inv-view-detail').style.display = 'none';
    document.getElementById('inv-view-list').style.display = 'block';
}
        window.renderHistory = function() { document.getElementById('portfolio-list').innerHTML = player.history.map(x=>`<li>${x.name} (${x.grade})</li>`).join(''); }
        
    // [Ver 60.1 Fix] ì´ì§ ì‹œì¥ UI: ì ìˆ˜ë¿ë§Œ ì•„ë‹ˆë¼ 'ì§ê¸‰' ì¡°ê±´ë„ ì²´í¬í•˜ë„ë¡ ìˆ˜ì •
window.openJobMarket = function(){ 
    const l = document.getElementById('job-list'); l.innerHTML=''; 
    document.getElementById('best-score').innerText = player.bestPortfolioScore;

    currentJobList.forEach(c => {
        // 1. ì ìˆ˜ ì¡°ê±´ ì²´í¬
        const isScoreOk = player.bestPortfolioScore >= c.req;
        
        // 2. [NEW] ì§ê¸‰ ì¡°ê±´ ì²´í¬ (ë°ì´í„°ì— prevRankê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°„ì£¼)
        const requiredRank = c.prevRank || 0;
        const isRankOk = player.rank >= requiredRank;
        
        let btnText = "ì§€ì›";
        let btnState = "";
        
        // ìƒíƒœë³„ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° í™œì„±í™” ì—¬ë¶€ ì„¤ì •
        if (!isScoreOk) {
            btnText = `${c.req}ì  í•„ìš”`;
            btnState = "disabled";
        } else if (!isRankOk) {
            // [NEW] ì ìˆ˜ëŠ” ë˜ëŠ”ë° ì§ê¸‰ì´ ëª¨ìë„ ë•Œ
            btnText = `${RANKS[requiredRank]}â†‘ í•„ìš”`; // ì˜ˆ: "íŒ€ì¥â†‘ í•„ìš”"
            btnState = "disabled";
        }
        
        const btnAction = (btnState === "") ? `onclick="applyJob('${c.name}',${c.req}, '${c.tier}')"` : "";
        
        l.innerHTML += `
        <li>
            <div class="job-card">
                <span class="job-tier tier-${c.tier}">${c.label}</span> 
                ${c.name}
            </div>
            <button class="btn-apply" ${btnState} ${btnAction}>${btnText}</button>
        </li>`;
    }); 
};
        
 // [Ver 54.2 Fix] ì·¨ì—… ì‹œì¥ ìƒì„± ë¡œì§ ë¶„ë¦¬ (ì·¨ì¤€ìƒ vs ê²½ë ¥ì§)
function generateJobs() { 
    currentJobList = [];
    
    // ----------------------------------------------------
    // [CASE 1] Phase 1 (ì·¨ì¤€ìƒ): ë‹¤ì–‘í•œ ê¸°íšŒ ì œê³µ (í™•ë¥  ê¸°ë°˜)
    // ----------------------------------------------------
    if (!player.isPhase2) {
        let attempts = 0; 
        while(currentJobList.length < 4 && attempts < 100) {
            attempts++;
            let rand = Math.random() * 100; 
            let selectedTier = 'agency';
            
            // ì·¨ì¤€ìƒìš© í™•ë¥ : Agency(70%), TopTier(25%), Unicorn(5%)
            if (rand < 5) selectedTier = 'unicorn';        
            else if (rand < 30) selectedTier = 'toptier';  
            
            const pool = companyPool[selectedTier];
            if (!pool) continue;

            const company = JSON.parse(JSON.stringify(pool[Math.floor(Math.random() * pool.length)]));
            
            // ì ìˆ˜ ë³€ë™ì„±ì€ ë™ì¼í•˜ê²Œ ì ìš©
            let variance = Math.floor(company.req * 0.2);
            let randomVar = Math.floor(Math.random() * variance * 2) - variance; 
            company.req = Math.max(0, company.req + randomVar);

            const isDuplicate = currentJobList.find(job => job.name === company.name);
            if(!isDuplicate) { currentJobList.push(company); }
        }
    } 
    // ----------------------------------------------------
    // [CASE 2] Phase 2 (ê²½ë ¥ì§): ì»¤ë¦¬ì–´ íŒ¨ìŠ¤ (ìƒí–¥ ì§€ì›ë§Œ ê°€ëŠ¥)
    // ----------------------------------------------------
    else {
        const tierOrder = ['Agency', 'TopTier', 'Unicorn', 'Global', 'Space'];
        let currentIdx = tierOrder.indexOf(player.tier);
        
        let attempts = 0; 
        while(currentJobList.length < 4 && attempts < 100) {
            attempts++;
            
            let rand = Math.random();
            let targetIdx = currentIdx + 1; // ê¸°ë³¸: ë‹¤ìŒ ë‹¨ê³„ (ìŠ¹ì§„ ì´ì§)
            
            if (rand < 0.3 && currentIdx + 2 < tierOrder.length) {
                targetIdx = currentIdx + 2; // ëŒ€ë°• ê¸°íšŒ (ì í”„ ì´ì§)
            }
            
            // Space(ëíŒì™•)ë©´ ìœ ì§€
            if (currentIdx >= tierOrder.length - 1) targetIdx = currentIdx; 

            let targetTier = tierOrder[targetIdx];
            if (!targetTier) targetTier = 'Agency'; 

            const pool = companyPool[targetTier.toLowerCase()];
            if (!pool) continue;

            const company = JSON.parse(JSON.stringify(pool[Math.floor(Math.random() * pool.length)]));
            
            // ì ìˆ˜ ë³€ë™ì„±
            let variance = Math.floor(company.req * 0.2);
            let randomVar = Math.floor(Math.random() * variance * 2) - variance; 
            company.req = Math.max(0, company.req + randomVar);

            const isDuplicate = currentJobList.find(job => job.name === company.name);
            if(!isDuplicate) { currentJobList.push(company); }
        }
    }
}

        window.refreshJobs = function(){ generateJobs(); openJobMarket(); showLog("ì±„ìš© ê³µê³ ê°€ ìƒˆë¡œê³ ì¹¨ ë˜ì—ˆìŠµë‹ˆë‹¤!"); };
        window.resolveCrisis = function(ad) { closePopup(); if(!ad) player.hp-=10; updateUI(); };
        window.watchAdForStamina = function() { closePopup(); player.hp = 100; showLog("ì²´ë ¥ íšŒë³µ!"); updateUI(); };
        window.actionRestInPopup = function() { doRest('sleep'); };

        window.testNextTier = function() {
            const tierOrder = ['Agency', 'TopTier', 'Unicorn', 'Global', 'Space'];
            let currentIndex = tierOrder.indexOf(player.tier);
            
            let nextIndex = (currentIndex + 1) % tierOrder.length;
            let nextTier = tierOrder[nextIndex];
            
            player.tier = nextTier;
            player.rank = 0; 
            player.hp = 100; 
            updateSalary();  

            setBgByTier(player.tier);
            assignProject(); 
            updateUI();

            alert(`[í…ŒìŠ¤íŠ¸ ëª¨ë“œ]\n${nextTier}ë¡œ ê°•ì œ ì´ì§í–ˆìŠµë‹ˆë‹¤!`);
        };

window.startPhase2 = function() {
    document.getElementById('success-popup').style.display='none'; 
    setBgByTier(player.tier);
    
    // 1. ê¸°ì¡´ ìºë¦­í„° ìˆ¨ê¸°ê¸°
    if(charWorkSprite) charWorkSprite.setVisible(false);
    if(charHoodieSprite) charHoodieSprite.setVisible(false);
    if(charSuitSprite) charSuitSprite.setVisible(false);
    
    // 2. [í•µì‹¬] 2í˜ì´ì¦ˆ ì¼í•˜ëŠ” ìºë¦­í„° ë³´ì´ê¸°
    if(charSuitWorkSprite) {
        charSuitWorkSprite.setVisible(true);
        // ìœ„ì¹˜/í¬ê¸° ì¬ì¡°ì •
        const w = sceneContext.scale.width;
        const h = sceneContext.scale.height;
        adjustCharacterSize(charSuitWorkSprite, w, h);
    }
    
    document.getElementById('ui-layer').style.display='none'; 
    document.getElementById('phase2-ui-layer').style.display='flex';
    
    if(!player.isPhase2) {
        player.isPhase2 = true; 
        player.tier = 'Agency'; player.rank = 0; 
        player.money += 2000000; player.hp = 100; player.performance = 0;
        updateSalary();
    }
    assignProject(); 
    updateUI();
    player.isP2TutorialDone = false;
    saveGameData(); 
    
    startTutorialDialogue();
}

        function calculateTotalScore() {
            const pfScore = player.bestPortfolioScore * 50;
            const statScore = player.designStat * 10;
            const moneyScore = Math.floor(player.money / 1000);
            return pfScore + statScore + moneyScore;
        }

        window.openRankingPopup = function() {
            const myScore = calculateTotalScore();
            document.getElementById('my-rank-score').innerText = myScore.toLocaleString();
            const rankData = [ {name:"í† ìŠ¤ì¥ì¸", score: myScore + 5000}, {name:"ë‚˜ì•¼ë””ìì´ë„ˆ", score: myScore + 2300}, {name:"í”½ì…€ê¹ëŠ”ë…¸ì¸", score: myScore + 120}, {name:"ë‚´ì´ë¦„(ME)", score: myScore, isMe: true}, {name:"ì‹ ì…1", score: Math.max(0, myScore - 1500)}, {name:"ì§€ë‚˜ê°€ë˜í–‰ì¸", score: Math.max(0, myScore - 4000)} ];
            let percent = 100; if(myScore > 10000) percent = 30; if(myScore > 50000) percent = 10; if(myScore > 100000) percent = 1;
            document.getElementById('my-rank-text').innerText = `ìƒìœ„ ${percent}% ë””ìì´ë„ˆ`;
            const l = document.getElementById('ranking-list'); l.innerHTML = '';
            rankData.forEach((r, i) => {
                const rankClass = r.isMe ? 'ranking-item my-rank' : 'ranking-item';
                const rankColor = i < 3 ? 'top' : '';
                l.innerHTML += `<li class="${rankClass}"><span class="rank-num ${rankColor}">${i+1}</span><span class="rank-name">${r.name}</span><span class="rank-score">${r.score.toLocaleString()}</span></li>`;
            });
            openPopup('ranking-popup');
        }

        function saveGameData() { localStorage.setItem('designer_game_data', JSON.stringify(player)); localStorage.setItem('designer_game_sound', isSoundOn); }
// [ìˆ˜ì •ëœ loadGameData í•¨ìˆ˜]
function loadGameData() { 
    const savedData = localStorage.getItem('designer_game_data'); 
    if(savedData) { 
        // 1. ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const parsed = JSON.parse(savedData);
        player = { ...initialPlayerState, ...parsed }; 
        
        // 2. íŠœí† ë¦¬ì–¼ ë°ì´í„° ë³µêµ¬ ë¡œì§ (ê¸°ì¡´ ìœ ì§€)
        if (typeof player.isTutorialDone === 'undefined') {
            player.isTutorialDone = player.isPhase2 ? true : false;
        }
// [NEW] â˜… ì—¬ê¸°ê°€ ì•ˆì „í•œ ìœ„ì¹˜ì…ë‹ˆë‹¤! â˜…
        // ê¸°ì¡´ ì„¸ì´ë¸Œ íŒŒì¼ì— ê³µë°±ê¸° ì¹´ìš´í„°ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™”
        if (typeof player.idleWeeks === 'undefined') {
            player.idleWeeks = 0;
        }
        // â˜…â˜…â˜… [í•µì‹¬ ìˆ˜ì •] ì €ì¥ëœ ì›”ê¸‰ ì •ë³´ë¥¼ ìµœì‹  ì½”ë“œë¡œ ê°±ì‹  â˜…â˜…â˜…
        // ì´ ì¤„ì„ ì¶”ê°€í•´ì•¼ ì½”ë“œë¥¼ ë°”ê¿”ë„ ì„¸ì´ë¸Œ íŒŒì¼ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.
        if (player.isPhase2) {
            updateSalary(); 
        }
    }
    
    const savedSound = localStorage.getItem('designer_game_sound'); 
    if(savedSound !== null) isSoundOn = (savedSound === 'true'); 
}    
window.toggleSound = function() { isSoundOn = document.getElementById('sound-toggle').checked; if(sceneContext && sceneContext.sound) sceneContext.sound.mute = !isSoundOn; saveGameData(); }
// [ìˆ˜ì •ëœ resetGameData í•¨ìˆ˜]
window.resetGameData = function() { 
    if(confirm("ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { 
        // ìˆœìˆ˜ ê²Œì„ ë°ì´í„°ë§Œ ì‚­ì œ
        localStorage.removeItem('designer_game_data'); 
        
        // â˜… íŠœí† ë¦¬ì–¼ ê¸°ë¡ ì‚­ì œ ì½”ë“œ(removeItem('tutorialViewed')) ì œê±°ë¨
        
        location.reload(); 
    } 
}      
/* -----------------------------------------------------------
   [ì¢…ë£Œ íŒì—… ë° ë’¤ë¡œê°€ê¸° ë°©ì§€ ë¡œì§]
   HTML ë²„íŠ¼ì˜ onclick="í•¨ìˆ˜ëª…"ê³¼ ì •í™•íˆ ì¼ì¹˜ì‹œì¼°ìŠµë‹ˆë‹¤.
----------------------------------------------------------- */

// 1. ë’¤ë¡œê°€ê¸° ë°©ì§€ ì„¤ì • (í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ í•„ìš”)
function setupBackButton() { 
    history.pushState(null, null, location.href); 
    window.onpopstate = function () { 
        history.pushState(null, null, location.href); 
        openExitPopup(); // ë’¤ë¡œê°€ê¸° ëˆ„ë¥´ë©´ ì¢…ë£Œ íŒì—… ë„ì›€
    }; 
}

// 2. íŒì—… ì—´ê¸° (Xë²„íŠ¼ & ë’¤ë¡œê°€ê¸° í‚¤ ê³µìš©)
window.openExitPopup = function() {
    var popup = document.getElementById('exit-popup');
    if (popup) {
        popup.style.display = 'flex'; // íŒì—… ë³´ì´ê¸°
        
        // (ì„ íƒì‚¬í•­) íŒì—… ëœ° ë•Œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ë¦¬ì…‹
        var content = popup.querySelector('.popup-content');
        if(content) {
            content.style.animation = 'none';
            content.offsetHeight; /* ë¦¬í”Œë¡œìš° ë°œìƒ (ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘ìš©) */
            content.style.animation = 'slideUpFade 0.3s ease-out forwards';
        }
    }
}

// 3. íŒì—… ë‹«ê¸° ('ë‹«ê¸°' ë²„íŠ¼ìš©) -> â˜… ì´ í•¨ìˆ˜ê°€ ì—†ì–´ì„œ ë‹«ê¸°ê°€ ì•ˆ ëì„ ê²ë‹ˆë‹¤
window.closeExitPopup = function() {
    var popup = document.getElementById('exit-popup');
    if (popup) {
        popup.style.display = 'none'; // íŒì—… ìˆ¨ê¸°ê¸°
    }
}

// 4. ê²Œì„ ì¢…ë£Œ ('ì¢…ë£Œí•˜ê¸°' ë²„íŠ¼ìš©) -> â˜… ì´ë¦„ ë³€ê²½ (confirmExit -> quitGame)
window.quitGame = function() {
    alert("ê²Œì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.\nì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    
    // PC/ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € íƒ­ ë‹«ê¸° ì‹œë„
    window.close(); 
    
    // ì¹´ì¹´ì˜¤í†¡/ì•± ë‚´ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œë„
    if(navigator.app && navigator.app.exitApp) {
        navigator.app.exitApp();
    }
}
// [Ver 60.5 Fix] ë§í’ì„  ìœ„ì¹˜ ìˆ˜ì • (ì˜¬ë°”ë¥¸ ìºë¦­í„° ë³€ìˆ˜ ì°¸ì¡°)
function showSpeechBubble(text) {
    // ê¸°ì¡´ ë§í’ì„  ì‚­ì œ
    const existing = document.getElementById('char-speech');
    if (existing) existing.remove();

    // 1. í˜„ì¬ í™œì„±í™”ëœ ìºë¦­í„° ì°¾ê¸°
    let targetSprite;
    let targetLayer;

    if (player.isPhase2) {
        targetSprite = charSuitSprite; // ì •ì¥ ì…ì€ ê³ ì–‘ì´
        targetLayer = document.getElementById('phase2-ui-layer');
    } else {
        targetSprite = charHoodieSprite; // í›„ë“œí‹° ì…ì€ ê³ ì–‘ì´
        targetLayer = document.getElementById('ui-layer');
    }

    if (!targetSprite || !targetLayer) return;

    // 2. ë§í’ì„  ìƒì„±
    const bubble = document.createElement('div');
    bubble.id = 'char-speech';
    bubble.className = 'speech-bubble';
    bubble.innerText = text;

    // 3. ìºë¦­í„° ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì¢Œí‘œ ê³„ì‚°
    // targetSprite.xëŠ” í™”ë©´ ì¤‘ì•™(180)ì…ë‹ˆë‹¤.
    // ë§í’ì„  ë„ˆë¹„(ì•½ 140px)ë¥¼ ê³ ë ¤í•´ì„œ ì™¼ìª½ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
    // ìºë¦­í„° ì¤‘ì•™(180) - 130 = 50px (í™”ë©´ ì¢Œì¸¡)
    const offsetX = 80; 
    
    bubble.style.left = (targetSprite.x - offsetX) + 'px';
    bubble.style.top = '220px'; // ìºë¦­í„° ë¨¸ë¦¬ ë†’ì´ (ê³ ì •ê°’)

    // 4. ë ˆì´ì–´ì— ì¶”ê°€
    targetLayer.appendChild(bubble);

    // 5. 3ì´ˆ ë’¤ ì‚¬ë¼ì§
    setTimeout(() => {
        if (bubble && bubble.parentNode) {
            bubble.style.opacity = '0'; 
            bubble.style.transition = 'opacity 0.5s';
            setTimeout(() => bubble.remove(), 500);
        }
    }, 3000);
}

setInterval(() => {
    // ì¡°ê±´: ë°”ì˜ì§€ ì•ŠìŒ AND íŒì—…ì°½ ì•ˆ ë– ìˆìŒ
    const isPopupOpen = document.getElementById('modal-overlay').style.display === 'block';
    
    // ë©”ì¸ í™”ë©´(UI ë ˆì´ì–´ê°€ ë³´ì¼ ë•Œ)ì¸ì§€ ì²´í¬
    const uiId = player.isPhase2 ? 'phase2-ui-layer' : 'ui-layer';
    const isMainScreen = document.getElementById(uiId).style.display !== 'none';
    
    if (!player.isBusy && !isPopupOpen && isMainScreen) {
        // [í•µì‹¬] í˜„ì¬ ìƒí™©(ì·¨ì¤€/ì§ì¥)ì— ë§ëŠ” ê¸ì • ë©˜íŠ¸ ë¡œë“œ
        // ë§Œì•½ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’([])ì„ ì¨ì„œ ì—ëŸ¬ ë°©ì§€
        let targetMsgs = player.isPhase2 ? (msgs.idle_p2 || []) : (msgs.idle_p1 || []);
        
        if (targetMsgs.length > 0) {
            const msg = targetMsgs[Math.floor(Math.random() * targetMsgs.length)];
            showSpeechBubble(msg); 
        }
    }
}, 5000); // 5ì´ˆë§ˆë‹¤ ê¸ì • ì—ë„ˆì§€ ë°œì‚°

// [Ver 63.5 Fix] ë©˜íƒˆí†µ ì¦ê°€í­ í•˜í–¥ (ë ˆë²¨ë‹¹ 0.8)
function getMaxHp() {
    let lvl = Math.floor(player.designStat / 100);
    // [ìˆ˜ì •] 100 + (ë ˆë²¨ * 0.8)
    // Lv.26 ê¸°ì¤€: 100 + 20 = 120 (TopTier 4íšŒ, Unicorn 3íšŒ ê°€ëŠ¥)
    return 100 + Math.floor(lvl * 0.8);
}
// [Ver 64.0] ëª…ì˜ˆì˜ ì „ë‹¹ ì‹œìŠ¤í…œ

// 1. ë°ì´í„° ì´ˆê¸°í™” (ë¡œë“œ ì‹œ ì—†ìœ¼ë©´ ìƒì„±)
if (!player.hallOfFame) player.hallOfFame = [];

// 2. í˜„ì¬ ë²„í”„ í•©ê³„ ê³„ì‚° í•¨ìˆ˜
// [Ver 64.2] í‹°ì–´ë³„ ì°¨ë“± ë²„í”„ ê³„ì‚°
function getHofBuffs() {
    let buffs = { wealth: 0, speed: 0, fame: 0 };
    
    if(player.hallOfFame) {
        player.hallOfFame.forEach(item => {
            // 1. í‹°ì–´ë³„ ê°€ì¤‘ì¹˜ ì„¤ì •
            let power = 1; // ê¸°ë³¸ (Agency í˜¹ì€ ì˜›ë‚  ë°ì´í„°)
            
            if (item.companyTier === 'TopTier') power = 2;
            else if (item.companyTier === 'Unicorn') power = 3;
            else if (item.companyTier === 'Global') power = 4;
            else if (item.companyTier === 'Space') power = 5;

            // 2. ë²„í”„ í•©ì‚°
            if (item.buffType === 'wealth') buffs.wealth += power;
            if (item.buffType === 'speed') buffs.speed += power;
            if (item.buffType === 'fame') buffs.fame += power;
        });
    }
    return buffs;
}

// 3. ë©”ì¸ íŒì—… ì—´ê¸° & ë Œë”ë§
// [Ver 64.2] ëª…ì˜ˆì˜ ì „ë‹¹ UI (ì¶œì‹  í‹°ì–´ í‘œì‹œ ì¶”ê°€)
window.openHallOfFame = function() {
    const list = document.getElementById('hof-list');
    list.innerHTML = '';
    
    player.hallOfFame.forEach((item, index) => {
        let typeIcon = item.buffType === 'wealth' ? 'ğŸ’°' : (item.buffType === 'speed' ? 'âš¡' : 'ğŸ–ï¸');
        let typeName = item.buffType === 'wealth' ? 'ì—°ë´‰' : (item.buffType === 'speed' ? 'ì†ë„' : 'ì„±ê³¼');
        
        // [NEW] ë²„í”„ ìˆ˜ì¹˜ ê³„ì‚° (UI í‘œì‹œìš©)
        let power = 1;
        if (item.companyTier === 'TopTier') power = 2;
        else if (item.companyTier === 'Unicorn') power = 3;
        else if (item.companyTier === 'Global') power = 4;
        else if (item.companyTier === 'Space') power = 5;

        // ì¶œì‹  íšŒì‚¬ ë¼ë²¨ (ì˜ˆ: [Space])
        let originTag = item.companyTier ? `[${item.companyTier}]` : `[Agency]`;

        list.innerHTML += `
        <li style="border: 1px solid #FFD700;">
            <div class="card-info">
                <h3 style="color:#FFD700; font-size:14px;">${typeIcon} ${item.name}</h3>
                <p style="font-size:12px; color:#B0B8C1;">
                    <span style="color:#fff; font-weight:bold;">${originTag}</span>
                    ${typeName} +${power}%
                </p>
            </div>
            <button class="btn-action" style="background:#FF5F5F; min-width:50px; font-size:11px;" onclick="removeFromHof(${index})">í•´ì œ</button>
        </li>`;
    });

    // ë¹ˆ ìŠ¬ë¡¯
    for(let i=player.hallOfFame.length; i<3; i++) {
        list.innerHTML += `<li style="opacity:0.5; justify-content:center; border:1px dashed #555; font-size:12px;">(ë¹ˆ ìŠ¬ë¡¯)</li>`;
    }

    // ìƒë‹¨ ìš”ì•½ ì—…ë°ì´íŠ¸
    const buffs = getHofBuffs();
    document.getElementById('hof-wealth').innerText = buffs.wealth;
    document.getElementById('hof-speed').innerText = buffs.speed;
    document.getElementById('hof-fame').innerText = buffs.fame;

    openPopup('hall-of-fame-popup');
}

// 4. ë“±ë¡ íŒì—… ì—´ê¸°
window.openRegisterPopup = function() {
    if (player.hallOfFame.length >= 3) return alert("ì „ì‹œ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ê¸°ì¡´ ì‘í’ˆì„ ì œê±°í•´ì£¼ì„¸ìš”.");
    
    const list = document.getElementById('hof-candidate-list');
    list.innerHTML = '';
    
    // ê¸°ë¡(history)ì—ì„œ Sê¸‰ì´ë©´ì„œ ì•„ì§ ë“±ë¡ ì•ˆ ëœ ê²ƒë“¤ë§Œ í•„í„°ë§
    const candidates = player.history.filter(h => h.grade === 'S' && !player.hallOfFame.some(hof => hof.name === h.name));
    
    if (candidates.length === 0) {
        list.innerHTML = '<li style="justify-content:center;">ë“±ë¡ ê°€ëŠ¥í•œ Sê¸‰ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
    }

    candidates.forEach(c => {
        // êµ¬ë²„ì „ ë°ì´í„° í˜¸í™˜ (buffTypeì´ ì—†ìœ¼ë©´ ëœë¤ ë¶€ì—¬)
        if(!c.buffType) c.buffType = ['wealth','speed','fame'][Math.floor(Math.random()*3)];
        
        let typeIcon = c.buffType === 'wealth' ? 'ğŸ’°' : (c.buffType === 'speed' ? 'âš¡' : 'ğŸ–ï¸');
        
        // onclick ì´ë²¤íŠ¸ì— ê°ì²´ë¥¼ ì§ì ‘ ë„£ê¸° ì–´ë ¤ìš°ë¯€ë¡œ ì¸ë±ìŠ¤ í™œìš© ë“±ì„ í•´ì•¼í•˜ë‚˜, ì—¬ê¸°ì„  ê°„í¸í•˜ê²Œ êµ¬í˜„
        // ì£¼ì˜: history ë°°ì—´ ìˆœì„œê°€ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤ê³  ê°€ì •
        const idx = player.history.indexOf(c);
        
        list.innerHTML += `
        <li onclick="registerToHof(${idx})">
            <div class="card-info">
                <h3>${c.name}</h3>
                <p>${typeIcon} íš¨ê³¼ ë³´ìœ </p>
            </div>
            <button class="btn-buy">ì „ì‹œ</button>
        </li>`;
    });
    
    document.getElementById('hall-of-fame-popup').style.display = 'none'; // ë©”ì¸ ë‹«ê³ 
    document.getElementById('hof-register-popup').style.display = 'flex'; // ë“±ë¡ ì—´ê¸°
}
// [FIX] ë“±ë¡ ì·¨ì†Œ ì‹œ ë‹¤ì‹œ ëª…ì˜ˆì˜ ì „ë‹¹ ë©”ì¸ìœ¼ë¡œ ë³µê·€
window.closeRegisterPopup = function() {
    document.getElementById('hof-register-popup').style.display = 'none'; // ë“±ë¡ íŒì—… ë‹«ê¸°
    openHallOfFame(); // ë©”ì¸ ëª…ì˜ˆì˜ ì „ë‹¹ íŒì—… ë‹¤ì‹œ ì—´ê¸° (ì´ê²Œ í•µì‹¬!)
}
// 5. ì‹¤ì œ ë“±ë¡
window.registerToHof = function(historyIdx) {
    const item = player.history[historyIdx];
    if(!item.buffType) item.buffType = ['wealth','speed','fame'][Math.floor(Math.random()*3)];
    
    player.hallOfFame.push(item);
    
    document.getElementById('hof-register-popup').style.display = 'none';
    openHallOfFame(); // ë‹¤ì‹œ ë©”ì¸ ì—´ê¸°
}

// 6. ì œê±°
window.removeFromHof = function(index) {
    if(confirm("ì „ì‹œë¥¼ ë‚´ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ? ë²„í”„ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) {
        player.hallOfFame.splice(index, 1);
        openHallOfFame();
    }
}


window.startGame = function() {
    const intro = document.getElementById('intro-layer');
    if(!intro) return;

    loadGameData();
    updateUI(); 
    
    // P2 ë°ì´í„°ê°€ ì—†ëŠ” êµ¬ë²„ì „ ì„¸ì´ë¸Œ í˜¸í™˜ì„± ì²˜ë¦¬
    if(typeof player.isP2TutorialDone === 'undefined') player.isP2TutorialDone = false;

    if(isSoundOn && soundIntro) {
        soundIntro.play();
        currentBgm = soundIntro;
    }

    intro.style.transition = "opacity 0.5s";
    intro.style.opacity = "0";

    setTimeout(() => {
        intro.style.display = "none";
        
        // â˜… [ìµœì¢… íŒë‹¨ ë¡œì§] â˜…
        // 1. í˜ì´ì¦ˆ 2ì¸ë°, P2 íŠœí† ë¦¬ì–¼ì„ ì•ˆ ë´¤ë‹¤ë©´ -> íŠœí† ë¦¬ì–¼ ì‹œì‘
        if (player.isPhase2 && !player.isP2TutorialDone) {
            startTutorialDialogue();
        }
        // 2. í˜ì´ì¦ˆ 1ì¸ë°, P1 íŠœí† ë¦¬ì–¼ì„ ì•ˆ ë´¤ë‹¤ë©´ -> íŠœí† ë¦¬ì–¼ ì‹œì‘
        else if (!player.isPhase2 && !player.isTutorialDone) {
            startTutorialDialogue();
        }
        // 3. ê·¸ ì™¸ì—ëŠ” ë°”ë¡œ ê²Œì„ ì‹œì‘
        else {
            realGameStart();
        }
    }, 500); 
}


function realGameStart() {
    const w = sceneContext.scale.width;
    const h = sceneContext.scale.height;

    // 1. ëª¨ë“  ìºë¦­í„° ì¼ë‹¨ ìˆ¨ê¹€
    if(charHoodieSprite) charHoodieSprite.setVisible(false);
    if(charSuitSprite) charSuitSprite.setVisible(false);
    if(charWorkSprite) charWorkSprite.setVisible(false);
    if(charSuitWorkSprite) charSuitWorkSprite.setVisible(false);

    // 2. í˜ì´ì¦ˆì— ë§ëŠ” 'ì¼í•˜ëŠ”' ìºë¦­í„° ì¼œê¸°
    if(player.isPhase2) {
        document.getElementById('phase2-ui-layer').style.display = 'flex';
        setBgByTier(player.tier); 
        
        // [í•µì‹¬] ì •ì¥ ì…ê³  ì¼í•˜ëŠ” ëª¨ìŠµ ON
        if(charSuitWorkSprite) {
            charSuitWorkSprite.setVisible(true);
            adjustCharacterSize(charSuitWorkSprite, w, h);
        }
    } else {
        document.getElementById('ui-layer').style.display = 'flex';
        
        // [í•µì‹¬] í›„ë“œ ì…ê³  ì¼í•˜ëŠ” ëª¨ìŠµ ON
        if(charWorkSprite) {
            charWorkSprite.setVisible(true);
            adjustCharacterSize(charWorkSprite, w, h);
        }
    }
    
    updateAudioState('main');
}
// [ìˆ˜ì •ëœ updateAudioState í•¨ìˆ˜]
function updateAudioState(state) {
    if (!isSoundOn) {
        // ì†Œë¦¬ ë” ìƒíƒœë¼ë©´ ëª¨ë“  ì†Œë¦¬ ì •ì§€
        if(currentBgm && currentBgm.isPlaying) currentBgm.stop();
        if(soundIntro) soundIntro.stop();
        return;
    }

    // state: 'main' (ë©”ì¸í™”ë©´ ì¬ìƒ), 'mute' (ì¼ì‹œì •ì§€)
    if (state === 'mute') {
        if (soundP1 && soundP1.isPlaying) soundP1.pause();
        if (soundP2 && soundP2.isPlaying) soundP2.pause();
        if (soundIntro && soundIntro.isPlaying) soundIntro.pause();
    } 
    else if (state === 'main') {
        // â˜…â˜…â˜… [í•µì‹¬ ìˆ˜ì •] ë¬»ì§€ë„ ë”°ì§€ì§€ë„ ë§ê³  ì¸íŠ¸ë¡œëŠ” ì¼ë‹¨ ëˆë‹¤ (ê²¹ì¹¨ ë°©ì§€)
        if (soundIntro) soundIntro.stop();

        // í˜„ì¬ í˜ì´ì¦ˆì— ë§ëŠ” BGM ì„ íƒ
        let targetBgm = player.isPhase2 ? soundP2 : soundP1;

        // ë§Œì•½ ë‹¤ë¥¸ ìŒì•…(ì´ì „ í˜ì´ì¦ˆ ìŒì•… ë“±)ì´ ëŒê³  ìˆë‹¤ë©´ ë”
        if (currentBgm && currentBgm !== targetBgm) {
            currentBgm.stop();
        }
        
        // ëª©í‘œ ìŒì•…ì´ ì¬ìƒ ì¤‘ì´ ì•„ë‹ˆë¼ë©´ ì¬ìƒ
        if (targetBgm && !targetBgm.isPlaying) {
            targetBgm.play();
        }
        
        currentBgm = targetBgm;
    }
}
// [íŠœí† ë¦¬ì–¼ ë°ì´í„°]
const tutoMessages = [
    { name: "ğŸ“ ë©˜í† ", text: "ë°˜ê°‘ë„¤! ìë„¤ê°€ í›Œë¥­í•œ ë””ìì´ë„ˆê°€ ë  ìˆ˜ ìˆë„ë¡ ë‚´ê°€ í•˜ë‚˜ì”© ì•Œë ¤ì£¼ê² ë„¤." },
    { name: "ğŸ“ ë©˜í† ", text: "ìë„¤ì˜ ëª©í‘œëŠ” ìµœê³ ì˜ [í¬íŠ¸í´ë¦¬ì˜¤]ë¥¼ ë§Œë“¤ì–´ ì¢‹ì€ íšŒì‚¬ì— 'ì·¨ì—…'í•˜ëŠ” ê±¸ì„¸!" },
    { name: "ğŸ’¡ ìƒì¡´ íŒ", text: "ëˆì´ ì—†ìœ¼ë©´ [ì•Œë°”]ë¥¼ ë›°ì–´ì•¼ í•´. í•˜ì§€ë§Œ [ì²´ë ¥] ê´€ë¦¬ëŠ” í•„ìˆ˜ë„¤. ì“°ëŸ¬ì§€ë©´ ì•ˆ ë˜ë‹ˆê¹Œ." },
    { name: "ğŸ’¡ ì„±ì¥ íŒ", text: "ë²ˆ ëˆìœ¼ë¡œ [ìŠ¤í‚¬ ì—…]ì„ í•˜ê³  ì¢‹ì€ [ì¥ë¹„]ë¥¼ ë§ì¶°ì•¼ ëª…ì‘ì´ ë‚˜ì˜¨ë‹¤ë„¤." },
    { name: "ğŸ“ ë©˜í† ", text: "ì, ì´ì œ [ìƒˆ í”„ë¡œì íŠ¸]ë¥¼ ëˆŒëŸ¬ì„œ ì²« ì‘í’ˆì„ ë§Œë“¤ì–´ë³´ê²Œ. í–‰ìš´ì„ ë¹„ë„¤!" }
];
// â˜… [ì¶”ê°€] í˜ì´ì¦ˆ 2 (ì§ì¥ì¸) ëŒ€ì‚¬
const tutoMessagesP2 = [
    { name: "íŒ€ì¥", text: "ìë„¤ê°€ ìƒˆë¡œ ì˜¨ ì‹ ì…ì¸ê°€? í•©ê²©ì„ ì¶•í•˜í•˜ë„¤." },
    { name: "íŒ€ì¥", text: "íšŒì‚¬ëŠ” ì‹¤ì „ì´ì•¼. [ì—…ë¬´ ìˆ˜í–‰]ì„ í†µí•´ ì„±ê³¼ë¥¼ ì¦ëª…í•˜ê³  ìŠ¹ì§„í•˜ê²Œ." },
    { name: "ğŸ’¡ ì²˜ì„¸ìˆ ", text: "í˜ë“¤ ë• [ë™ë£Œ]ë“¤ê³¼ ì–´ìš¸ë¦¬ê±°ë‚˜ [íœ´ì‹]ìœ¼ë¡œ ë©˜íƒˆì„ ê´€ë¦¬í•´ì•¼ ì˜¤ë˜ ë²„í‹¸ ìˆ˜ ìˆì–´." },
    { name: "ğŸ’¡ ìê¸°ê³„ë°œ", text: "í˜„ì‹¤ì— ì•ˆì£¼í•˜ì§€ ë§ê³  [ìŠ¤í‚¬]ì„ ê³„ì† ê°ˆê³ ë‹¦ê²Œ. ê·¸ë˜ì•¼ ë” ë†’ì€ ê³³(ì´ì§)ìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆì§€." },
    { name: "íŒ€ì¥", text: "ì, ê·¸ëŸ¼ ìë¦¬ë¡œ ê°€ì„œ ì—…ë¬´ë¥¼ ì‹œì‘í•´ ë³´ê²Œë‚˜!" }
];
let tutoIndex = 0;

// 1. íŠœí† ë¦¬ì–¼ ì‹œì‘
function startTutorialDialogue() {
    tutoIndex = 0;
    document.getElementById('tutorial-overlay').style.display = 'flex';
    showTutoLine();
}

// 2. ëŒ€ì‚¬ ë³´ì—¬ì£¼ê¸° (í˜ì´ì¦ˆì— ë”°ë¼ ë°ì´í„° êµì²´)
function showTutoLine() {
    // â˜… í˜„ì¬ í˜ì´ì¦ˆì— ë§ëŠ” ë©”ì‹œì§€ ë°°ì—´ ì„ íƒ
    const currentMsgs = player.isPhase2 ? tutoMessagesP2 : tutoMessages;
    const data = currentMsgs[tutoIndex];
    
    document.getElementById('tuto-name').innerText = data.name;
    document.getElementById('tuto-text').innerText = data.text;
    
    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ logic
    const btn = document.getElementById('tuto-btn');
    if(tutoIndex === currentMsgs.length - 1) {
        // í˜ì´ì¦ˆì— ë”°ë¼ ë²„íŠ¼ ë©˜íŠ¸ë„ ë‹¤ë¥´ê²Œ
        btn.innerText = player.isPhase2 ? "ì—…ë¬´ ì‹œì‘í•˜ê¸° (Start)" : "ë””ìì´ë„ˆ ë„ì „í•˜ê¸° (Start)";
        btn.style.backgroundColor = "#3182F6"; 
    } else {
        btn.innerText = "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤. (ë‹¤ìŒ)";
        btn.style.backgroundColor = "#191F28";
    }
}

// 3. ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ (í˜ì´ì¦ˆì— ë”°ë¼ ì €ì¥ í‚¤ ë¶„ê¸°)
window.nextTutorialLine = function() {
    tutoIndex++;
    
    // â˜… í˜„ì¬ í˜ì´ì¦ˆ ë©”ì‹œì§€ ê¸¸ì´ í™•ì¸
    const currentMsgs = player.isPhase2 ? tutoMessagesP2 : tutoMessages;

    if(tutoIndex < currentMsgs.length) {
        showTutoLine();
    } else {
        // â˜… í˜ì´ì¦ˆì— ë§ê²Œ ì™„ë£Œ ì²˜ë¦¬
        if (player.isPhase2) {
            player.isP2TutorialDone = true; // í˜ì´ì¦ˆ 2 ì™„ë£Œ
        } else {
            player.isTutorialDone = true;   // í˜ì´ì¦ˆ 1 ì™„ë£Œ
        }
        
        saveGameData(); // ì €ì¥

        document.getElementById('tutorial-overlay').style.display = 'none';
        realGameStart();
    }
}
// [ìˆ˜ì •ëœ í”Œë¡œíŒ… í…ìŠ¤íŠ¸ í•¨ìˆ˜]
function showFloatingText(x, y, text, color='#fff') {
    const el = document.createElement('div');
    el.className = 'float-text';
    el.innerText = text;
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    el.style.color = color;
    
    // ì¤‘ì•™ ì •ë ¬ ë³´ì •
    el.style.transform = 'translate(-50%, -50%)'; 
    
    // â˜…â˜…â˜… [í•µì‹¬ ìˆ˜ì •] bodyê°€ ì•„ë‹ˆë¼ game-containerì— ë„£ì–´ì•¼ í•¨ â˜…â˜…â˜…
    // ê·¸ë˜ì•¼ ê²Œì„ í™”ë©´(360x640) ì•ˆì—ì„œ ì¢Œí‘œê°€ ì‘ë™í•©ë‹ˆë‹¤.
    document.getElementById('game-container').appendChild(el);

    // ì• ë‹ˆë©”ì´ì…˜ í›„ ì‚­ì œ
    setTimeout(() => {
        el.remove();
    }, 800);
}
// [ë‚®/ë°¤ íŒë³„ í•¨ìˆ˜]
// ë°¤ ê¸°ì¤€: ì˜¤í›„ 6ì‹œ(18ì‹œ) ~ ì˜¤ì „ 6ì‹œ(06ì‹œ)
function isNightTime() {
    const h = new Date().getHours();
    return h >= 18 || h < 6;
}
// [ë©´ì ‘ ì‹œìŠ¤í…œ ë³€ìˆ˜]
let interviewStep = 0;
let interviewStats = { P: 10, L: 10, S: 10 }; // ì´ˆê¸° ìŠ¤íƒ¯ (ì—´ì •, ë…¼ë¦¬, ì„¼ìŠ¤)
let interviewTargetJob = null;
let currentQuestions = [];

// 1. ë©´ì ‘ ì‹œì‘
// [Ver 76.0 Fix] ë©´ì ‘ íŒíŠ¸ ë¯¸ë…¸ì¶œ ìˆ˜ì • (ë°ì´í„° ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€)
function startInterview(jobName, tier) {
    // â˜…â˜…â˜… [ì‹ ê·œ ê¸°ëŠ¥] ì¿¨íƒ€ì„ ì²´í¬ (ì…êµ¬ ì»·) â˜…â˜…â˜…
    if (interviewCooldowns[jobName] && Date.now() < interviewCooldowns[jobName]) {
        let remainSec = Math.ceil((interviewCooldowns[jobName] - Date.now()) / 1000);
        alert(`[ì§€ì› ë¶ˆê°€] ğŸ›‘\në¶ˆí•©ê²©ì˜ ì¶©ê²©ìœ¼ë¡œ ë©˜íƒˆì´ ë‚˜ê°”ìŠµë‹ˆë‹¤.\n\në§ˆìŒì„ ì¶”ìŠ¤ë¥´ê¸°ê¹Œì§€ ${remainSec}ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
        return; // ë©´ì ‘ ì‹œì‘ ì•ˆ í•˜ê³  ê°•ì œ ì¢…ë£Œ
    }
    // 1. ì›ë³¸ ë°ì´í„°(companyPool)ì—ì„œ í•´ë‹¹ íšŒì‚¬ì˜ ì •ë³´ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
    let poolKey = tier.toLowerCase(); // 'Agency' -> 'agency'
    let pool = companyPool[poolKey]; 
    
    // ì•ˆì „ì¥ì¹˜
    if (!pool) pool = []; 

    // ì´ë¦„ì´ ê°™ì€ íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ìŒ
    let targetData = pool.find(c => c.name === jobName);

    // 2. ì°¾ì€ ì •ë³´ë¥¼ interviewTargetJobì— ë„£ìŠµë‹ˆë‹¤. (ì´ì œ hintë„ í¬í•¨ë¨!)
    if (targetData) {
        // ê¹Šì€ ë³µì‚¬ë¡œ ê°€ì ¸ì˜´ (ì›ë³¸ ì†ìƒ ë°©ì§€)
        interviewTargetJob = JSON.parse(JSON.stringify(targetData));
    } else {
        // ë§Œì•½ ëª» ì°¾ìœ¼ë©´ ê¸°ë³¸ê°’ (ì•ˆì „ì¥ì¹˜)
        interviewTargetJob = { name: jobName, tier: tier, hint: "ëª©í‘œ: ìµœì„ ì„ ë‹¤í•´ ë‹µë³€í•˜ì„¸ìš”!" };
    }

    // 3. ë©´ì ‘ ì´ˆê¸°í™”
    interviewStep = 0;
    interviewStats = { P: 10, L: 10, S: 10 }; 
    
    // ì§ˆë¬¸ 3ê°œ ëœë¤
    let shuffled = [...interviewData].sort(() => 0.5 - Math.random());
    currentQuestions = shuffled.slice(0, 3);

    updateInterviewUI();
    openPopup('interview-popup');
}

// [ìˆ˜ì •ëœ updateInterviewUI í•¨ìˆ˜]
function updateInterviewUI() {
    // 1. ìƒë‹¨ ìŠ¤íƒ¯ í‘œì‹œ
    const statsDisplay = document.getElementById('interview-stats-display');
    if(statsDisplay) {
        statsDisplay.innerHTML = `
            <span style="color:#FF5F5F;">ğŸ”¥${interviewStats.P}</span> | 
            <span style="color:#3182F6;">ğŸ§ ${interviewStats.L}</span> | 
            <span style="color:#FFD700;">âœ¨${interviewStats.S}</span>
        `;
    }

    // ì¢…ë£Œ ì²´í¬
    if (interviewStep >= 3) {
        finishInterview();
        return;
    }

    const qData = currentQuestions[interviewStep];
    
    // 2. ì§ˆë¬¸ í…ìŠ¤íŠ¸
    document.getElementById('interview-q-text').innerText = `Q${interviewStep+1}. ${qData.q}`;

    // 3. â˜…í•µì‹¬ ìˆ˜ì •â˜… íŒíŠ¸(ëª©í‘œ) í‘œì‹œ ë¡œì§ ë³€ê²½
    const hintEl = document.getElementById('interview-q-hint');
    
    // [ê¸°ì¡´ ë¬¸ì œ] if (tier === 'Agency') ... (ì´ê²Œ ê³ ì •ë˜ì–´ ìˆì—ˆìŒ)
    // [ìˆ˜ì •] ë°ì´í„°ì— ìˆëŠ” hintë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
    if (interviewTargetJob && interviewTargetJob.hint) {
        hintEl.innerHTML = interviewTargetJob.hint;
    } else {
        // í˜¹ì‹œ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ê¸°ë³¸ê°’
        hintEl.innerHTML = "ëª©í‘œ: ìµœì„ ì„ ë‹¤í•´ ë‹µë³€í•˜ì„¸ìš”!";
    }
    
    // ìŠ¤íƒ€ì¼ ì ìš© (íŒŒë€ìƒ‰ í…Œë‘ë¦¬/ë°°ê²½ ìŠ¤íƒ€ì¼ë¡œ í†µì¼)
    hintEl.className = "interview-hint-badge hint-blue"; 

    // 4. ë‹µë³€ ë²„íŠ¼ ìƒì„±
    const ansContainer = document.getElementById('interview-answers');
    ansContainer.innerHTML = '';
    
    let answers = [...qData.a].sort(() => 0.5 - Math.random()); 

    answers.forEach(ans => {
        const btn = document.createElement('button');
        btn.className = 'interview-btn'; // ì•„ê¹Œ ë§Œë“  3ìƒ‰ ì»¬ëŸ¬ ë²„íŠ¼ í´ë˜ìŠ¤
        btn.innerText = ans.text;
        btn.onclick = () => submitAnswer(ans.effect);
        ansContainer.appendChild(btn);
    });
}

// 3. ë‹µë³€ ì„ íƒ (ìŠ¤íƒ¯ ë³€ë™ ì ìš©)
function submitAnswer(effect) {
    // ìŠ¤íƒ¯ ì¦ê° ì ìš©
    interviewStats.P += effect.P;
    interviewStats.L += effect.L;
    interviewStats.S += effect.S;

    // 0 ë¯¸ë§Œ ë°©ì§€ (ìµœì†Œ 0)
    interviewStats.P = Math.max(0, interviewStats.P);
    interviewStats.L = Math.max(0, interviewStats.L);
    interviewStats.S = Math.max(0, interviewStats.S);

    // ì—°ì¶œ (ê°€ì¥ ë§ì´ ì˜¤ë¥¸ ìŠ¤íƒ¯ í‘œì‹œ)
    let msg = "";
    let color = "#fff";
    if (effect.P > 3) { msg = "ì—´ì • ìƒìŠ¹! ğŸ”¥"; color="#FF5F5F"; }
    else if (effect.L > 3) { msg = "ë…¼ë¦¬ë ¥ ì–´í•„! ğŸ§ "; color="#3182F6"; }
    else if (effect.S > 3) { msg = "ì„¼ìŠ¤ ìˆë‹¤! âœ¨"; color="#FFD700"; }
    else { msg = "ë¬´ë‚œí•œ ëŒ€ë‹µ..."; color="#ccc"; }

    showFloatingText(180, 300, msg, color);

    interviewStep++;
    updateInterviewUI();
}

// [Ver 79.5 Fix] ë©´ì ‘ íŒ¨ë„í‹° ì‹œê°„ ê°•í™” (1ë¶„ -> 3ë¶„)
function finishInterview() {
    closePopup();
    
    let passed = false;

    // í•©ê²© ë¡œì§ (Ver 77.0 ê¸°ì¤€)
    if (interviewTargetJob.tier === 'Agency') {
        if (interviewStats.P >= 14 || (interviewStats.P >= 12 && interviewStats.L >= 12)) passed = true;
    } else {
        if ((interviewStats.L >= 12 && interviewStats.S >= 12) || interviewStats.L >= 16 || interviewStats.S >= 16) passed = true;
    }

    if (passed) {
        // í•©ê²© ì‹œ ì¿¨íƒ€ì„ í•´ì œ
        if(interviewCooldowns[interviewTargetJob.name]) delete interviewCooldowns[interviewTargetJob.name];

        pendingOffer = { 
            name: interviewTargetJob.name, 
            score: player.bestPortfolioScore, 
            newTier: interviewTargetJob.tier 
        };
        document.getElementById('offer-company-name').innerText = interviewTargetJob.name;
        openPopup('offer-popup');
    } else {
        // ë¶ˆí•©ê²© ì‹œ
        player.hp = Math.max(0, player.hp - 20);
        
        // â˜…â˜…â˜… [ìˆ˜ì •ë¨] 3ë¶„(180ì´ˆ) ì¿¨íƒ€ì„ ì„¤ì • â˜…â˜…â˜…
        // 3 * 60 * 1000 = 180,000ms
        let penaltyTime = 3 * 60 * 1000; 
        interviewCooldowns[interviewTargetJob.name] = Date.now() + penaltyTime;

        // ì¡°ì–¸ ë©˜íŠ¸
        let advice = "ì¡°ê¸ˆ ë” ê· í˜• ì¡íŒ ì‹œê°ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.";
        if (interviewTargetJob.tier !== 'Agency') {
            if (interviewStats.L < 12 && interviewStats.S < 12) advice = "ë…¼ë¦¬ì™€ ì„¼ìŠ¤, ë‘˜ ë‹¤ ì¡°ê¸ˆì”© ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.";
            else if (interviewStats.L < 12) advice = "ë…¼ë¦¬ì ì¸ ì„¤ë“ë ¥ì´ ì¡°ê¸ˆ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.";
            else if (interviewStats.S < 12) advice = "íŠ¸ë Œë””í•œ ê°ê°(ì„¼ìŠ¤) ì–´í•„ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.";
        }

        // ì•Œë¦¼ì°½ ì•ˆë‚´ (3ë¶„)
        alert(`[ë©´ì ‘ íƒˆë½] ğŸ˜­\n"${advice}"\n\n(HP -20, 3ë¶„ê°„ ì¬ì§€ì› ë¶ˆê°€ ğŸš«)`);
        
        updateUI();
    }
}

// [NEW] ë¶€ëª¨ë‹˜ ì”ì†Œë¦¬ ì´ë²¤íŠ¸ í•¨ìˆ˜
function triggerNaggingEvent() {
    // 1. ëœë¤ ëŒ€ì‚¬ ì¶”ì¶œ
    const msg = naggingMsgs[Math.floor(Math.random() * naggingMsgs.length)];
    
    // 2. ë©˜íƒˆ ê°ì†Œ (HP -10)
    player.hp = Math.max(0, player.hp - 10);
    
    // 3. ì¹´ìš´í„° ë¦¬ì…‹ (í•œë²ˆ í˜¼ë‚¬ìœ¼ë‹ˆ ë‹¹ë¶„ê°„ ì¡°ìš©í•¨)
    player.idleWeeks = 0;

    // 4. ì•Œë¦¼ì°½ ë„ìš°ê¸°
    alert(`ğŸ’¢ [ê³µë°±ê¸° ê²½ê³ ] ë¶€ëª¨ë‹˜ì˜ ì”ì†Œë¦¬!\n\n"${msg}"\n\n(í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì—…ì„ ë„ˆë¬´ ì˜¤ë˜ ì‰¬ì—ˆìŠµë‹ˆë‹¤. ë©˜íƒˆ -10)`);
    
    // 5. UI ì—…ë°ì´íŠ¸ (HP ê¹ì¸ ê±° ë°˜ì˜)
    updateUI();
}

/* [ìˆ˜ì •] ë¸Œë¦¿ì§€ ë·° ê°•ì œ ì¢…ë£Œ ìŠ¤í¬ë¦½íŠ¸ */
document.addEventListener('DOMContentLoaded', function() {
    const bridge = document.getElementById('bridge-view');
    const intro = document.getElementById('intro-layer');
    
    // ì¸íŠ¸ë¡œëŠ” ë’¤ì— ë¯¸ë¦¬ ì¼œë‘ê¸°
    if(intro) intro.style.display = 'flex';

    // 1.5ì´ˆ ë’¤ì— ë¬´ì¡°ê±´ ì‹¤í–‰
    setTimeout(() => {
        if (bridge) {
            // 1. íˆ¬ëª…í•˜ê²Œ ë§Œë“¤ê¸°
            bridge.classList.add('bridge-hidden'); 
            
            // 2. 0.6ì´ˆ ë’¤ì— ì•„ì˜ˆ ì‚­ì œ (í™•ì‹¤í•˜ê²Œ)
            setTimeout(() => { 
                bridge.style.display = 'none'; 
            }, 600);
        }
    }, 1500); 
});
// â–¼â–¼â–¼ ìŠ¤í¬ë¦½íŠ¸ ë§¨ ì•„ë˜ìª½ì— ì´ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš” â–¼â–¼â–¼

// [ìºë¦­í„° í¬ê¸° ë° ìœ„ì¹˜ ì¡°ì • í—¬í¼ í•¨ìˆ˜]
function adjustCharacterSize(sprite, w, h) {
    if(!sprite) return;
    
    // 1. í¬ê¸°: í™”ë©´ ë†’ì´ì˜ 25%ë¡œ ëŒ€í­ ì¶•ì†Œ (ê¸°ì¡´ 35% -> 25%)
    // ë” ì‘ê²Œ í•˜ë ¤ë©´ 0.2ë¡œ ì¤„ì´ì„¸ìš”.
    const targetHeight = h * 0.25; 
    
    // 2. ë¹„ìœ¨ ìœ ì§€í•˜ë©° í¬ê¸° ë³€ê²½
    sprite.setDisplaySize(targetHeight * (sprite.width / sprite.height), targetHeight);
    
    // 3. ìœ„ì¹˜: ìœ„ë¡œ ëŒì–´ì˜¬ë¦¼ (ê¸°ì¡´ 0.15 -> 0.02)
    // 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ í™”ë©´ ì •ì¤‘ì•™ì…ë‹ˆë‹¤.
    sprite.setPosition(w / 2, h / 2 + (h * 0.02));
    
    // 4. ê³ ì •
    sprite.setScrollFactor(0);
}
 </script>
</body>
</html>